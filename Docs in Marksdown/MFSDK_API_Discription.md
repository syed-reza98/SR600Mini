Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK API

V1.6

Fujian MoreFun Electronic Technology Co.,Ltd.

Fujian MoreFun Electronic Technology Co.,Ltd.

Contents
Document history version ............................................................................................................... 1
1 Global ..............................................................................................................................................2
1.1 Module description .............................................................................................................. 2
1.2 Module structure declaration ............................................................................................. 2
1.3 Constant declarations ......................................................................................................... 2
2 Version module ..............................................................................................................................2
2.1 Module description .............................................................................................................. 2
2.2 Module structure declaration ............................................................................................. 3
2.3 Constant declarations ......................................................................................................... 3
2.4 MfSdkVerGetDataVersion .................................................................................................. 3
2.5 MfSdkVerMfOsVersion ........................................................................................................3
2.6 MfSdkVerGetAppVer ........................................................................................................... 4
2.7 MfSdkVerGetBootVer ..........................................................................................................4
2.8 MfSdkVerGetDriverVer ....................................................................................................... 4
2.9 MfSdkVerGetSysVer ........................................................................................................... 5
2.10 MfSdkVerGetSpVer ........................................................................................................... 5
2.11 MfSdkVerSetAppVersion .................................................................................................. 5
2.12 MfSdkVerGetSecHwVer ................................................................................................... 6
2.13 MfSdkVerGetSecFwVer ....................................................................................................6
3 Util module ..................................................................................................................................... 7
3.1 Module description .............................................................................................................. 7
3.2 Module structure declaration ............................................................................................. 7
3.3 Constant declarations ......................................................................................................... 7
3.4 MfSdkUtilGetModuleVer ..................................................................................................... 7
3.5 MfSdkUtilAsc2Bcd ............................................................................................................... 8
3.6 MfSdkUtilBcd2Asc ............................................................................................................... 8
3.7 MfSdkUtilHex2Asc ...............................................................................................................9
3.8 MfSdkUtilInt2Bcd ............................................................................................................... 10
3.9 MfSdkUtilBcd2Int ............................................................................................................... 10
3.10 MfSdkUtilGenLrc ..............................................................................................................11
3.11 MfSdkUtilDes .................................................................................................................... 11
3.12 MfSdkUtilBeep ................................................................................................................. 12
3.13 MfSdkUtilBuzzerSound .................................................................................................. 12
3.14 MfSdkUtilGetRand ...........................................................................................................13
3.15 MfSdkUtilSHA1 ................................................................................................................ 13
3.16 MfSdkUtilGeneCodePic ..................................................................................................14
3.17 MfSdkUtilLed .................................................................................................................... 14
3.18 MfSdkUtilStr2Longlong ...................................................................................................15
3.19 MfSdkUtilMd5File ............................................................................................................ 15
3.20 MfSdkUtilUtf8str2Astr ..................................................................................................... 16
3.21 MfSdkUtilUnicodeToUtf8 ................................................................................................ 16
3.22 MfSdkUtilUtf8ToUnicode ................................................................................................ 17

Fujian MoreFun Electronic Technology Co.,Ltd.

3.23 MfSdkUtilTlvGetDataByTag ........................................................................................... 17
3.24 MfSdkUtilCtrlBeep ........................................................................................................... 18
3.25 MfSdkUtilGenRsa ............................................................................................................18
3.26 MfSdkUtilGenRsaKey .....................................................................................................18
3.27 MfSdkUtilRsaSign ........................................................................................................... 19
3.28 MfSdkUtilRsaGetPublicKey ........................................................................................... 19
3.29 MfSdkUtilGenRsaDelKey ...............................................................................................20
3.30 MfSdkUtilGenRsaDelAllKey .......................................................................................... 20
3.31 MfSdkUtilRsaRand ..........................................................................................................21
3.32 MfSdkUtilCompress ........................................................................................................ 21
3.33 MfSdkUtilCompressBound .............................................................................................22
3.34 MfSdkUtilSave2Zip ..........................................................................................................22
4 RFID module ................................................................................................................................22
4.1 Module description ............................................................................................................ 22
4.2 Module structure declaration ........................................................................................... 23
4.3 Constant declarations ....................................................................................................... 23
4.4 MfSdkNfcInit ....................................................................................................................... 23
4.5 MfSdkNfcApdu ................................................................................................................... 24
4.6 MfSdkNfcClose .................................................................................................................. 25
4.7 MfSdkNfcCtlsComm ..........................................................................................................25
4.8 MfSdkNfcCtlsPowerDown ................................................................................................ 25
4.9 MfSdkNfcCtlsPowerUpAndSeek .....................................................................................26
4.10 MfSdkNfcDetect ...............................................................................................................26
4.11 MfSdkNfcApduStream .................................................................................................... 27
4.12 MfSdkNfcGetUid ..............................................................................................................27
4.13 MfSdkNfcIsProbe .............................................................................................................28
4.14 MfSdkNfcM1Atqa .............................................................................................................28
4.15 MfSdkNfcM1Auth .............................................................................................................28
4.16 MfSdkNfcM1Close ...........................................................................................................29
4.17 MfSdkNfcM1Decrement ................................................................................................. 29
4.18 MfSdkNfcM1Increment ...................................................................................................30
4.19 MfSdkNfcM1Open ........................................................................................................... 30
4.20 MfSdkNfcM1Read ........................................................................................................... 30
4.21 MfSdkNfcM1Restore .......................................................................................................31
4.22 MfSdkNfcM1SetKey ........................................................................................................31
4.23 MfSdkNfcM1Transfer ...................................................................................................... 32
4.24 MfSdkNfcM1Uid ...............................................................................................................32
4.25 MfSdkNfcM1Write ........................................................................................................... 32
4.26 MfSdkNfcOpen .................................................................................................................33
4.27 MfSdkNfcReset ................................................................................................................33
4.28 MfSdkNfcTagEmulateInitSetData ................................................................................. 34
4.29 MfSdkNfcTagEmulateInitSetUrl .....................................................................................34
4.30 MfSdkNfcTagEmulateProcess .......................................................................................35
4.31 MfSdkNfcTagEmulateDeinit ...........................................................................................35

Fujian MoreFun Electronic Technology Co.,Ltd.

4.32 MfSdkNfcLed ....................................................................................................................35
4.33 MfSdkNfcIsAroundFrontLcd .......................................................................................... 36
5 Magstripe module ....................................................................................................................... 36
5.1 Module description ............................................................................................................ 36
5.2 Module structure declaration ........................................................................................... 36
5.3 Constant declarations ....................................................................................................... 36
5.4 MfSdkMagStripeDetect .....................................................................................................37
5.5 MfSdkMagtekClose ........................................................................................................... 37
5.6 MfSdkMagTekFlush ...........................................................................................................37
5.7 MfSdkMagtekOpen ............................................................................................................38
6 ICC module .................................................................................................................................. 38
6.1 Module description ............................................................................................................ 38
6.2 Module structure declaration ........................................................................................... 38
6.3 Constant declarations ....................................................................................................... 38
6.4 MfSdkIccClose ................................................................................................................... 39
6.5 MfSdkIccComm ..................................................................................................................40
6.6 MfSdkIccGetCardATR .......................................................................................................40
6.7 MfSdkIccGetCardStatus ...................................................................................................40
6.8 MfSdkIccGetModuleVer ....................................................................................................41
6.9 MfSdkIccInsertDetect ........................................................................................................41
6.10 MfSdkIccApdu .................................................................................................................. 42
6.11 MfSdkIccOpen ..................................................................................................................42
6.12 MfSdkIccPowerOff ...........................................................................................................42
6.13 MfSdkIccPowerUp ...........................................................................................................43
6.14 MfSdkIccPowerOn ...........................................................................................................43
7 GUI module ..................................................................................................................................44
7.1 Module description ............................................................................................................ 44
7.2 Module structure declaration ........................................................................................... 44
7.3 Constant declarations ....................................................................................................... 44
7.4 MfSdkGuiLedAmount ........................................................................................................44
7.5 MfSdkGuiLedCounter ....................................................................................................... 45
7.6 MfSdkGuiLedTime .............................................................................................................45
7.7 MfSdkGuiLedDigitShow ....................................................................................................45
7.8 MfSdkGuiBeginBatchPaint ...............................................................................................46
7.9 MfSdkGuiEndBatchPaint ..................................................................................................46
7.10 MfSdkGuiSetColor ...........................................................................................................47
7.11 MfSdkGuiGetColor .......................................................................................................... 47
7.12 MfSdkGuiSetBgColor ......................................................................................................47
7.13 MfSdkGuiGetBgColor ..................................................................................................... 48
7.14 MfSdkGuiSetFullScreen .................................................................................................48
7.15 MfSdkGuiPixel ................................................................................................................. 48
7.16 MfSdkGuiLineTo .............................................................................................................. 49
7.17 MfSdkGuiBarRc ............................................................................................................... 49
7.18 MfSdkGuiSetBarColor .................................................................................................... 50

Fujian MoreFun Electronic Technology Co.,Ltd.

7.19 MfSdkGuiGetBarColor ....................................................................................................50
7.20 MfSdkGuiSetFont ............................................................................................................ 51
7.21 MfSdkGuiGetFont ............................................................................................................51
7.22 MfSdkGuiSetTextColor ................................................................................................... 51
7.23 MfSdkGuiGetTextColor ...................................................................................................52
7.24 MfSdkGuiSetTextBgColor .............................................................................................. 52
7.25 MfSdkGuiGetTextBgColor ..............................................................................................52
7.26 MfSdkGuiClearDc ............................................................................................................53
7.27 MfSdkGuiSetTextZoom .................................................................................................. 53
7.28 MfSdkGuiGetTextZoom .................................................................................................. 54
7.29 MfSdkGuiSetPixel ........................................................................................................... 54
7.30 MfSdkGuiGetPixel ........................................................................................................... 54
7.31 MfSdkGuiTextOut ............................................................................................................ 55
7.32 MfSdkGuiGetTextWidth .................................................................................................. 55
7.33 MfSdkGuiGetTextHeight .................................................................................................56
7.34 MfSdkGuiCline ................................................................................................................. 56
7.35 MfSdkGuiGetWidth ......................................................................................................... 57
7.36 MfSdkGuiGetHeight ........................................................................................................ 57
7.37 MfSdkGuiPageOpPaint .................................................................................................. 57
7.38 MfSdkGuiImeSetMode ................................................................................................... 58
7.39 MfSdkGuiImeStartInput .................................................................................................. 58
7.40 MfSdkGuiMainMenuFuncAdd ....................................................................................... 59
7.41 MfSdkGuiMainMenuFuncDel ........................................................................................ 59
7.42 MfSdkGuiMainMenuShow ............................................................................................. 59
7.43 MfSdkGuiPostMessage ..................................................................................................60
7.44 MfSdkGuiGetMessage ................................................................................................... 60
7.45 MfSdkGuiProcDefaultMsg ..............................................................................................61
7.46 MfSdkGuiMessageBoxShow .........................................................................................61
7.47 MfSdkGuiLoadBmpEx .................................................................................................... 62
7.48 MfSdkGuiLoadBmp ......................................................................................................... 62
7.49 MfSdkGuiBmpFree ..........................................................................................................63
7.50 MfSdkGuiOutBits ............................................................................................................. 63
7.51 MfSdkGuiOutBitsEx ........................................................................................................ 64
7.52 MfSdkGuiOutBitsZoom ...................................................................................................65
7.53 MfSdkGuiTextWidthEx ....................................................................................................65
7.54 MfSdkGuiTextOutEx ........................................................................................................66
7.55 MfSdkGuiSetTextStyle ....................................................................................................66
7.56 MfSdkGuiSelectPageEx .................................................................................................67
7.57 MfSdkGuiSelectPageExT .............................................................................................. 67
7.58 MfSdkGuiSelectPageCb ................................................................................................ 68
7.59 MfSdkGuiTitleColorBackground ....................................................................................68
7.60 MfSdkGuiTitleColorForeground .................................................................................... 69
7.61 MfSdkGuiTitleFont ...........................................................................................................69
7.62 MfSdkGuiMenuHightlineColor .......................................................................................69

Fujian MoreFun Electronic Technology Co.,Ltd.

7.63 MfSdkGuiTextOutLineCenter .........................................................................................70
7.64 MfSdkGuiTextOutLineRight ........................................................................................... 70
7.65 MfSdkGuiTextOutLineLeft .............................................................................................. 71
7.66 MfSdkGuiTextOutWinCenter ......................................................................................... 71
7.67 MfSdkGuiClearRect ........................................................................................................ 72
7.68 MfSdkGuiMessageBoxShowEx .................................................................................... 72
7.69 MfSdkGuiSetTitle .............................................................................................................73
7.70 MfSdkGuiTextOutHighlight .............................................................................................73
7.71 MfSdkGuiRectHighlight .................................................................................................. 73
7.72 MfSdkGuiDefaultMsgFuncAdd ......................................................................................74
7.73 MfSdkGuiMainMenuItemAdd ........................................................................................ 74
7.74 MfSdkGuiMainMenuItemDel ......................................................................................... 75
7.75 MfSdkGuiKeyGetEvent .................................................................................................. 75
7.76 MfSdkGuiWifiSetPage .................................................................................................... 75
7.77 MfSdkGuiSetProcs ..........................................................................................................76
7.78 MfSdkGuiSignExist ......................................................................................................... 76
7.79 MfSdkGuiSignProc ..........................................................................................................77
7.80 MfSdkGuiSignPrint ..........................................................................................................77
7.81 MfSdkGuiSignEncode .................................................................................................... 77
7.82 MfSdkGuiSignEncodeFree ............................................................................................ 78
7.83 MfSdkGuiSignClean ........................................................................................................78
7.84 MfSdkGuiSignSavetofile ................................................................................................ 79
7.85 MfSdkGuiSetPowerfullColor ..........................................................................................79
7.86 MfSdkGuiStateFuncAdd .................................................................................................79
7.87 MfSdkGuiCleartState ...................................................................................................... 80
7.88 MfSdkGuiOutStateBitsColor ..........................................................................................80
7.89 MfSdkGuiGetDefineColor .............................................................................................. 81
7.90 MfSdkGuiSetCurlSocketIcon .........................................................................................81
7.91 MfSdkGuiRefreshMod .................................................................................................... 81
8 Printer module ............................................................................................................................. 82
8.1 Module description ............................................................................................................ 82
8.2 Module structure declaration ........................................................................................... 82
8.3 Constant declarations ....................................................................................................... 82
8.4 MfSdkPrtInit ........................................................................................................................ 83
8.5 MfSdkPrtStr ........................................................................................................................ 83
8.6 MfSdkPrtBitMap ................................................................................................................. 84
8.7 MfSdkPrtStart ..................................................................................................................... 84
8.8 MfSdkPrtStrBold ................................................................................................................ 85
8.9 MfSdkPrtFeed .................................................................................................................... 85
8.10 MfSdkPrtMatrixCode .......................................................................................................86
8.11 MfSdkPrtSetFontEN ........................................................................................................86
8.12 MfSdkPrtSetFontCN ....................................................................................................... 87
8.13 MfSdkPrtSetDensity ........................................................................................................87
8.14 MfSdkPrtSetAlign ............................................................................................................ 88

Fujian MoreFun Electronic Technology Co.,Ltd.

8.15 MfSdkPrtSetLineAlign .....................................................................................................88
8.16 MfSdkPrtStrLine ...............................................................................................................88
8.17 MfSdkPrtSetLineSpace .................................................................................................. 89
8.18 MfSdkPrtSetFontMode ................................................................................................... 89
8.19 MfSdkPrtCheckNopaper ................................................................................................ 89
8.20 MfSdkPrtSetArabicNumOrder ....................................................................................... 90
9 Pinpad module ............................................................................................................................ 90
9.1 Module description ............................................................................................................ 90
9.2 Module structure declaration ........................................................................................... 90
9.3 Constant declarations ....................................................................................................... 91
9.4 MfSdkPedSetKeySize .......................................................................................................93
9.5 MfSdkPedGetKeySize ...................................................................................................... 93
9.6 MfSdkPedDukptLoadKey ................................................................................................. 94
9.7 MfSdkPedDukpt3desRun .................................................................................................94
9.8 MfSdkPedDukptGetKsn ....................................................................................................95
9.9 MfSdkPedMkSkSavePlaintextKey ..................................................................................96
9.10 MfSdkPedMkSkSaveEncryptedKey .............................................................................96
9.11 MfSdkPedMkSkGetKcv .................................................................................................. 97
9.12 MfSdkPedMkSk3desRun ............................................................................................... 98
9.13 MfSdkPedMacProc ......................................................................................................... 98
9.14 MfSdkPedEncryptPinProc ............................................................................................. 99
9.15 MfSdkPedSetPinModeCfgInit ......................................................................................100
9.16 MfSdkPedSetPinModeCfg ........................................................................................... 100
9.17 MfSdkPedEncryptPinProcEx .......................................................................................101
9.18 MfSdkPedGetPinModeCfg ...........................................................................................102
9.19 MfSdkPedGetPinModeStatus ..................................................................................... 102
9.20 MfSdkPedSaveRsaPriKey ........................................................................................... 103
9.21 MfSdkPedSaveRsaPukKey ......................................................................................... 103
9.22 MfSdkPedRsaBlock ...................................................................................................... 104
9.23 MfSdkPedDeleteKey .....................................................................................................104
9.24 MfSdkPedTr31GetData ................................................................................................ 105
9.25 MfSdkPedRkiDukptLoad .............................................................................................. 105
9.26 MfSdkPedRkiCheckAppKey ........................................................................................105
9.27 MfSdkPedSetPinpad .....................................................................................................106
9.28 MfSdkPedGetPinpad .................................................................................................... 106
9.29 MfSdkPedSetPedUi ...................................................................................................... 107
9.30 MfSdkPedCheckCardOnce ......................................................................................... 107
9.31 MfSdkPedIsWithPinpad ................................................................................................108
9.32 MfSdkPedExPinpadUpdate ......................................................................................... 108
9.33 MfSdkPedGetExPinpadVersion .................................................................................. 109
9.34 MfSdkPedGetExPinpadInfo .........................................................................................109
9.35 MfSdkPedSetPedPinMod .............................................................................................110
9.36 MfSdkPedGetPin ........................................................................................................... 110
9.37 MfSdkPedTR31LoadKBPK .......................................................................................... 111

Fujian MoreFun Electronic Technology Co.,Ltd.

9.38 MfSdkPedDukptLoadEncryptedKeyByTR31 ............................................................ 111
9.39 MfSdkPedDukptLoadEncryptedKeyByTR31A ......................................................... 112
9.40 MfSdkPedMkskSaveEncryptedKeyByTR31 ............................................................. 112
9.41 MfSdkPedSetTransKey ................................................................................................ 113
9.42 MfSdkPedGetTransKeyKvc ......................................................................................... 114
9.43 MfSdkPedSaveEncryptedMKByTransKey ................................................................ 114
9.44 MfSdkPedDeleteTransKey ...........................................................................................114
9.45 MfSdkPedRebootCmd ..................................................................................................115
9.46 MfSdkPedGotoMainPage .............................................................................................115
9.47 MfSdkPedAesSavePlaintextKey .................................................................................115
9.48 MfSdkPedTr31LoadAesKey ........................................................................................ 116
9.49 MfSdkPedMkSkAesRun ............................................................................................... 116
10 Communication module .........................................................................................................117
10.1 Module description ........................................................................................................ 117
10.2 Module structure declaration ....................................................................................... 117
10.3 Constant declarations ................................................................................................... 117
10.4 MfSdkCommLinkState ..................................................................................................121
10.5 MfSdkCommGetNetMode ............................................................................................121
10.6 MfSdkCommAtcCell ......................................................................................................121
10.7 MfSdkCommAtcCellInfor ..............................................................................................122
10.8 MfSdkCommAtcCpin .................................................................................................... 122
10.9 MfSdkCommAtcGetLocalIp ......................................................................................... 123
10.10 MfSdkCommAtcIccid .................................................................................................. 123
10.11 MfSdkCommAtcImei ................................................................................................... 124
10.12 MfSdkCommAtcImsi ................................................................................................... 124
10.13 MfSdkCommAtcLac .................................................................................................... 124
10.14 MfSdkCommAtcGetMcc .............................................................................................125
10.15 MfSdkCommAtcGetMnc ............................................................................................ 125
10.16 MfSdkCommAtcLacInfor ............................................................................................ 125
10.17 MfSdkCommAtcSignal ............................................................................................... 126
10.18 MfSdkCommGetAtcGeneration ................................................................................ 126
10.19 MfSdkCommGetAtcPower .........................................................................................126
10.20 MfSdkCommAtcSendCmd .........................................................................................127
10.21 MfSdkCommGetNetSelect ........................................................................................ 127
10.22 MfSdkCommGetOperateId ........................................................................................128
10.23 MfSdkCommGetWifiPower ........................................................................................128
10.24 MfSdkCommGsmGetSignal ...................................................................................... 128
10.25 MfSdkCommHttpDownload ....................................................................................... 129
10.26 MfSdkCommMbedtlsInit .............................................................................................129
10.27 MfSdkCommNetLink ...................................................................................................130
10.28 MfSdkCommNetLinkWithUserInfo ........................................................................... 130
10.29 MfSdkCommNetUnlink ...............................................................................................131
10.30 MfSdkCommSetApMode ........................................................................................... 131
10.31 MfSdkCommSetApnList .............................................................................................131

Fujian MoreFun Electronic Technology Co.,Ltd.

10.32 MfSdkCommSetApnListMcc ..................................................................................... 132
10.33 MfSdkCommSetAtcPower ......................................................................................... 132
10.34 MfSdkCommSetInitApn ..............................................................................................133
10.35 MfSdkCommSetNetMode .......................................................................................... 133
10.36 MfSdkCommSetNetSelect .........................................................................................134
10.37 MfSdkCommSetWifiName .........................................................................................134
10.38 MfSdkCommSocketClose ..........................................................................................134
10.39 MfSdkCommSocketConnect ..................................................................................... 135
10.40 MfSdkCommSocketConnectPriority ........................................................................ 135
10.41 MfSdkCommSocketCreate ........................................................................................136
10.42 MfSdkCommSocketFifoResize ................................................................................. 136
10.43 MfSdkCommSocketRecv ...........................................................................................136
10.44 MfSdkCommSocketSend ...........................................................................................137
10.45 MfSdkCommSslAuthMode ........................................................................................ 137
10.46 MfSdkCommSslClose ................................................................................................ 138
10.47 MfSdkCommSslConnect ............................................................................................139
10.48 MfSdkCommSslInit ..................................................................................................... 139
10.49 MfSdkCommSslSetHostname .................................................................................. 140
10.50 MfSdkCommSslMbedtls .............................................................................................140
10.51 MfSdkCommSslRecv ..................................................................................................141
10.52 MfSdkCommSslSend ................................................................................................. 141
10.53 MfSdkCommSslSend2 ............................................................................................... 142
10.54 MfSdkCommUartClear ............................................................................................... 142
10.55 MfSdkCommUartClose .............................................................................................. 143
10.56 MfSdkCommUartGetRxBufLength ...........................................................................143
10.57 MfSdkCommUartOpen ...............................................................................................144
10.58 MfSdkCommUartRecv ................................................................................................144
10.59 MfSdkCommUartSend ............................................................................................... 145
10.60 MfSdkCommUartSetupComm .................................................................................. 145
10.61 MfSdkCommWifiClearListApNum ............................................................................ 146
10.62 MfSdkCommWifiGetApMac .......................................................................................146
10.63 MfSdkCommWifiGetChannel .................................................................................... 146
10.64 MfSdkCommWifiGetLinkState .................................................................................. 147
10.65 MfSdkCommWifiGetLocalip ...................................................................................... 147
10.66 MfSdkCommWifiGetLocalMac ..................................................................................147
10.67 MfSdkCommWifiGetRssi ........................................................................................... 148
10.68 MfSdkCommWifiGetSignal ........................................................................................148
10.69 MfSdkCommWifiGetSsid ........................................................................................... 149
10.70 MfSdkCommWifiLinkAp ............................................................................................. 149
10.71 MfSdkCommWifiListAp .............................................................................................. 149
10.72 MfSdkCommWifiListApQuit ....................................................................................... 150
10.73 MfSDkCommWifiListNetWork ................................................................................... 150
10.74 MfSdkCommWifiRemoveNetWorkAp ...................................................................... 151
10.75 MfSdkCommWifiSetPower ........................................................................................ 151

Fujian MoreFun Electronic Technology Co.,Ltd.

10.76 MfSdkCommWifiSetScan .......................................................................................... 151
10.77 MfSdkCommWifiUnlinkAp ......................................................................................... 152
10.78 MfSdkCommSet4gMode ............................................................................................152
10.79 MfSdkCommWifiCheckState .....................................................................................152
10.80 MfSdkCommWifiStartConfig ..................................................................................... 153
10.81 MfSdkCommUartInit ................................................................................................... 153
10.82 MfSdkCommLanCableCheck ....................................................................................154
10.83 MfSdkCommLanSetDHCP ........................................................................................ 154
10.84 MfSdkCommLanIsDHCP ........................................................................................... 154
10.85 MfSdkCommLanCfg ................................................................................................... 155
10.86 MfSdkCommGetSwitchSimProcStatus ................................................................... 155
10.87 MfSdkCommSetOperateIdTask ................................................................................ 156
10.88 MfSdkCommWifiPageInitMode .................................................................................156
10.89 MfSdkCommWifiPageInit ...........................................................................................156
10.90 MfSdkCommAtcPageInit ............................................................................................157
10.91 MfSdkCommAtcPageInitMode ..................................................................................157
10.92 MfSdkCommLanEnable ............................................................................................. 158
10.93 MfSdkCommLanDisenable ........................................................................................158
10.94 MfSdkCommAtcGetIp .................................................................................................158
10.95 MfSdkCommLanGetEthernetPower ........................................................................ 159
10.96 MfSdkCommLanSetEthernetPower ......................................................................... 159
10.97 MfSdkCommLanChipExist .........................................................................................159
10.98 MfSdkCommWifiChipExist .........................................................................................160
10.99 MfSdkCommAtcSetNetMode .................................................................................... 160
10.100 MfSdkCommAtcSendAtCmd ...................................................................................161
10.101 MfSdkCommLanGetIpAndMask .............................................................................161
10.102 MfSdkCommLanGetGateway ................................................................................. 161
10.103 MfSdkCommLanGetDns ..........................................................................................162
10.104 MfSdkCommLanGetMac ......................................................................................... 162
10.105 MfSdkCommConfigReset ........................................................................................163
10.106 MfSdkCommWifiStopConfig ................................................................................... 163
10.107 MfSdkCommWifiRestart .......................................................................................... 163
10.108 MfSdkCommSetPingAddr ....................................................................................... 164
10.109 MFSdkCommSocketGetModelType ...................................................................... 164
11 EMV module ............................................................................................................................ 164
11.1 Module description ........................................................................................................ 164
11.2 Module structure declaration ....................................................................................... 165
11.3 Constant declarations ................................................................................................... 166
11.4 MfSdkEmvKernelInit ......................................................................................................169
11.5 MfSdkEmvTerminalConfigInit ...................................................................................... 170
11.6 MfSdkEmvCardLoop ..................................................................................................... 170
11.7 MfSdkEmvCardProc ......................................................................................................171
11.8 MfSdkEmvGetCard ....................................................................................................... 171
11.9 MfSdkEmvGoOnChip ....................................................................................................172

Fujian MoreFun Electronic Technology Co.,Ltd.

11.10 MfSdkEmvSetAid .........................................................................................................172
11.11 MfSdkEmvDeleteOneAid ............................................................................................173
11.12 MfSdkEmvClearAllAid ................................................................................................ 173
11.13 MfSdkEmvGetAidNum ................................................................................................174
11.14 MfSdkEmvSetCapk ..................................................................................................... 174
11.15 MfSdkEmvDeleteAllCapk ...........................................................................................174
11.16 MfSdkEmvGetCapkNum ............................................................................................ 175
11.17 MfSdkEmvGetCapkByIndex ...................................................................................... 175
11.18 MfSdkEmvGetDataByTag .......................................................................................... 176
11.19 MfSdkEmvGetKernelData ..........................................................................................176
11.20 MfSdkEmvGetDataByTag .......................................................................................... 177
11.21 MfSdkEmvPackTLVData ............................................................................................177
11.22 MfSdkEmvSetKernelData .......................................................................................... 178
11.23 MfSdkEmvSetDRL ...................................................................................................... 178
11.24 MfSdkEmvClearDRLFile ............................................................................................ 179
11.25 MfSdkEmvMatchErrCode .......................................................................................... 179
11.26 MfSdkEmvOnlineRespPack ...................................................................................... 180
11.27 MfSdkEmvCardFree ................................................................................................... 180
11.28 MfSdkEmvAddCardBlackList .................................................................................... 181
11.29 MfSdkEmvDelCardBlackList ......................................................................................181
11.30 MfSdkEmvGetVersion ................................................................................................ 181
11.31 MfSdkEmvGetEntryVersion ....................................................................................... 182
11.32 MfSdkEmvGetContactlessVersion ........................................................................... 182
11.33 MfSdkEmvSetCallBackFunction ............................................................................... 183
11.34 MfSdkEmvReadCardPage .........................................................................................183
11.35 MfSdkEmvSetSelectAppCallback .............................................................................184
11.36 MfSdkEmvOfflinePinCallback ....................................................................................184
11.37 MfSdkEmvOnlinePinCallback ................................................................................... 184
11.38 MfSdkEmvSetReadPageCallback ............................................................................185
11.39 MfSdkEmvSetRuPay2ndTapCallback ......................................................................185
11.40 MfSdkEmvSetDpas2ndTapCallback ........................................................................ 186
11.41 MfSdkEmvGetPageWin ..............................................................................................186
11.42 MfSdkEmvSetPreprocessOtherDataCallback ........................................................186
11.43 MfSdkEmvGetPageWinTip ........................................................................................ 187
11.44 MfSdkEmvGetProcInfo ............................................................................................... 187
11.45 MfSdkEmvCallbackEventSetAmtBeforeGpo ..........................................................187
11.46 MfSdkEmvCallbackEventGetAmtBeforeGpo ......................................................... 188
11.47 MfSdkEmvCallbackEventClear ................................................................................. 188
11.48 MfSdkEmvCallbackEventClear ................................................................................. 188
11.49 MfSdkEmvGetEmvL2KernelName ........................................................................... 189
11.50 MfSdkEmvGetAidsInit .................................................................................................189
11.51 MfSdkEmvGetAid ........................................................................................................ 189
11.52 MfSdkEmvGetAidsFree ..............................................................................................190
11.53 MfSdkEmvSetTlv2Kernel ........................................................................................... 190

Fujian MoreFun Electronic Technology Co.,Ltd.

12 System module ....................................................................................................................... 191
12.1 Module description ........................................................................................................ 191
12.2 Module structure declaration ....................................................................................... 191
12.3 Constant declarations ...................................................................................................191
12.4 MfSdkSysGetDevModel ............................................................................................... 194
12.5 MfSdkSysGetDevModelName .................................................................................... 194
12.6 MfSdkSysDevIs ............................................................................................................. 195
12.7 MfSdkSysGetHardwareVer ..........................................................................................195
12.8 MfSdkSysGetTime ........................................................................................................ 196
12.9 MfSdkSysAppIsLock ..................................................................................................... 196
12.10 MfSdkSysAuxlcdGetBrightness ................................................................................197
12.11 MfSdkSysAuxlcdSetBrightness .................................................................................197
12.12 MfSdkSysSubAuxlcdGetBrightness .........................................................................197
12.13 MfSdkSysSubAuxlcdSetBrightness ......................................................................... 198
12.14 MfSdkSysBatterCharge ............................................................................................. 198
12.15 MfSdkSysGetBatterStatus .........................................................................................198
12.16 MfSdkSysBuzzerSound ............................................................................................. 199
12.17 MfSdkSysCheckKey ................................................................................................... 199
12.18 MfSdkSysCheckTick ...................................................................................................200
12.19 MfSdkSysClrKey ......................................................................................................... 200
12.20 MfSdkSysConfig ..........................................................................................................200
12.21 MfSdkSysCurlInit .........................................................................................................201
12.22 MfSdkSysDelay ........................................................................................................... 201
12.23 MfSdkSysEnergySetTime .......................................................................................... 202
12.24 MfSdkSysEnergyTime ................................................................................................ 202
12.25 MfSdkSysEraseSecureArea ......................................................................................202
12.26 MfSdkSysFileSetPath .................................................................................................203
12.27 MfSdkSysGetBatterLevel ...........................................................................................203
12.28 MfSdkSysGetDateTime ..............................................................................................203
12.29 MfSdkSysGetIsLcd ..................................................................................................... 204
12.30 MfSdkSysGetLcdType ................................................................................................204
12.31 MfSdkSysGetPsn ........................................................................................................ 205
12.32 MfSdkSysGetTerminalInfo ......................................................................................... 205
12.33 MfSdkSysGetTermSn ................................................................................................. 205
12.34 MfSdkSysGetTerminalSn ...........................................................................................206
12.35 MfSdkSysGetTick ........................................................................................................206
12.36 MfSdkSysGetTickDiff ..................................................................................................206
12.37 MfSdkSysGetTimeStamp ...........................................................................................207
12.38 MfSdkSysGuiGroupGetObj ....................................................................................... 207
12.39 MfSdkSysHttpDownload ............................................................................................ 208
12.40 MfSdkSysHttpDownloadUseAgent .......................................................................... 208
12.41 MfSdkSysInit ................................................................................................................ 208
12.42 MfSdkSysLcdCalibration ............................................................................................209
12.43 MfSdkSysLogoInit ....................................................................................................... 209

Fujian MoreFun Electronic Technology Co.,Ltd.

12.44 MfSdkSysLogoInitA .................................................................................................... 210
12.45 MfSdkSysModelType ..................................................................................................210
12.46 MfSdkSysNetSetDatacallType .................................................................................. 211
12.47 MfSdkSysPrintAdd ...................................................................................................... 211
12.48 MfSdkSysReadFlashData ..........................................................................................211
12.49 MfSdkSysReadSecureArea .......................................................................................212
12.50 MfSdkSysReboot ........................................................................................................ 212
12.51 MfSdkSysRfidEmulateConfig ....................................................................................213
12.52 MfSdkSysRfidEmulateDeinit ..................................................................................... 213
12.53 MfSdkSysRfidEmulateInit .......................................................................................... 214
12.54 MfSdkSysRfidEmulateProcess ................................................................................. 214
12.55 MfSdkSysRun .............................................................................................................. 214
12.56 MfSdkSysSetDateTime .............................................................................................. 215
12.57 MfSdkSysSetLanguage ............................................................................................. 215
12.58 MfSdkSysSetLogData ................................................................................................ 216
12.59 MfSdkSysSetScrBackLight ........................................................................................216
12.60 MfSdkSysSleep ........................................................................................................... 216
12.61 MfSdkSysStart ............................................................................................................. 217
12.62 MfSdkSysTaskAppSet ................................................................................................ 217
12.63 MfSdkSysTaskCreate ................................................................................................. 218
12.64 MfSdkSysTimerCheck ................................................................................................ 218
12.65 MfSdkSysTimerClose ................................................................................................. 218
12.66 MfSdkSysTimerCreate ............................................................................................... 219
12.67 MfSdkSysTimerEnable ...............................................................................................219
12.68 MfSdkSysTimerDelete ................................................................................................220
12.69 MfSdkSysTimerOpen ................................................................................................. 220
12.70 MfSdkSysTtsSystemSetFunc ................................................................................... 221
12.71 MfSdkSysUnzipFileFunc ............................................................................................221
12.72 MfSdkSysVersion ........................................................................................................ 221
12.73 MfSdkSysWriteFlashData ..........................................................................................222
12.74 MfSdkSysWriteSecureArea .......................................................................................222
12.75 MfSdkSysZipUpdate ................................................................................................... 223
12.76 MfSdkSysDriverLibInit ................................................................................................ 223
12.77 MfSdkSysTaskAppInit .................................................................................................223
12.78 MfSdkSysPubDriverInit .............................................................................................. 224
12.79 MfSdkSysFontInit ........................................................................................................ 224
12.80 MfSdkSysConsoleSwitch ...........................................................................................225
12.81 MfSdkSysThreadMutexInit ........................................................................................ 225
12.82 MfSdkSysThreadMutexLock ..................................................................................... 225
12.83 MfSdkSysThreadMutexUnlock ................................................................................. 226
12.84 MfSdkSysThreadMutexDestroy ................................................................................226
12.85 MfSdkSysGetSegmentLcdDisplayMaxLength ....................................................... 226
12.86 MfSdkSysIsExternalFlash ..........................................................................................227
12.87 MfSdkSysSetForceSleepTime .................................................................................. 227

Fujian MoreFun Electronic Technology Co.,Ltd.

12.88 MfSdkSysSetSleepToPoweroff ................................................................................. 227
12.89 MfSdkSysGetHeapInformation ................................................................................. 228
12.90 MfSdkSysSetRestartEnabledOnce .......................................................................... 228
13 File System module ................................................................................................................229
13.1 Module description ........................................................................................................ 229
13.2 Module structure declaration ....................................................................................... 229
13.3 Constant declarations ...................................................................................................229
13.4 MfSdkFsSetPath ............................................................................................................230
13.5 MfSdkFsCheckPath ...................................................................................................... 231
13.6 MfSdkFsClean ............................................................................................................... 231
13.7 MfSdkFsClose ................................................................................................................231
13.8 MfSdkFsDelete .............................................................................................................. 232
13.9 MfSdkFsGetFreeSpace ................................................................................................232
13.10 MfSdkFsGetTotalSpace ............................................................................................. 233
13.11 MfSdkFsGetModuleVer .............................................................................................. 233
13.12 MfSdkFsLseek ............................................................................................................. 233
13.13 MfSdkFsMkdir ..............................................................................................................234
13.14 MfSdkFsOpen ..............................................................................................................234
13.15 MfSdkFsPathClean ..................................................................................................... 236
13.16 MfSdkFsRead .............................................................................................................. 237
13.17 MfSdkFsReadLine ...................................................................................................... 237
13.18 MfSdkFsReadProfileInt .............................................................................................. 237
13.19 MfSdkFsReadProfileString ........................................................................................ 238
13.20 MfSdkFsUnlink .............................................................................................................238
13.21 MfSdkFsWrite .............................................................................................................. 239
13.22 MfSdkFsWriteSync ..................................................................................................... 239
13.23 MfSdkFsWriteBlockByName ..................................................................................... 240
13.24 MfSdkFsWriteProfileInt .............................................................................................. 240
13.25 MfSdkFsWriteProfileString ........................................................................................ 241
13.26 MfSdkFsRenamePath ..................................................................................................... 241
13.27 MfSdkFsClearFile ...........................................................................................................242
13.28 MfSdkFsDelDirFiles .......................................................................................................242
13.29 MfSdkFsRenameA ..........................................................................................................242
13.30 MfSdkFsGetFileLength .................................................................................................. 243
13.31 MfSdkFsRmdir ............................................................................................................. 243
13.32 MfSdkFsOpenDir ..........................................................................................................244
13.33 MfSdkFsReadDir .......................................................................................................... 244
13.34 MfSdkFsCloseDir ......................................................................................................... 245
14 FIFO module ............................................................................................................................246
14.1 Module description ........................................................................................................ 246
14.2 Module structure declaration ....................................................................................... 246
14.3 Constant declarations ...................................................................................................246
14.4 MfSdkFifoCreate ............................................................................................................247
14.5 MfSdkFifoGet ................................................................................................................. 247

Fujian MoreFun Electronic Technology Co.,Ltd.

14.6 MfSdkFifoInit .................................................................................................................. 248
14.7 MfSdkFifoIsEmpty ......................................................................................................... 248
14.8 MfSdkFifoIsFull .............................................................................................................. 249
14.9 MfSdkFifoPut ..................................................................................................................249
14.10 MfSdkFifoResize ......................................................................................................... 250
14.11 MfSdkGetFifoNum .......................................................................................................250
14.12 MfSdkGetGetFifoSize .................................................................................................251
15 Audio module ...........................................................................................................................251
15.1 Module description ........................................................................................................ 251
15.2 Module structure declaration ....................................................................................... 251
15.3 Constant declarations ...................................................................................................252
15.4 MfSdkAudPlayVoice ......................................................................................................253
15.5 MfSdkAudPlayAmt ........................................................................................................ 253
15.6 MfSdkAudPlayBatteryLevel ......................................................................................... 254
15.7 MfSdkAudPlayFile ......................................................................................................... 254
15.8 MfSdkAudPlay ............................................................................................................... 254
15.9 MfSdkAudPlayNum ....................................................................................................... 255
15.10 MfSdkAudPlayNumber ...............................................................................................255
15.11 MfSdkAudPlayPayResult ........................................................................................... 255
15.12 MfSdkAudPlayPayType ............................................................................................. 256
15.13 MfSdkAudPlayUnit ...................................................................................................... 256
15.14 MfSdkAudTtsState ...................................................................................................... 256
15.15 MfSdkAudBatchBegin ................................................................................................ 257
15.16 MfSdkAudBathcEnd ....................................................................................................257
15.17 MfSdkAudClear ........................................................................................................... 258
15.18 MfSdkAudTtsPlay ........................................................................................................258
15.19 MfSdkAudSetVolume ..................................................................................................258
15.20 MfSdkAudSetVolumeRunning .................................................................................. 259
15.21 MfSdkAudGetVolume ................................................................................................. 259
15.22 MfSdkAudSetSpeed ................................................................................................... 259
16 KeyBoard module ................................................................................................................... 260
16.1 Module description ........................................................................................................ 260
16.2 Module structure declaration ....................................................................................... 260
16.3 Constant declarations ...................................................................................................260
16.4 MfSdkKbKeySetParam .................................................................................................261
16.5 MfSdkKbGetKeySound ................................................................................................ 261
16.6 MfSdkKbSetKeySound .................................................................................................262
16.7 MfSdkKbWaitKey ...........................................................................................................262
17 Lcd module .............................................................................................................................. 262
17.1 Module description ........................................................................................................ 262
17.2 Module structure declaration ....................................................................................... 262
17.3 Constant declarations ...................................................................................................263
17.4 MfSdkLcdBackLight ...................................................................................................... 263
17.5 MfSdkLcdSegmentBackLight ...................................................................................... 264

Fujian MoreFun Electronic Technology Co.,Ltd.

17.6 MfSdkLcdGetSubProbe ................................................................................................264
17.7 MfSdkLcdSetIndex ........................................................................................................ 265
17.8 MfSdkLcdGetPowerDownTime ...................................................................................265
17.9 MfSdkLcdSetPowerDownTime ................................................................................... 265
17.10 MfSdkLcdGetBackLightTime .....................................................................................266
17.11 MfSdkLcdSetBackLightTime ..................................................................................... 266
17.12 MfSdkLcdGetFrontBackLightTime ........................................................................... 266
17.13 MfSdkLcdSetFrontBackLightTime ............................................................................267
17.14 MfSdkLcdGetRearBackLightTime ............................................................................ 267
17.15 MfSdkLcdSetRearBackLightTime ............................................................................ 267
17.16 MfSdkLcdBrightnessLevelSettings .......................................................................... 268
17.17 MfSdkLcdAutoFlush ....................................................................................................268
17.18 MfSdkLcdSetNormalDirection ...................................................................................269
17.19 MfSdkLcdArrowDisplay .............................................................................................. 269
17.20 MfSdkLcdBacklightIsBright ........................................................................................269
18 Log module .............................................................................................................................. 270
18.1 Module description ........................................................................................................ 270
18.2 Module structure declaration ....................................................................................... 270
18.3 Constant declarations ...................................................................................................270
18.4 MfSdkLogSoundSet ...................................................................................................... 270
18.5 MfSdkLog ........................................................................................................................271
18.6 MfSdkLogTip .................................................................................................................. 271
18.7 MfSdkLogHexBuff ......................................................................................................... 272
18.8 MfSdkLogLevel .............................................................................................................. 272
18.9 MfSdkLogOutputSwitch ................................................................................................273
19 Power module ......................................................................................................................... 273
19.1 Module description ........................................................................................................ 273
19.2 Module structure declaration ....................................................................................... 273
19.3 Constant declarations ...................................................................................................273
19.4 MfSdkPowerResumeProc ............................................................................................274
19.5 MfSdkPowerManagerSetFunc .................................................................................... 275
19.6 MfSdkPowerLockApp ................................................................................................... 275
19.7 MfSdkPowerUnlockApp ................................................................................................275
19.8 MfSdkPowerTaskInit ..................................................................................................... 276
19.9 MfSdkPowerTaskSuspend ...........................................................................................276
19.10 MfSdkPowerReset ...................................................................................................... 276
19.11 MfSdkPowerPageCb ...................................................................................................277
19.12 MfSdkPowerPageInit .................................................................................................. 277
19.13 MfSdkPowerSetTime .................................................................................................. 278
19.14 MfSdkPowerOff ........................................................................................................... 278
19.15 MfSdkPowerKeySetLight ........................................................................................... 278
19.16 MfSdkPowerGetBatteryPercentage .........................................................................279
19.17 MfSdkPowerSetBacklightTime ..................................................................................279
19.18 MfSdkPowerSupertimeReset ....................................................................................279

Fujian MoreFun Electronic Technology Co.,Ltd.

19.19 MfSdkPowerSwitchResetTick ................................................................................... 280
19.20 MfSdkPowerSleepSwitch ...........................................................................................280
20 QR module ...............................................................................................................................281
20.1 Module description ........................................................................................................ 281
20.2 Module structure declaration ....................................................................................... 281
20.3 Constant declarations ...................................................................................................281
20.4 MfSdkQrDecode ............................................................................................................ 281
20.5 MfSdkQrScannerClose .................................................................................................282
20.6 MfSdkQrScannerGetImg ..............................................................................................282
20.7 MfSdkQrScannerOpen ................................................................................................. 282
20.8 MfSdkQrSetScanBoxPosition ..................................................................................... 283
20.9 MfSdkQrScannerStart .................................................................................................. 283
20.10 MfSdkQrScannerStop ................................................................................................ 283
20.11 MfSdkQrScannerSetPreview .....................................................................................284
21 TMS module ............................................................................................................................ 284
21.1 Module description ........................................................................................................ 284
21.2 Module structure declaration ....................................................................................... 284
21.3 Constant declarations ...................................................................................................284
21.4 MfSdkTmsSetProgressCallback ................................................................................. 286
21.5 MfSdkTmsSetResultCallback ......................................................................................287
21.6 MfSdkTmsHeartBeat .................................................................................................... 287
21.7 MfSdkTmsUpdate ..........................................................................................................288
21.8 MfSdkTmsUpdateFile ................................................................................................... 288
21.9 MfSdkTmsAppBusy ...................................................................................................... 288
21.10 MfSdkTmsCheckTimeDisable ...................................................................................289
21.11 MfSdkTmsGetMsg .......................................................................................................289
21.12 MfSdkTmsGetResult .................................................................................................. 289
21.13 MfSdkTmsSetSig .........................................................................................................290
21.14 MfSdkTmsUpdateOta .................................................................................................290
21.15 MfSdkTmsSetConnectRetryCnt ............................................................................... 291
21.16 MfSdkTmsSetErrorRetryCnt ..................................................................................... 291
21.17 MfSdkTmsEnable ........................................................................................................291
21.18 MfSdkTmsSetActionCallback ....................................................................................292
21.19 MfSdkTmsEnableSyncTime ..........................................................................................292
22 LVGL module ............................................................................................................................ 293
22.1 Module description ........................................................................................................ 293
22.2 Module structure declaration ....................................................................................... 293
22.3 Constant declarations ...................................................................................................293
22.4 MfSdkLvglInit ..................................................................................................................295
22.5 MfSdkLvglGetPageBody .............................................................................................. 295
22.6 MfSdkLvglExit ................................................................................................................ 295
22.7 MfSdkLvglCls ................................................................................................................. 296
22.8 MfSdkLvglClsEnableStatusBar ................................................................................... 296
22.9 MfSdkLvglEnableDefaultStatusBarIcons .................................................................. 297

Fujian MoreFun Electronic Technology Co.,Ltd.

22.10 MfSdkLvglClearLine ....................................................................................................297
22.11 MfSdkLvglGetStatusBarHeight ................................................................................. 297
22.12 MfSdkLvglCreateButtons ........................................................................................... 298
22.13 MfSdkLvglClearAll .......................................................................................................298
22.14 MfSdkLvglWaitKey ...................................................................................................... 298
22.15 MfSdkLvglWaitKeyMs .................................................................................................299
22.16 MfSdkLvglClrKeyFlag .................................................................................................299
22.17 MfSdkLvglCheckKey .................................................................................................. 300
22.18 MfSdkLvglGetKey ....................................................................................................... 300
22.19 MfSdkLvglDispTextCoord .......................................................................................... 300
22.20 MfSdkLvglDispTextLine ..............................................................................................301
22.21 MfSdkLvglDispMenuText ........................................................................................... 301
22.22 MfSdkLvglDispMenuIcon ........................................................................................... 302
22.23 MfSdkLvglDispButton ................................................................................................. 302
22.24 MfSdkLvglMessageBox ............................................................................................. 303
22.25 MfSdkLvglDispList ...................................................................................................... 303
22.26 MfSdkLvglDispRollpage .............................................................................................304
22.27 MfSdkLvglInputText .................................................................................................... 304
22.28 MfSdkLvglInputTextEx ................................................................................................305
22.29 MfSdkLvglDispBar ...................................................................................................... 305
22.30 MfSdkLvglUpdateBar ..................................................................................................306
22.31 MfSdkLvglDispLed ...................................................................................................... 306
22.32 MfSdkLvglUpdateLed ................................................................................................. 307
22.33 MfSdkLvglShowQrcode ............................................................................................. 307
22.34 MfSdkLvglShowQrcodeEx ......................................................................................... 308
22.35 MfSdkLvglShowImage ................................................................................................308
22.36 MfSdkLvglShowImageEx ........................................................................................... 309
22.37 MfSdkLvglShowImagebuff .........................................................................................309
22.38 MfSdkLvglShowScreenCanves ................................................................................ 310
22.39 MfSdkLvglDrawLine ....................................................................................................310
22.40 MfSdkLvglDrawBox .....................................................................................................311
22.41 MfSdkLvglEsign ...........................................................................................................311
22.42 MfSdkLvglScan ............................................................................................................312
22.43 MfSdkLvglDispDialog ................................................................................................. 312
22.44 MfSdkLvglUpdateDialog ............................................................................................ 313
22.45 MfSdkLvglCloseDialog ............................................................................................... 313
22.46 MfSdkLvglDispRollpageEx ........................................................................................ 313
22.47 MfSdkLvglDispMultipleChoice .................................................................................. 314
22.48 MfSdkLvglDispSetSlider ............................................................................................ 314
22.49 MfSdkLvglDispSetResult ........................................................................................... 315
22.50 MfSdkLvglInputPin ...................................................................................................... 315
22.51 MfSdkLvglDispAnimation ...........................................................................................316
22.52 MfSdkLvglCloseAnimation .........................................................................................316
22.53 MfSdkLvglCreateStatusBarTask ...............................................................................317

Fujian MoreFun Electronic Technology Co.,Ltd.

22.54 MfSdkLvglSetStatusBarIcon ..................................................................................... 317
22.55 MfSdkLvglQuickSetStatusBarIcon ........................................................................... 318
22.56 MfSdkLvglSetStatusBar ............................................................................................. 318
22.57 MfSdkLvglGetUiBuff ................................................................................................... 318
22.58 MfSdkLvglLoadPng .....................................................................................................319
22.59 MfSdkLvglFreePng ..................................................................................................... 319
22.60 MfSdkLvglGuiInit ......................................................................................................... 320
22.61 MfSdkLvglGroupSet ....................................................................................................320
23 Memory module ...................................................................................................................... 320
23.1 Module description ........................................................................................................ 320
23.2 Module structure declaration ....................................................................................... 320
23.3 Constant declarations ...................................................................................................320
23.4 MfSdkMemFree ............................................................................................................. 321
23.5 MfSdkMemMalloc ..........................................................................................................321
23.6 MfSdkMemRealloc ........................................................................................................ 321
23.7 MfSdkMemCalloc .......................................................................................................... 322
24 Base module .............................................................................................................................322
24.1 Module description ........................................................................................................ 322
24.2 Module structure declaration ....................................................................................... 322
24.3 Constant declarations ...................................................................................................322
24.4 MfSdkBaseCheck ..........................................................................................................322

Fujian MoreFun Electronic Technology Co.,Ltd.

Document history version

Date

Version

Remark

2025-04-02

V1.6

1. update to MFSDK V1.7.4

2024-05-31

V1.5

1. Added MfSdkFsRmdir

2. Added MfSdkFsOpenDir

3. Added MfSdkFsReadDir

4. Added MfSdkFsCloseDir

2024-05-31

V1.4

1.Add APIs description

2024-02-20

V1.3

1.Add Pinpad-related apis

Author

MoreFun SDK

group

MoreFun SDK

group

MoreFun SDK

group

MoreFun SDK

group

2024-02-20

V1.2

1. Added

API MfSdkFsRenamePath

and

MoreFun SDK

MfSdkFsGetFileLength

group

2. API

MfSdkFsOpenadd

descriptive

information;

3. MfSdkLcdSetPowerDownTime

input

parameter unit second;

4. MfSdkCommSocketConnect input parameter

timeout unit ms;

2024-02-17

V1.1

1.MfSdkCommAtcCpin

add

descriptive

MoreFun SDK

information;

group

2.MfSdkQrDecode modify the return value type;

3.Added MfSdkTmsSetSig API whether to enable

the signature verification function;

4.Added

MfSdkVerGetSecHwVer/MfSdkVerGetSecFwVer;

2023-12-31

V1.0

First version

5.MfSdkPrtSetLineSpace;

MoreFun SDK

group

1

Fujian MoreFun Electronic Technology Co.,Ltd.

1 Global

1.1 Module description

The definition of the global description.

1.2 Module structure declaration

None.

1.3 Constant declarations

# define MFSDK_UNUSED(x) ((void)(x))
# define MFSDK_COND_RET(__cond__,__retValue__) do{ if(__cond__)

\

{ return __retValue__; } }while(0)

# define MFSDK_FALSE (0)
# define MFSDK_TRUE (1)

typedef int MFSDKBOOL;

typedef uint64_t u64;
typedef int64_t s64;
typedef unsigned int u32;
typedef signed int s32;
typedef unsigned short u16;
typedef signed short s16;
typedef unsigned char u8;
typedef signed char s8;

typedef enum
{

MFSDK_RET_FAILED = -3, //failed
MFSDK_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_RET_PARM_ERROR = -1, //check param
MFSDK_RET_OK = 0,

}MfSdkRet_E;

2 Version module

2.1 Module description

This module mainly includes APIs for getting versions.

2

Fujian MoreFun Electronic Technology Co.,Ltd.

2.2 Module structure declaration

None.

2.3 Constant declarations

None.

2.4 MfSdkVerGetDataVersion

Prototype

LIB_EXPORT s8* MfSdkVerGetDataVersion()

Function

Get data lib version

Params

in
out

return
remark

Nothing

Nothing

version string

char* data_version = NULL;

data_version = MfSdkVerGetDataVersion();

demo

2.5 MfSdkVerMfOsVersion

Prototype LIB_EXPORT s8* MfSdkVerMfOsVersion()

Function Get MoreFun OS SDK version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char* osVersion = NULL;

osVersion = MfSdkVerMfOsVersion();

3

Fujian MoreFun Electronic Technology Co.,Ltd.

2.6 MfSdkVerGetAppVer

Prototype LIB_EXPORT const s8 *MfSdkVerGetAppVer()

Function Get App version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char* appVersion = NULL;

appVersion = MfSdkVerGetAppVer();

2.7 MfSdkVerGetBootVer

Prototype LIB_EXPORT const s8 *MfSdkVerGetBootVer()

Function Get boot version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char* bootVersion = NULL;

bootVersion = MfSdkVerGetBootVer();

2.8 MfSdkVerGetDriverVer

Prototype LIB_EXPORT const s8 *MfSdkVerGetDriverVer()

Function Get driver version

Params

in
out

Nothing

Nothing

return

version string

4

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

char* driverVersion = NULL;

driverVersion = MfSdkVerGetDriverVer();

2.9 MfSdkVerGetSysVer

Prototype LIB_EXPORT const s8 *MfSdkVerGetSysVer()

Function Get system version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char* sysVersion = NULL;

sysVersion = MfSdkVerGetSysVer();

2.10 MfSdkVerGetSpVer

Prototype LIB_EXPORT const s8 *MfSdkVerGetSpVer()

Function Get sp version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char* spVersion = NULL;

spVersion = MfSdkVerGetSpVer();

2.11 MfSdkVerSetAppVersion

Prototype LIB_EXPORT s32 MfSdkVerSetAppVersion(s8 *pszVer)

5

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Set application version.

Params

in
out

pszVer

Nothing

app version string

return
remark

demo

0

Success

char* appVer = V1.0.0;

MfSdkVerSetAppVersion(appVer);

2.12 MfSdkVerGetSecHwVer

Prototype LIB_EXPORT s8 *MfSdkVerGetSecHwVer()

Function get pci hardware version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char *ver = (char*)MfSdkVerGetSecHwVer();

2.13 MfSdkVerGetSecFwVer

Prototype LIB_EXPORT s8 *MfSdkVerGetSecFwVer()

Function Get pci firmware version

Params

in
out

return
remark

demo

Nothing

Nothing

version string

char *ver = (char*)MfSdkVerGetSecFwVer();

6

Fujian MoreFun Electronic Technology Co.,Ltd.

3 Util module

3.1 Module description

This module mainly includes encoding type conversion and other util

APIs.

3.2 Module structure declaration

//QR code parameters
typedef struct
{

s32 nVersion;
s32 nLevel;
s32 moudleWidth;
} MfSdkUtilQrInfo_T;

//< version number:1~40

//< Error correction level: 0-low, 1-in, 2-high, 3-maximum

///< Module width (unit: pixel)

3.3 Constant declarations

typedef enum
{

MFSDK_UTIL_RET_FAILED = -3, //failed
MFSDK_UTIL_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_UTIL_RET_PARM_ERROR = -1, //check param
MFSDK_UTIL_RET_OK = 0,

}MfSdkUtilRet_E;

typedef enum {

MFSDK_UTIL_MD_SHA1,
MFSDK_UTIL_MD_SHA256,
MFSDK_UTIL_MD_SHA512,

/**< The SHA-1 message digest. */
/**< The SHA-256 message digest. */
/**< The SHA-512 message digest. */

} MfSdkUtilMDType_E;

3.4 MfSdkUtilGetModuleVer

Prototype LIB_EXPORT s32 MfSdkUtilGetModuleVer(s8 *pszVer)

Function Get util module version

Params

in
out

return

Nothing

pszVer

Others

Module version

Failed, Ref. MfSdkUtilRet_E

7

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_UTIL_RET_
OK

Success

remark

char utilVersion[20] = {0};

demo

int ret = -1;

ret = MfSdkUtilGetModuleVer(utilVersion);

3.5 MfSdkUtilAsc2Bcd

Prototype

LIB_EXPORT s32 MfSdkUtilAsc2Bcd(s8 *AscBuf, s8 *BcdBuf, s32
AscLen)

Function ASCII code to BCD code

Params

in

out

AscLen

AscBuf

BcdBuf

Others

Incoming ASCII code data length

ASCII code data to be converted

Conversion output BCD code data

Failed, Ref. MfSdkUtilRet_E

return

remark

demo

MFSDK_UTIL_RET_
OK

Success

char *AscBuf = "1234";

char BcdBuf[3] = {0};

int ret = -1;

ret = MfSdkUtilAsc2Bcd(AscBuf, BcdBuf, strlen(AscBuf));

3.6 MfSdkUtilBcd2Asc

Prototype

LIB_EXPORT s32 MfSdkUtilBcd2Asc(s8 *BcdBuf, s8 *AscBuf, s32
AscLen)

Function BCD code to ASCII code

Params

in

out

return

AscLen

BcdBuf

AscBuf

Others

The length of ASCII code data, that is the double
length of BCD code data

BCD code data to be converted

Conversion output ASCII code data

Failed, Ref. MfSdkUtilRet_E

MFSDK_UTIL_RET_ Success

8

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

OK

char AscBuf[9] = {0};

char *BcdBuf = "\x12\x23";

int ret = -1;

ret = MfSdkUtilBcd2Asc(BcdBuf, AscBuf, 2);

APP_TRACE("MfSdkUtilBcd2Asc:%s\r\n",AscBuf);

Result: MfSdkUtilBcd2Asc:12

3.7 MfSdkUtilHex2Asc

Prototype

LIB_EXPORT s32 MfSdkUtilHex2Asc(u8* pszBcdBuf, s32 AscLen,
s8 cAlignment, u8* pszAsciiBuf)

Function Hex code to ASCII code

Params

in

out

return

remark

demo

AscLen

The length of ASCII code data, that is the double
length of Bcd code data

cAlignment

Alignment

pszBcdBuf

Bcd code data to be converted

AscBuf

Others

Conversion output ASCII code data

Failed

MFSDK_UTIL_RET_
OK

Success

char AscBuf[9] = {0};

char *BcdBuf = "\x12\x23";

int ret = -1;

memset(AscBuf,0,sizeof(AscBuf));

MfSdkUtilHex2Asc(BcdBuf, 4, 1, AscBuf);

APP_TRACE("MfSdkUtilHex2Asc1:%s\r\n",AscBuf);

memset(AscBuf,0,sizeof(AscBuf));

MfSdkUtilHex2Asc(BcdBuf, 4, 0, AscBuf);

APP_TRACE("MfSdkUtilHex2Asc2:%s\r\n",AscBuf);

memset(AscBuf,0,sizeof(AscBuf));

MfSdkUtilHex2Asc(BcdBuf, 3, 1, AscBuf);

APP_TRACE("MfSdkUtilHex2Asc3:%s\r\n",AscBuf);

memset(AscBuf,0,sizeof(AscBuf));

MfSdkUtilHex2Asc(BcdBuf, 3, 0, AscBuf);

APP_TRACE("MfSdkUtilHex2Asc4:%s\r\n",AscBuf);

Result:

9

Fujian MoreFun Electronic Technology Co.,Ltd.

MfSdkUtilHex2Asc1:1223

MfSdkUtilHex2Asc2:1223

MfSdkUtilHex2Asc3:223

MfSdkUtilHex2Asc4:122

3.8 MfSdkUtilInt2Bcd

Prototype

LIB_EXPORT s32 MfSdkUtilInt2Bcd(u32 IntData, s8 *BcdBuf, s32
BcdLen)

Function Int data transfer to BCD code

Params

in

out

return

remark

BcdLen

IntData

BcdBuf

Others

Length of BCD code data after conversion

Int data to be converted

BCD data after conversion

Failed, Ref. MfSdkUtilRet_E

MFSDK_UTIL_RET_
OK

Success

s8 bcdbuf[16] = {0};

MfSdkUtilInt2Bcd(123,bcdbuf, 2);

APP_TRACE_BUFF_TIP(bcdbuf, 2, "MfSdkUtilInt2Bcd1");

memset(bcdbuf,0,sizeof(bcdbuf));

MfSdkUtilInt2Bcd(123,bcdbuf, 4);

demo

APP_TRACE_BUFF_TIP(bcdbuf, 4, "MfSdkUtilInt2Bcd4");

Result:

MfSdkUtilInt2Bcd1

01 23

MfSdkUtilInt2Bcd4

00 00 01 23

3.9 MfSdkUtilBcd2Int

Prototype

LIB_EXPORT s32 MfSdkUtilBcd2Int( s8 *BcdBuf, u32 *IntData,s32
BcdLen)

Function BCD code to int type

Params

in

BcdLen

BcdBuf

BCD code data length

BCD data to be converted

10

Fujian MoreFun Electronic Technology Co.,Ltd.

out

IntData

Others

Int data after conversion

Failed, Ref. MfSdkUtilRet_E

return

remark

MFSDK_UTIL_RET
_OK

Success

u32 IntData = 0;

char *BcdBuf = "\x12\x23";

int ret = -1;

demo

ret = MfSdkUtilBcd2Int(BcdBuf, &IntData , 2);

APP_TRACE("MfSdkUtilBcd2Int:%d\r\n",IntData);

Result:

MfSdkUtilBcd2Int:1223

3.10 MfSdkUtilGenLrc

Prototype LIB_EXPORT u8 MfSdkUtilGenLrc(s8 *Data, s32 DataLen)

Function

Calculates LRC and generates LRC parity bits (bitwise exclusive
or)

Params

in

return
remark

Data

Data to be calculated for LRC check bits

DataLen

Data length

LRC

The LRC check value generated by calculation

char* Data = xxxxxxxxxx;

demo

unsigned char LRC;

LRC = MfSdkUtilGenLrc(Data, strlen(Data));

3.11 MfSdkUtilDes

Prototype

LIB_EXPORT s32 MfSdkUtilDes(u8 bDesType, u8 bDesMode, s8
*Key, s8 *InData, s32 DataLen, s8 *OutData)

Function

DES encryption and decryption to DES data encryption and
decryption, or 3DES encryption and decryption

Params

in

bDesType

DES encryption and decryption algorithm:
0 denotes DES encryption,
1 denotes DES decryption,
2 denotes 3DES encryption(16 bytes key),
3 denotes 3DES decryption(16 bytes key),
11

Fujian MoreFun Electronic Technology Co.,Ltd.

bDesMode

Key

InData

4 denotes 3DES encryption(24 bytes key),
5 denotes 3DES decryption(24 bytes key).
0 ECB 1 CBC

Used for encryption and decryption of
transmission keys, must be 8 times

Input data to be encrypted or decrypted must
be 8 times bytes

DataLen

The length of input data

out

OutData

The key after encryption and decryption must
be 8 bytes

Others

Failed, Ref. MfSdkUtilRet_E

MFSDK_UTIL_RET_
OK

Success

return

remark

demo

3.12 MfSdkUtilBeep

Prototype LIB_EXPORT void MfSdkUtilBeep(s32 num)

Function

Buzzing success indicates buzzing when successful, non
blocking

Params

in

num

Buzz times

return
remark

demo

Nothing

MfSdkUtilBeep(100);

3.13 MfSdkUtilBuzzerSound

Prototype LIB_EXPORT void MfSdkUtilBuzzerSound(s32 nMillisecond)

Function Set the buzzer ringing time

Params

in
out

return

nMillisecond

ringing time(Unit millisecond)

Nothing

Nothing

12

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

MfSdkUtilBuzzerSound(100);

3.14 MfSdkUtilGetRand

Prototype LIB_EXPORT s32 MfSdkUtilGetRand(s32 len, u8* pBuf)

Function Generating random numbers

Params

in
out

len

pBuf

random number len

random number string

Others

Failed, Ref. MfSdkUtilRet_E

return

remark

MFSDK_UTIL_RET
_OK

Success

unsigned char randomNumberStr[6] = {0};

demo

int ret = -1;

ret = MfSdkUtilGetRand(5, randomNumberStr );

3.15 MfSdkUtilSHA1

Prototype

LIB_EXPORT s32 MfSdkUtilSHA1(const u8* psSrc, u32 nSrcLen,
u8* psDst)

Function SHA1 calculation

Params

in

out

psSrc

Source buffer

nSrcLen

Source length

psDst

Others

Result of SHA1

Failed, Ref. MfSdkUtilRet_E

return

remark

demo

MFSDK_UTIL_RET_
OK

Success

unsigned char* psSrc = "demotest";

unsigned char psDst[20+1] = {0};

int ret = -1;

ret = MfSdkUtilSHA1((const unsigned char*)psSrc, strlen(psSrc), psDst);

13

Fujian MoreFun Electronic Technology Co.,Ltd.

3.16 MfSdkUtilGeneCodePic

Prototype

LIB_EXPORT s32 MfSdkUtilGeneCodePic(s8 * chData, s32 iLen,
MfSdkUtilQrInfo_T *qrparam , s8 * bitmap)

Function QR code generation

Params

in

out

return

remark

chData

iLen

QR code data

Data length

qrparam

QR code parameters

bitmap

Others

>0

Generated two-dimensional code dot matrix data

Failed, Ref. MfSdkUtilRet_E

Successfully generated QR code width

# define QR_HEIGHT 80

MfSdkUtilQrInfo_T qrparam;

char *bitmap = MALLOC(QR_HEIGHT*QR_HEIGHT/8);

char *qrData = "http://en.morefun-et.com";

int length = strlen(qrData);

int width = 0;

int Qr_width = MfSdkGuiGetWidth();

demo

qrparam.nVersion = 0; //auto

qrparam.nLevel = 0;

qrparam.moduleWidth = 1;

while(qrparam.moudleWidth > 0 && (width <= 0 || width > Qr_heith))

{

}

memset(bitmap , 0 , QR_HEIGHT*QR_HEIGHT/8);

width = MfSdkUtilGeneCodePic(data , length, &qrparam, bitmap);

qrparam.moudleWidth --;

3.17 MfSdkUtilLed

Prototype LIB_EXPORT void MfSdkUtilLed(s32 num, s32 type)

Function LED light control

14

Fujian MoreFun Electronic Technology Co.,Ltd.

LED light number
(0 red, 1 blue, 2 yellow, 3 green)
LED light switch(0 close, 1 open)

num

type

Nothing

Nothing

MfSdkUtilLed(1,1); // open blue led

Params

in

out

return
remark

demo

3.18 MfSdkUtilStr2Longlong

Prototype LIB_EXPORT long long MfSdkUtilStr2Longlong(const s8 *amt)

Function String to long long

Params

in
out

amt

Nothing

amount string

return
remark

demo

long long

amount in long long type

char *amt = "1533352";

long long amt = MfSdkUtilStr2Longlong((const char*)amt);

3.19 MfSdkUtilMd5File

Prototype

LIB_EXPORT s32 MfSdkUtilMd5File(const s8* pszFilePath, u8*
pOutMD5)

Function File MD5 value calculation

Params

in
out

pszFilePath

File Path

pOutMD5

MD5 result

MFSDK_FALSE file not found

MFSDK_TRUE

success

return

remark

# define FILE_TEST "data\\test.txt"

demo

unsigned char *pOutMD5 = NULL;

int ret = MfSdkUtilMd5File(FILE_TEST, pOutMD5);

15

Fujian MoreFun Electronic Technology Co.,Ltd.

3.20 MfSdkUtilUtf8str2Astr

Prototype

LIB_EXPORT s32 MfSdkUtilUtf8str2Astr(char *utfstr, s32 utfchars,
u8*astr,s32 buffsize)

Function Utf-8 string to ASCII string

Params

in

out

return

remark

demo

utfstr

utfchars

buffsize

astr

utf-8 string

utf-8 string length

astr buffer size

out ascii string

Others

Failed, Ref. MfSdkUtilRet_E

>0

ascii length

char AscBuf[50] = {0};

char *utfstr= test;

int ret = -1;

ret = MfSdkUtilUtf8str2Astr(utfstr, strlen(utfstr), AscBuf, sizeof(AscBuf));

3.21 MfSdkUtilUnicodeToUtf8

Prototype

LIB_EXPORT s32 MfSdkUtilUnicodeToUtf8(u16 codepoint, s8
*outstr)

Function Unicode data transfer to utf-8 code

Params

in
out

return

remark

demo

codepoint

Unicode data to be converted

outstr

Others

>0

utf-8 data after conversion

Failed, Ref. MfSdkUtilRet_E

The length of outstr

char utfstr[50] = {0};

char *unicode= test;

int utflen= -1;

utflen = MfSdkUtilUnicodeToUtf8((unsigned short)unicode, utfstr);

16

Fujian MoreFun Electronic Technology Co.,Ltd.

3.22 MfSdkUtilUtf8ToUnicode

Prototype LIB_EXPORT s32 MfSdkUtilUtf8ToUnicode(u8 *instr, u8 *outstr)

Function utf-8 code data transfer to Unicode

Params

in

out

return

remark

instr

outstr

Others

>0

utf-8 data to be converted

Unicode data after conversion

Failed, Ref. MfSdkUtilRet_E

The length of outstr

char unicodestr[50] = {0};

demo

char *utfstr= test;

int unilen= -1;

unilen = MfSdkUtilUtf8ToUnicode(utfstr, unicodestr);

3.23 MfSdkUtilTlvGetDataByTag

Prototype

LIB_EXPORT s32 MfSdkUtilTlvGetDataByTag(u8*tagName,u8
*pInBuf,s32 inBufLength,u8 *pValue, s32 valueLength)

Function Get TLV data by tag

tagName

pInBuf

tag name eg. "\x9F\x02"

tlv bytes stream

inBufLength

tlv bytes stream length

valueLength

pValue buffer size

pValue

Others

>0

tagName value

Failed, Ref. MfSdkUtilRet_E

pValue length

Params

in

out

return

remark

demo

17

Fujian MoreFun Electronic Technology Co.,Ltd.

3.24 MfSdkUtilCtrlBeep

Prototype LIB_EXPORT void MfSdkUtilCtrlBeep(int ms, int hz)

Function Set the buzzer ringing time and Hz

Params

in

out

return
remark

demo

beep time ms

beep hz

ms

hz

Nothing

Nothing

//750Hz ringing 500ms

MfSdkUtilCtrlBeep(500,750);

3.25 MfSdkUtilGenRsa

Prototype

LIB_EXPORT s32 MfSdkUtilGenRsa(s32 keyBits,u8 *privPem, s32
privPemLength,u8 *pubPem, s32 pubPemLength,s32 timeoutMs)

Function

Generate RSA public and private keys.
The exponent is fixed at 65537

keyBits

RSA key bits

privPemLength

privPem buffer size

pubPemLength

pubPem buffer size

timeoutMs

timeout ms

privPem

pubPem

private key, format is pem

public key format is pem

Others

Failed, Ref. MfSdkUtilRet_E

0

Success

Params

in

out

return

remark

demo

3.26 MfSdkUtilGenRsaKey

Prototype

LIB_EXPORT s32 MfSdkUtilGenRsaKey(u8 index,s32 keyBits,s32
timeoutMs)

18

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Generate RSA key

index

keyBits

index

1024 - 4096 bits

timeoutMs

timeout ms

Nothing

0

Success

Other

Failed, Ref. MfSdkUtilRet_E

Params

in

out

return

remark

demo

3.27 MfSdkUtilRsaSign

Prototype

LIB_EXPORT s32 MfSdkUtilRsaSign(u8
index ,MfSdkUtilMDType_E mdAlg, u8* hash , s32 hashLength,u8*
signData,s32 signDataLength)

Function Generate RSA signature

Params

index

mdAlg

hash

hashLength

signData

signDataLength

in

out

Ref. MfSdkUtilMDType_E

Others

Failed, Ref. MfSdkUtilRet_E

>0

Success

return

remark

demo

3.1 MfSdkUtilRsaGetPublicKey

Prototype

LIB_EXPORT s32 MfSdkUtilRsaGetPublicKey(u8 index , u8
*pubPem, s32 pubPemLength)

Function Get RSA public key

Params

in

index

19

pubPemLength

out

pubPem

0

Fujian MoreFun Electronic Technology Co.,Ltd.

key string

Success

Others

Failed, Ref. MfSdkUtilRet_E

return

remark

demo

3.2 MfSdkUtilGenRsaDelKey

Prototype LIB_EXPORT s32 MfSdkUtilGenRsaDelKey(u8 index)

Function Delete index RSA key

Params

in
out

index

Nothing

MFSDK_UTIL_RET_
OK

Success

Others

Failed, Ref. MfSdkUtilRet_E

return

remark

demo

3.3 MfSdkUtilGenRsaDelAllKey

Prototype LIB_EXPORT s32 MfSdkUtilGenRsaDelAllKey(void)

Function Delete all RSA key

Params

in
out

Nothing

Nothing

MFSDK_UTIL_RET_
OK

Success

Others

Failed, Ref. MfSdkUtilRet_E

return

remark

demo

20

Fujian MoreFun Electronic Technology Co.,Ltd.

3.4 MfSdkUtilRsaRand

Prototype

LIB_EXPORT s32 MfSdkUtilRsaRand(void* para, u8* pbuf, u32
len)

Function For mbedtls rand

para

pbuf

len

Nothing

Others

Failed, Ref. MfSdkUtilRet_E

0

Success

Params

in

out

return

remark

demo

3.5 MfSdkUtilCompress

Prototype

LIB_EXPORT s32 MfSdkUtilCompress (u8*dest, u32 *destLen,
const u8* source, u32 sourceLen)

Function

Params

in

out

return

remark

demo

Compresses the source buffer into the destination buffer. The
level parameter has the same meaning as in deflateInit.
sourceLen is the byte length of the source buffer. Upon entry,
destLen is the total size of the destination buffer, which must be
at least 0.1% larger than sourceLen plus 12 bytes. Upon exit,
destLen is the actual size of the compressed buffer.

destLen

source

sourceLen

destLen

dest

Others

Failed, Ref. MfSdkUtilRet_E

MFSDK_UTIL_RET_
OK

Success

21

Fujian MoreFun Electronic Technology Co.,Ltd.

3.6 MfSdkUtilCompressBound

Prototype LIB_EXPORT u32 MfSdkUtilCompressBound (u32 sourceLen)

Function get compress bound

Params

in
out

sourceLen

Nothing

compress bound
value

return

remark

demo

3.7 MfSdkUtilSave2Zip

Prototype

LIB_EXPORT s32 MfSdkUtilSave2Zip(const char *zip_filename,
const char *file_name_in_zip, const u8 *data, u32 data_len)

Function save data to zip file

Params

zip_filename

zip file name

file_name_in_zip compress data file name

data

compress data

data_len

Nothing

compress data length

in

out

Others

Failed, Ref. MfSdkUtilRet_E

MFSDK_UTIL_RET_
OK

Success

return

remark

demo

4 RFID module

4.1 Module description

This module mainly includes NFC APIs.

22

Fujian MoreFun Electronic Technology Co.,Ltd.

4.2 Module structure declaration

None.

4.3 Constant declarations

typedef enum
{

MFSDK_NFC_RET_MUTILCARD = MFSDK_ICC_RET_MUTILCARD,

// more than one card

MFSDK_NFC_RET_NOCARD = MFSDK_ICC_RET_NOCARD, // dont

find card

MFSDK_NFC_RET_FAILED = MFSDK_ICC_RET_FAILED, //failed
MFSDK_NFC_RET_BOUNDS = MFSDK_ICC_RET_BOUNDS, //Array

out-of-bounds

MFSDK_NFC_RET_PARM_ERROR =

MFSDK_ICC_RET_PARM_ERROR, //check param

MFSDK_NFC_RET_OK = 0,

}MfSdkNfcRet_E;

typedef enum
{

MFSDK_NFC_LED_BLUE = 0,
MFSDK_NFC_LED_YELLOW,
MFSDK_NFC_LED_GREEN,
MFSDK_NFC_LED_RED,

}MfSdkNfcLed_E;

typedef enum
{

MFSDK_NFC_LED_OFF = 0,
MFSDK_NFC_LED_ON = 1,

}MfSdkNfcLedSwitch_E;

4.4 MfSdkNfcInit

Prototype LIB_EXPORT s32 MfSdkNfcInit(void)

Function Initialization of the NFC module.

Params

in
out

None

None

23

Fujian MoreFun Electronic Technology Co.,Ltd.

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.5 MfSdkNfcApdu

Prototype

LIB_EXPORT s32 MfSdkNfcApdu(u8 *tbuf, u16 tlen, u8 **rbuf, u16
*rlen)

Function NFC APDU exchange.

Params

in

out

tbuf

tlen

rbuf

rlen

MFSDK_NFC_RET_FAIL
ED

MFSDK_NFC_RET_PAR
M_ERROR

apdu request command

apdu request command length

eg. unsigned char *pTemp &pTemp

pdu response length point

Failed, Ref. MfSdkNfcRet_E

Invalid parameters.

return

remark

demo

MFSDK_NFC_ETR_OK Success

s32 iRet = MFSDK_NFC_RET_FAILED;

u8 *pRApdu = NULL;

u16 rApduLength = 0;

u8 cApud[] =

{

};

0x00,0xA4,0x04,0x00,0x0E,0x32,0x50,0x41,

0x59,0x2E,0x53,0x59,0x53,0x2E,0x44,0x44,

0x46,0x30,0x31,0x00

iRet = MfSdkNfcApdu(cApud,sizeof(cApud),&pRApdu , &rApduLength);

if(MFSDK_NFC_RET_OK == iRet)

//Success TODO

{

}

else

24

Fujian MoreFun Electronic Technology Co.,Ltd.

{

}

//Fail

4.6 MfSdkNfcClose

Prototype LIB_EXPORT s32 MfSdkNfcClose(void)

Function Turn off the NFC module.

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_OK Success

Params

in
out

return

remark

demo

4.7 MfSdkNfcCtlsComm

Prototype

LIB_EXPORT s32 MfSdkNfcCtlsComm(s32
iCardType,MfSdkIccApdu_T *Apdu)

Function NFC Ctls command

iCardType

Apdu

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_OK Success

Params

in

out

return

remark

demo

4.8 MfSdkNfcCtlsPowerDown

Prototype LIB_EXPORT s32 MfSdkNfcCtlsPowerDown(void)

25

Fujian MoreFun Electronic Technology Co.,Ltd.

Function NFC Ctls Power Down

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_OK Success

Params

in
out

return

remark

demo

4.9 MfSdkNfcCtlsPowerUpAndSeek

Prototype

LIB_EXPORT s32 MfSdkNfcCtlsPowerUpAndSeek(int iCardType,
char *psUID)

Function NFC Ctls Power Up and seek

iCardType

psUID

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_OK Success

Params

in

out

return

remark

demo

4.10 MfSdkNfcDetect

Prototype LIB_EXPORT s32 MfSdkNfcDetect(void)

Function Check the user whether tap card .

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

return

MFSDK_NFC_RET_NOC
ARD

No card

MFSDK_NFC_RET_MUTI
LCARD

multiple card

26

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_NFC_RET_OK Success

remark

demo

4.11 MfSdkNfcApduStream

Prototype

LIB_EXPORT s32 MfSdkNfcApduStream(u8 *pC_Apdu, s32 clen,
u8 *pR_Apdu, s32 rlen)

Function Bytes stream apdu command

Params

in

out

pC_Apdu

CAPDU bytes stream

clen

rlen

CAPDU bytes stream length

recv buffer size

pR_Apdu

RAPDU recv buffer

Others

> 0

Failed, Ref. MfSdkNfcRet_E

R_Apdu length

return

MFSDK_ICC_RET_PARM_E
RROR

params error

MFSDK_ICC_RET_BOUNDS rlen < card response length

remark

demo

4.12 MfSdkNfcGetUid

Prototype LIB_EXPORT s32 MfSdkNfcGetUid(u8* uid)

Function Get card UID

Params

in
out

uid

None

Others

Failed, Ref. MfSdkNfcRet_E

> 0

uid length

return

remark

demo

27

Fujian MoreFun Electronic Technology Co.,Ltd.

4.13 MfSdkNfcIsProbe

Prototype LIB_EXPORT s32 MfSdkNfcIsProbe(void)

Function Check whether the NFC card is detected

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

1

Success

return

remark

demo

4.14 MfSdkNfcM1Atqa

Prototype LIB_EXPORT s32 MfSdkNfcM1Atqa(void)

Function

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.15 MfSdkNfcM1Auth

Prototype LIB_EXPORT s32 MfSdkNfcM1Auth(s32 cmd, s32 block)

Function

Params

in

cmd

28

Fujian MoreFun Electronic Technology Co.,Ltd.

out

block

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.16 MfSdkNfcM1Close

Prototype LIB_EXPORT s32 MfSdkNfcM1Close(void)

Function

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.17 MfSdkNfcM1Decrement

Prototype LIB_EXPORT s32 MfSdkNfcM1Decrement(s32 block, s32 operand)

Function

Params

in

out

return

remark

demo

block

operand

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

29

Fujian MoreFun Electronic Technology Co.,Ltd.

4.18 MfSdkNfcM1Increment

Prototype LIB_EXPORT s32 MfSdkNfcM1Increment(s32 block, s32 operand)

Function

Params

in

out

return

remark

demo

block

operand

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

4.19 MfSdkNfcM1Open

Prototype LIB_EXPORT s32 MfSdkNfcM1Open(void)

Function M1 open

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.20 MfSdkNfcM1Read

Prototype LIB_EXPORT s32 MfSdkNfcM1Read(s32 block, u8* buf, s32 *len)

30

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Params

in

out

return

remark

demo

block

len

buf

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

4.21 MfSdkNfcM1Restore

Prototype LIB_EXPORT s32 MfSdkNfcM1Restore(s32 block)

Function

Params

in
out

block

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.22 MfSdkNfcM1SetKey

Prototype LIB_EXPORT s32 MfSdkNfcM1SetKey(u8 *key)

Function

Params

in
out

key

None

Others

Failed, Ref. MfSdkNfcRet_E

return

MFSDK_NFC_RET_
OK

Success

31

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

4.23 MfSdkNfcM1Transfer

Prototype LIB_EXPORT s32 MfSdkNfcM1Transfer(s32 block)

Function

Params

in
out

block

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.24 MfSdkNfcM1Uid

Prototype LIB_EXPORT s32 MfSdkNfcM1Uid(u8 *uid)

Function

Params

in
out

uid

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.25 MfSdkNfcM1Write

Prototype LIB_EXPORT s32 MfSdkNfcM1Write(s32 block, u8 *buf, s32 len)

32

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Params

in

out

return

remark

demo

block

buf

len

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

4.26 MfSdkNfcOpen

Prototype LIB_EXPORT s32 MfSdkNfcOpen(void)

Function NFC open

Params

in
out

None

None

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.27 MfSdkNfcReset

Prototype LIB_EXPORT s32 MfSdkNfcReset(u8* pAtr, s32 iAtrLength)

Function NFC Reset

Params

in

out

return

pAtr

iAtrLength

None

Others

Failed, Ref. MfSdkNfcRet_E

33

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_NFC_RET_
OK

Success

remark

demo

4.28 MfSdkNfcTagEmulateInitSetData

Prototype

s32 MfSdkNfcTagEmulateInitSetData(s8* data, s32 inDataLen, s8*
code)

Function ntag set data initialization

data

data

inDataLen

data len

code

None

data encoding format(example "utf-8")

Others

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

Params

in

out

return

remark

demo

4.29 MfSdkNfcTagEmulateInitSetUrl

Prototype s32 MfSdkNfcTagEmulateInitSetUrl(u8* url)

Function ntag set url initialization

Params

in
out

url

None

Others

set url

Failed, Ref. MfSdkNfcRet_E

MFSDK_NFC_RET_
OK

Success

return

remark

demo

34

Fujian MoreFun Electronic Technology Co.,Ltd.

4.30 MfSdkNfcTagEmulateProcess

Prototype void MfSdkNfcTagEmulateProcess(void)

Function ntag execution processing

Params

in
out

return
remark

demo

None

None

None

4.31 MfSdkNfcTagEmulateDeinit

Prototype

s32 MfSdkNfcTagEmulateDeinit(void)

Function ntag deinitialization

Params

in
out

None

None

MFSDK_NFC_RET_
OK

Success

return

remark

demo

4.32 MfSdkNfcLed

Prototype

LIB_EXPORT void MfSdkNfcLed(MfSdkNfcLed_E num,

MfSdkNfcLedSwitch_E type)

Function led control

Params

in

num

type

led color, Ref. MfSdkNfcLed_E

switch type, Ref. MfSdkNfcLedSwitch_E

35

Fujian MoreFun Electronic Technology Co.,Ltd.

None

None

out

return
remark

demo

4.33 MfSdkNfcIsAroundFrontLcd

Prototype

LIB_EXPORT MFSDKBOOL MfSdkNfcIsAroundFrontLcd(void)

Function Check whether the NFC antenna is around the LCD

Params

in
out

None

None

MFSDK_TRUE

nfc antenna around lcd

return
remark

demo

5 Magstripe module

5.1 Module description

This module mainly includes Magstripe Card APIs.

5.2 Module structure declaration

None.

5.3 Constant declarations

typedef enum
{

MFSDK_MAG_RET_FAILED = -3, //failed
MFSDK_MAG_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_MAG_RET_PARM_ERROR = -1, //check param
MFSDK_MAG_RET_OK = 0,

}MfSdkMagRet_E;

36

Fujian MoreFun Electronic Technology Co.,Ltd.

5.4 MfSdkMagStripeDetect

Prototype

LIB_EXPORT s32 MfSdkMagStripeDetect(MfSdkMagTraceInfo_T
*trackinfo)

Function Magstripe Card Detect

Params

in
out

trackinfo

None

Others

Failed, Ref. MfSdkMagRet_E

MFSDK_MAG_RET
_OK

Success

return

remark

demo

5.5 MfSdkMagtekClose

Prototype LIB_EXPORT void MfSdkMagtekClose(void)

Function

Params

in
out

return
remark

demo

None

None

None

5.6 MfSdkMagTekFlush

Prototype LIB_EXPORT s32 MfSdkMagTekFlush(void)

Function

Params

in
out

None

None

37

Fujian MoreFun Electronic Technology Co.,Ltd.

Others

Failed, Ref. MfSdkMagRet_E

MFSDK_MAG_RET
_OK

Success

return

remark

demo

5.7 MfSdkMagtekOpen

Prototype LIB_EXPORT void MfSdkMagtekOpen(void)

Function

Params

in
out

return
remark

demo

None

None

None

6

ICC module

6.1 Module description

This module mainly includes ICC APIs.

6.2 Module structure declaration

None.

6.3 Constant declarations

typedef enum
{

MFSDK_ICC_SLOT_MIN = 0,
MFSDK_ICC_SLOT_NFC = MFSDK_ICC_SLOT_MIN, //rfid
MFSDK_ICC_SLOT_NFC_EXTERN , //rfid extern
MFSDK_ICC_SLOT_ICC, //contact ic card slot
MFSDK_ICC_SLOT_ICC_EXTERN, //contact ic card slot extern
MFSDK_ICC_SLOT_PSAM1,

38

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_ICC_SLOT_PSAM2,
MFSDK_ICC_SLOT_PSAM3,
MFSDK_ICC_SLOT_PSAM4,
MFSDK_ICC_SLOT_PSAM5,
MFSDK_ICC_SLOT_PSAM6,
MFSDK_ICC_SLOT_MAX

}MfSdkIccSlot_E;

typedef enum
{

MFSDK_ICC_RET_MUTILCARD = -5, // more than one card
MFSDK_ICC_RET_NOCARD = -4, // dont find card
MFSDK_ICC_RET_FAILED = -3, //failed
MFSDK_ICC_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_ICC_RET_PARM_ERROR = -1, //check param
MFSDK_ICC_RET_OK = 0,

}MfSdkIccRet_E;

typedef enum
{

MFSDK_ICC_TYPE_CPUCARD = 0,

}MfSdkIccType_E;

6.4 MfSdkIccClose

Prototype LIB_EXPORT s32 MfSdkIccClose(MfSdkIccSlot_E iSlotType)

Function

Params

in
out

return

remark

demo

iSlotType

Ref. MfSdkIccSlot_E

None

MFSDK_ICC_RET_
OK

Success

Other

Fail

39

Fujian MoreFun Electronic Technology Co.,Ltd.

6.5 MfSdkIccComm

Prototype

LIB_EXPORT s32 MfSdkIccComm(s32 iCardType,MfSdkIccSlot_E
iSlotType, MfSdkIccApdu_T *Apdu)

Function

Params

in

out

return
remark

demo

iCardType

Ref. MfSdkIccType_E

iSlotType

Ref. MfSdkIccSlot_E

Apdu

None

Ref. MfSdkIccRet_E

6.6 MfSdkIccGetCardATR

Prototype

LIB_EXPORT s32 MfSdkIccGetCardATR(s32 iCardType,
MfSdkIccSlot_E iSlotType, u8 *psATR, s32*pnATRLen)

Function

Params

in

out

return
remark

demo

iCardType

Ref. MfSdkIccType_E

iSlotType

Ref. MfSdkIccSlot_E

psATR

pnATRLen

None

Ref. MfSdkIccRet_E

6.7 MfSdkIccGetCardStatus

Prototype

LIB_EXPORT s32 MfSdkIccGetCardStatus(MfSdkIccSlot_E
iSlotType)

40

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Params

in
out

return
remark

demo

iSlotType

Ref. MfSdkIccSlot_E

None

Ref. MfSdkIccRet_E

6.8 MfSdkIccGetModuleVer

Prototype LIB_EXPORT s32 MfSdkIccGetModuleVer(u8 *pszVer)

Function get module version

Params

in
out

None

pszVer

Icc Module Version

Ref. MfSdkIccRet_E

return
remark

demo

6.9 MfSdkIccInsertDetect

Prototype LIB_EXPORT s32 MfSdkIccInsertDetect(void)

Function

Params

in
out

return
remark

demo

None

None

Ref. MfSdkIccRet_E

41

Fujian MoreFun Electronic Technology Co.,Ltd.

6.10 MfSdkIccApdu

Prototype

LIB_EXPORT s32 MfSdkIccApdu(MfSdkIccSlot_E iSlotType, u8*
pC_Apdu, s32 cLength,u8* pR_Apdu,s32 rLength)

Function apdu bytes stream

Ref. MfSdkIccSlot_E

bytes stream

iSlotType

pC_Apdu

cLength

rLength

pR_Apdu

> 0

R_Apdu length

MFSDK_ICC_RET_PARM_
ERROR

MFSDK_ICC_RET_BOUND
S

params error

rLength < card response length

Params

in

out

return

remark

demo

6.11 MfSdkIccOpen

Prototype LIB_EXPORT s32 MfSdkIccOpen(MfSdkIccSlot_E iSlotType)

Function

Params

in
out

return
remark

demo

iSlotType

Ref. MfSdkIccSlot_E

None

Ref. MfSdkIccRet_E

6.12 MfSdkIccPowerOff

Prototype

LIB_EXPORT s32 MfSdkIccPowerOff(s32 iCardType,
MfSdkIccSlot_E iSlotType)

42

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Params

in

out

return
remark

demo

iCardType

Ref. MfSdkIccType_E

iSlotType

Ref. MfSdkIccSlot_E

None

Ref. MfSdkIccRet_E

6.13 MfSdkIccPowerUp

Prototype

LIB_EXPORT s32 MfSdkIccPowerUp(s32 iCardType,
MfSdkIccSlot_E iSlotType ,u8 *atrstr,s32 buflen)

Function

Params

in

out

return
remark

demo

iCardType

Ref. MfSdkIccType_E

iSlotType

Ref. MfSdkIccSlot_E

buflen

atrstr

Ref. MfSdkIccRet_E

6.14 MfSdkIccPowerOn

Prototype

LIB_EXPORT s32 MfSdkIccPowerOn(s32 iCardType,
MfSdkIccSlot_E iSlotType)

Function

Params

in

out

return
remark

demo

iCardType

Ref. MfSdkIccType_E

iSlotType

Ref. MfSdkIccSlot_E

None

Ref. MfSdkIccRet_E

43

Fujian MoreFun Electronic Technology Co.,Ltd.

7 GUI module

7.1 Module description

This module mainly includes UI APIs.

7.2 Module structure declaration

//MfSdkGuiInputPage Parameters
typedef struct
{
s8* title; //[in] Title displayed in the middle of the first line
s8* msgPrompt; //[in] Prompt information
s8* str; //[out] input data string
s32 disp_mode; //[in] 0:digit input, 1:character input, 2:password input
s32 disp_line; //[in] the number of rows Prompt displayed
s32 input_line; //[in] the number of rows inputs displayed
s32 disp_pattern; //[in] Prompt display position, 0 left alignment, 1 center; 2

right alignment

s32 input_pattern; //[in] inputs display position, 0 left alignment, 1 center; 2

right alignment

s32 min; //[in] minimum input length
s32 max; //[in] maximum input length
s32 timeout; //[in] waiting for input timeout time (seconds)
void (*extra_paint_func)(void *extra_param); //[in] extra painting function on

input page

void* extra_param; //[in] parameter of extra_paint_func
}MfSdkGuinputPageParam_T;

7.3 Constant declarations

None.

7.4 MfSdkGuiLedAmount

Prototype LIB_EXPORT void MfSdkGuiLedAmount(char *msg)

Function Set Amount display

Params

in
out

msg

None

text amount eg. 0.00/1.00

44

Fujian MoreFun Electronic Technology Co.,Ltd.

Nothing

MfSdkGuiLedAmount("0.00");

//show amount on code break screen

return
remark

demo

7.5 MfSdkGuiLedCounter

Prototype LIB_EXPORT void MfSdkGuiLedCounter(char *msg)

Function Show Counter display

Params

in
out

return
remark

demo

3 bytes ascii digit eg. "0"-"999"

msg

None

Nothing

MfSdkGuiLedCounter(0);

7.6 MfSdkGuiLedTime

Prototype LIB_EXPORT void MfSdkGuiLedTime(char *msg)

Function

Params

in
out

return
remark

demo

HHMM eg. "09:00"

msg

None

Nothing

MfSdkGuiLedTime(09:00);

7.7 MfSdkGuiLedDigitShow

Prototype LIB_EXPORT void MfSdkGuiLedDigitShow(char *digit_str)

Function Segment code

45

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

digit_str

None

MFSDK_RET_OK Success

return
remark

demo

7.8 MfSdkGuiBeginBatchPaint

Prototype LIB_EXPORT void MfSdkGuiBeginBatchPaint()

Function Batch refresh starts

Params

in
out

return
remark

None

None

Nothing

MfSdkGuiBeginBatchPaint();

demo

MfSdkGuiClearDc();

//painting APIs

MfSdkGuiEndBatchPaint();

7.9 MfSdkGuiEndBatchPaint

Prototype LIB_EXPORT void MfSdkGuiEndBatchPaint()

Function End of batch refresh

Params

in
out

return
remark

None

None

Nothing

MfSdkGuiBeginBatchPaint();

demo

MfSdkGuiClearDc();

//painting APIs

MfSdkGuiEndBatchPaint();

46

Fujian MoreFun Electronic Technology Co.,Ltd.

7.10 MfSdkGuiSetColor

Prototype LIB_EXPORT void MfSdkGuiSetColor(s32 color)

Function Set the foreground color

the foreground color

color

None

Nothing

Params

in
out

return
remark

demo

7.11 MfSdkGuiGetColor

Prototype LIB_EXPORT s32 MfSdkGuiGetColor()

Function Get the foreground color

Params

in
out

return

remark

demo

None

None

>= 0

Other

success, the foreground color

failure

s32 foreground_color = MfSdkGuiGetColor();

7.12 MfSdkGuiSetBgColor

Prototype LIB_EXPORT void MfSdkGuiSetBgColor(s32 color)

Function Set the background color

Params

in
out

return

color

None

Nothing

the background color

47

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

7.13 MfSdkGuiGetBgColor

Prototype LIB_EXPORT s32 MfSdkGuiGetBgColor()

Function Get the background color

Params

in
out

return

remark

demo

None

None

>= 0

Other

success, the background color

failure

s32 background_color = MfSdkGuiGetBgColor();

7.14 MfSdkGuiSetFullScreen

Prototype LIB_EXPORT void MfSdkGuiSetFullScreen(s32 full)

Function Set to full screen display

Params

in
out

return
remark

demo

is full screen display(1 - Yes, 0 - No)

full

None

Nothing

MfSdkGuiSetFullScreen(1); //set full screen

7.15 MfSdkGuiPixel

Prototype LIB_EXPORT s32 MfSdkGuiPixel(s32 x, s32 y)

Function Draw a point

48

Fujian MoreFun Electronic Technology Co.,Ltd.

x

y

None

0

Other

horizontal coordinate

vertical coordinate

success

failure

Params

in

out

return

remark

s32 ret;

demo

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc();

ret = MfSdkGuiPixel(5 , 5); //draw a point at (5, 5)

MfSdkGuiEndBatchPaint();

7.16 MfSdkGuiLineTo

Prototype LIB_EXPORT s32 MfSdkGuiLineTo(s32 x, s32 y)

Function Draw a line

x

y

None

0

Other

horizontal coordinate

vertical coordinate

success

failure

Params

in

out

return

remark

demo

7.17 MfSdkGuiBarRc

Prototype

LIB_EXPORT void MfSdkGuiBarRc(s32 left, s32 top, s32 right, s32
bottom)

Function Gui filled area

Params

in

left

top

right

left border

upper boundary

right border

bottom

lower boundary

49

Fujian MoreFun Electronic Technology Co.,Ltd.

out

return
remark

demo

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc();

MfSdkGuiBarRc(5, 5, 10, 10);

MfSdkGuiEndBatchPaint();

7.18 MfSdkGuiSetBarColor

Prototype LIB_EXPORT void MfSdkGuiSetBarColor(s32 color)

Function Set the fill color

color

None

Nothing

Params

in
out

return
remark

demo

fill color(format 0x00RRGGBB)

7.19 MfSdkGuiGetBarColor

Prototype LIB_EXPORT s32 MfSdkGuiGetBarColor()

Function Get the fill color

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the fill color

failure

s32 barColor = MfSdkGuiGetBarColor();

50

Fujian MoreFun Electronic Technology Co.,Ltd.

7.20 MfSdkGuiSetFont

Prototype LIB_EXPORT void MfSdkGuiSetFont(s32 font)

Function Set display font

Params

in
out

return
remark

demo

font(0: 12 lattice, 1: 16 lattice)

font

None

Nothing

MfSdkGuiSetFont(0); //set to 12 lattice font

7.21 MfSdkGuiGetFont

Prototype LIB_EXPORT s32 MfSdkGuiGetFont()

Function Get display font

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the display font

failure

s32 font = MfSdkGuiGetFont();

7.22 MfSdkGuiSetTextColor

Prototype LIB_EXPORT void MfSdkGuiSetTextColor(s32 color)

Function Set text color

Params

in
out

return

color

None

Nothing

text color

51

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

7.23 MfSdkGuiGetTextColor

Prototype LIB_EXPORT s32 MfSdkGuiGetTextColor()

Function Get text color

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the text color

failure

s32 textColor = MfSdkGuiGetTextColor();

7.24 MfSdkGuiSetTextBgColor

Prototype LIB_EXPORT void MfSdkGuiSetTextBgColor(s32 color)

Function Set the text background color

text background color

color

None

Nothing

Params

in
out

return
remark

demo

7.25 MfSdkGuiGetTextBgColor

Prototype LIB_EXPORT s32 MfSdkGuiGetTextBgColor()

Function Get the text background color

52

Fujian MoreFun Electronic Technology Co.,Ltd.

None

None

>=0

Other

success, the text background color

failure

s32 textBgColor = MfSdkGuiGetTextBgColor();

Params

in
out

return

remark

demo

7.26 MfSdkGuiClearDc

Prototype LIB_EXPORT void MfSdkGuiClearDc()

Function Clear screen display

Params

in
out

return
remark

None

None

Nothing

MfSdkGuiBeginBatchPaint();

demo

MfSdkGuiClearDc();

//painting APIs

MfSdkGuiEndBatchPaint();

7.27 MfSdkGuiSetTextZoom

Prototype LIB_EXPORT void MfSdkGuiSetTextZoom(s32 size)

Function Set text magnification

Params

in
out

return
remark

demo

multiple, the default value is 2

size

None

Nothing

MfSdkGuiSetTextZoom(4);

53

Fujian MoreFun Electronic Technology Co.,Ltd.

7.28 MfSdkGuiGetTextZoom

Prototype LIB_EXPORT s32 MfSdkGuiGetTextZoom()

Function Get text magnification

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the text magnification

failure

s32 textZoom = MfSdkGuiGetTextZoom();

7.29 MfSdkGuiSetPixel

Prototype LIB_EXPORT s32 MfSdkGuiSetPixel(s32 x, s32 y, s32 color)

Function Draw a point with color

x

y

color

None

0

Other

horizontal coordinate

vertical coordinate

point color

success

failure

Params

in

out

return

remark

demo

7.30 MfSdkGuiGetPixel

Prototype LIB_EXPORT s32 MfSdkGuiGetPixel(s32 x, s32 y)

Function Get the color of the point on the screen

54

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in

out

return

remark

demo

x

y

None

>=0

Other

horizontal coordinate

vertical coordinate

success, point color

failure

s32 pixelColor = MfSdkGuiGetPixel(5, 5); //get the color of point (5, 5)

7.31 MfSdkGuiTextOut

Prototype LIB_EXPORT s32 MfSdkGuiTextOut(s32 x, s32 y, char * text)

Function Display text on the screen ,Show only English

Params

in

out

return

remark

x

y

text

None

0

Other

horizontal coordinate

vertical coordinate

text content

success

failure

s32 ret = -1;

MfSdkGuiBeginBatchPaint();

demo

MfSdkGuiClearDc();

ret = MfSdkGuiTextOut(5, 5, morefun);

MfSdkGuiEndBatchPaint();

7.32 MfSdkGuiGetTextWidth

Prototype LIB_EXPORT s32 MfSdkGuiGetTextWidth(char *text)

Function Get the display width of the text

Params

in
out

return

text

None

>=0

text content

success, the text width

55

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

failure

remark

demo

s32 textWidth = MfSdkGuiGetTextWidth(morefun);

7.33 MfSdkGuiGetTextHeight

Prototype LIB_EXPORT s32 MfSdkGuiGetTextHeight(char *text)

Function Get the display height of the text

Params

in
out

return

remark

demo

text

None

>=0

Other

text content

success, the text height

failure

s32 textHeight = MfSdkGuiGetTextHeight(morefun);

7.34 MfSdkGuiCline

Prototype

LIB_EXPORT void MfSdkGuiCline(s32 x1, s32 y1, s32 x2, s32 y2,
s32 color)

Function Draw a line

point1 X coordinate

point2 X coordinate

point1 Y coordinate

point2 Y coordinate

color of the line

x1

x2

y1

y2

color

None

Nothing

Params

in

out

return
remark

demo

56

Fujian MoreFun Electronic Technology Co.,Ltd.

7.35 MfSdkGuiGetWidth

Prototype LIB_EXPORT s32 MfSdkGuiGetWidth(void)

Function Get screen width

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the screen width

failure

s32 width = MfSdkGuiGetWidth();

7.36 MfSdkGuiGetHeight

Prototype LIB_EXPORT s32 MfSdkGuiGetHeight(void)

Function Get screen height

Params

in
out

return

remark

demo

None

None

>=0

Other

success, the screen height

failure

s32 height = MfSdkGuiGetHeight();

7.37 MfSdkGuiPageOpPaint

Prototype

LIB_EXPORT void MfSdkGuiPageOpPaint(char * left_str, char *
right_str)

Function Bottom options painting

Params

in

left_str

right_str

The character displayed in the lower left corner

The character displayed in the lower right corner

57

Fujian MoreFun Electronic Technology Co.,Ltd.

out

return
remark

demo

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc();

MfSdkGuiPageOpPaint(Cancel, OK);

MfSdkGuiEndBatchPaint();

7.38 MfSdkGuiImeSetMode

Prototype

LIB_EXPORT s32 MfSdkGuiImeSetMode(s32 def_mode, s32
allow_mode, s32 password)

Function Set input method parameters

def_mode

Default input method

allow_mode

Support input method

password

enter password

None

0

Other

success

failure

Params

in

out

return

remark

demo

7.39 MfSdkGuiImeStartInput

Prototype

LIB_EXPORT s32 MfSdkGuiImeStartInput(char * buffer, s32 max,
char * help)

Function Open the input method page

Params

in

out

return

buffer

max

help

None

0

Input buffer

Maximum input character

Enter page title

success, the text length

Other

failure

remark

ONLY for H9G,H9L

58

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

7.40 MfSdkGuiMainMenuFuncAdd

Prototype LIB_EXPORT s32 MfSdkGuiMainMenuFuncAdd(void * pfunc)

Function Add menu handler

Params

in
out

return

remark

demo

pfunc

None

0

Other

menu handler

success

failure

7.41 MfSdkGuiMainMenuFuncDel

Prototype LIB_EXPORT s32 MfSdkGuiMainMenuFuncDel(void * pfunc)

Function Del menu handler

pfunc

None

0

Other

menu handler

success

failure

Params

in

out

return

remark

demo

7.42 MfSdkGuiMainMenuShow

Prototype

LIB_EXPORT void MfSdkGuiMainMenuShow(char *id , s32
timeover)

Function Display menu

59

Fujian MoreFun Electronic Technology Co.,Ltd.

id

menu id

timeover

overtime time

None

Nothing

Params

in

out

return
remark

demo

7.43 MfSdkGuiPostMessage

Prototype

LIB_EXPORT u32 MfSdkGuiPostMessage(u32 msg_id, u32
wparam, u32 lparam)

Function Send a message

Params

in

out

return

remark

demo

msg_id

wparam

lparam

None

0

Other

message id

parameter 1

parameter 2

success

failure

MfSdkGuiPostMessage(MFSDK_GUI_GUIPAINT, 0, 0);

7.44 MfSdkGuiGetMessage

Prototype

LIB_EXPORT u32 MfSdkGuiGetMessage( MfSdkGuiMsg_T *
pmsg , s32 timeover)

Function Recv a message

Params

in

out

return

remark

demo

pmsg

message structure

timeover

overtime time

None

0

Other

success

failure

MfSdkGuiMsg_T pmsg;

if(MfSdkGuiGetMessage(&pmsg, 100) == 0)

60

Fujian MoreFun Electronic Technology Co.,Ltd.

{

//TODO

}

7.45 MfSdkGuiProcDefaultMsg

Prototype

LIB_EXPORT s32 MfSdkGuiProcDefaultMsg( MfSdkGuiMsg_T *
pmsg )

Function Let the system process the default message

Params

in
out

return

remark

demo

pmsg

None

0

Other

message structure

success

failure

7.46 MfSdkGuiMessageBoxShow

Prototype

LIB_EXPORT s32 MfSdkGuiMessageBoxShow(char *title, char
*msg , char* pszLeftOp, char* pszRightOp , s32 timeover)

Function Display dialog

title

msg

message title

message content

Params

in

pszLeftOp

bottom left corner

pszRightOp

tip in the lower right corner

timeover

overtime time

out

None

return

remark

demo

1

2

3

Other

Confirm return

Cancel back

Timeout

failure

int ret = -1;

ret = MfSdkGuiMessageBoxShow(Tips, Success , Cancel, Confirm , 30 *

1000);

61

Fujian MoreFun Electronic Technology Co.,Ltd.

7.47 MfSdkGuiLoadBmpEx

Prototype

LIB_EXPORT char *MfSdkGuiLoadBmpEx(char * filename, int
*width, int *height, int * color)

Function Load bmp into memory

Params

in

out

return

remark

demo

filename

image name

width

height

color

!=0

0

image width

image height

image color

success,Image content array, which needs to
be released after use

failure

# define LOGOBMP data\\logo.bmp

char *pbmp = NULL;

int logowidth = 0;

int logoheight = 0;

int logocolor = 0;

pbmp = MfSdkGuiLoadBmpEx(LOGOBMP, &logowidth, &logoheight, &logocolor);

7.48 MfSdkGuiLoadBmp

Prototype

LIB_EXPORT char *MfSdkGuiLoadBmp(char * filename, s32
*width, s32 *height)

Function Load bmp into memory

Params

in

out

return

remark

filename

image name

width

height

!=0

0

image width

image height

success,Image content array, which needs to
be released after use

failure

62

Fujian MoreFun Electronic Technology Co.,Ltd.

# define LOGOBMP data\\logo.bmp

demo

char *pbmp = NULL;

int logowidth = 0;

int logoheight = 0;

pbmp = MfSdkGuiLoadBmp(LOGOBMP, &logowidth, &logoheight);//bmp only

black and white

7.49 MfSdkGuiBmpFree

Prototype LIB_EXPORT void MfSdkGuiBmpFree(char * pbmp)

Function Free memory of bmp

Params

in
out

return
remark

demo

image content array

pbmp

None

Nothing

MfSdkGuiBmpFree(pbmp);

7.50 MfSdkGuiOutBits

Prototype

LIB_EXPORT void MfSdkGuiOutBits(s32 x, s32 y, unsigned char
*pbits, s32 width , s32 height, s32 mode)

Function Display image

Params

in

out

return
remark

demo

horizontal coordinate

vertical coordinate

image data

image width

image height

display mode(0 - Positive, 1 - Reverse)

x

y

pbits

width

height

mode

None

Nothing

# define LOGOBMP data\\logo.bmp

63

Fujian MoreFun Electronic Technology Co.,Ltd.

s8 *pbmp = NULL;

s32 logowidth = 0;

s32 logoheight = 0;

pbmp = MfSdkGuiLoadBmp(LOGOBMP, &logowidth, &logoheight);

if(pbmp)

{

}

s32 logotop = (MfSdkGuiGetHeight() - logoheight)/2;

s32 logoleft = (MfSdkGuiGetWidth() - logowidth)/2;

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc();

MfSdkGuiOutBits(logoleft, logotop , pbmp, logowidth , logoheight, 0); //show logo

at the center of the screen

MfSdkGuiEndBatchPaint();

7.51 MfSdkGuiOutBitsEx

Prototype

LIB_EXPORT void MfSdkGuiOutBitsEx(s32 x, s32 y, unsigned
char *pbits, s32 width , s32 height, s32 mode , s32 color)

Function Display image

horizontal coordinate

vertical coordinate

image data

image width

image height

display mode(0 - Positive, 1 - Reverse)

bit color of the picture(1,4,24)

x

y

pbits

width

height

mode

color

None

Nothing

Params

in

out

return
remark

# define LOGOBMP data\\logo.bmp

demo

s8 *pbmp = NULL;

s32 logowidth = 0;

s32 logoheight = 0;

s32 logocolor = 0;

64

Fujian MoreFun Electronic Technology Co.,Ltd.

pbmp = MfSdkGuiLoadBmpEx(LOGOBMP, &logowidth, &logoheight, &logocolor);

if(pbmp)

{

}

s32 logotop = (MfSdkGuiGetHeight() - logoheight)/2;

s32 logoleft = (MfSdkGuiGetWidth() - logowidth)/2;

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc();

MfSdkGuiOutBitsEx(logoleft, logotop , pbmp, logowidth , logoheight, 0,

logocolor); //show logo at the center of the screen

MfSdkGuiEndBatchPaint();

7.52 MfSdkGuiOutBitsZoom

Prototype

LIB_EXPORT void MfSdkGuiOutBitsZoom(s32 x, s32 y, unsigned
char *pbits, s32 width , s32 height, s32 mode , s32 zoom)

Function Display image

horizontal coordinate

vertical coordinate

image data

image width

image height

display mode(0 - Positive, 1 - Reverse)

amplification factor

x

y

pbits

width

height

mode

zoom

None

Nothing

Params

in

out

return
remark

demo

7.53 MfSdkGuiTextWidthEx

Prototype LIB_EXPORT s32 MfSdkGuiTextWidthEx(char * str)

Function get text width

Params

in

str

text content

65

Fujian MoreFun Electronic Technology Co.,Ltd.

None

>=0

Other

success, the text width

failure

out

return

remark

demo

7.54 MfSdkGuiTextOutEx

Prototype LIB_EXPORT s32 MfSdkGuiTextOutEx(s32 x, s32 y,char * str)

Function Display text on the screen ,Show different languages

Params

in

out

return

remark

x

y

str

None

0

Other

horizontal coordinate

vertical coordinate

text content

success

failure

s32 ret = -1;

MfSdkGuiBeginBatchPaint();

demo

MfSdkGuiClearDc();

ret = MfSdkGuiTextOutEx(5, 5, morefun);

MfSdkGuiEndBatchPaint();

7.55 MfSdkGuiSetTextStyle

Prototype LIB_EXPORT void MfSdkGuiSetTextStyle(s32 textStyle)

Function Setting Text Style

Params

in
out

return
remark

demo

text style(0 - opaque, 1 - transparent)

textStyle

None

Nothing

MfSdkGuiSetTextStyle(0);

66

Fujian MoreFun Electronic Technology Co.,Ltd.

7.56 MfSdkGuiSelectPageEx

Prototype

LIB_EXPORT s32 MfSdkGuiSelectPageEx(char *title , char
*items[],s32 itemscount,s32 timeover, s32 select)

Function select page

title

items

the title of the select page

menu items

Params

in

itemscount

number of menu items

timeover

menu timeout

select

None

>=0

Other

default menu item

success, index in items of chosen item

failure

out

return

remark

demo

7.57 MfSdkGuiSelectPageExT

Prototype

LIB_EXPORT s32 MfSdkGuiSelectPageExT(char *title ,char
items[][255],s32 itemscount,s32 timeover, s32 select)

Function select page

title

items

the title of the select page

menu items

Params

in

itemscount

number of menu items

timeover

menu timeout

select

None

>=0

Other

default menu item

success, index in items of chosen item

failure

out

return

remark

demo

67

Fujian MoreFun Electronic Technology Co.,Ltd.

7.58 MfSdkGuiSelectPageCb

Prototype

LIB_EXPORT s32 MfSdkGuiSelectPageCb(char *title , char
*items[],int itemscount,int timeover,int select,char
callback_key,int (*callbackfunc)(const void *items[],const int
itemscount))

Function select page with key trigger callback function

title

items

the title of the select page

menu items

itemscount

number of menu items

Params

in

timeover

menu timeout

select

default menu item

callback_key

the key used to trigger the callback (recommend
KEY_0 or KEY_BACKSPACE)

callbackfunc

callback function

None

>=0

Other

success, index in items of chosen item

failure

out

return

remark

demo

7.59 MfSdkGuiTitleColorBackground

Prototype LIB_EXPORT void MfSdkGuiTitleColorBackground(s32 color)

Function set the background color of title

the background color of title

Params

in
out

return
remark

demo

color

None

Nothing

only for H9G, H9L

68

Fujian MoreFun Electronic Technology Co.,Ltd.

7.60 MfSdkGuiTitleColorForeground

Prototype LIB_EXPORT void MfSdkGuiTitleColorForeground(s32 color)

Function set the foreground color of title

the foreground color of title

Params

in
out

return
remark

demo

color

None

Nothing

only for H9G, H9L

7.61 MfSdkGuiTitleFont

Prototype LIB_EXPORT void MfSdkGuiTitleFont(int font)

Set title font

font

None

Nothing

only for H9G, H9L

Function

Params

in
out

return
remark

demo

font(0 - 12 lattice, 1 - 16 lattice)

7.62 MfSdkGuiMenuHightlineColor

Prototype LIB_EXPORT void MfSdkGuiMenuHightlineColor(s32 color)

Function set the color of menu hightline

Params

in
out

return
remark

the color of menu hightline

color

None

Nothing

only for H9G, H9L

69

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

7.63 MfSdkGuiTextOutLineCenter

Prototype

LIB_EXPORT void MfSdkGuiTextOutLineCenter(char *pMsg , s32
top)

Function Display text in the line center on the screen,Show only English

Params

in

out

return
remark

text content

top coordinate

pMsg

top

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc(); //clean screen

demo

//show Morefun at the center of line 5 on screen

MfSdkGuiTextOutLineCenter(Morefun, MFSDK_GUI_LINE_TOP(5));

MfSdkGuiBeginEndPaint();

7.64 MfSdkGuiTextOutLineRight

Prototype

LIB_EXPORT void MfSdkGuiTextOutLineRight(char *pMsg , s32
top)

Function Display text in the line right on the screen,Show only English

Params

in

out

return
remark

text content

top coordinate

pMsg

top

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc(); //clean screen

demo

//show Morefun at the right of line 5 on screen

MfSdkGuiTextOutLineRight(Morefun, MFSDK_GUI_LINE_TOP(5));

MfSdkGuiBeginEndPaint();

70

Fujian MoreFun Electronic Technology Co.,Ltd.

7.65 MfSdkGuiTextOutLineLeft

Prototype

LIB_EXPORT void MfSdkGuiTextOutLineLeft(char *pMsg , s32
top)

Function Display text in the line left on the screen,Show only English

Params

in

out

return
remark

text content

top coordinate

pMsg

top

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc(); //clean screen

demo

//show Morefun at the left of line 5 on screen

MfSdkGuiTextOutLineLeft(Morefun, MFSDK_GUI_LINE_TOP(5));

MfSdkGuiBeginEndPaint();

7.66 MfSdkGuiTextOutWinCenter

Prototype LIB_EXPORT void MfSdkGuiTextOutWinCenter(char *pmsg)

Function Display text in the middle of the screen,Show only English

Params

in
out

return
remark

text content

pmsg

None

Nothing

MfSdkGuiBeginBatchPaint();

MfSdkGuiClearDc(); //clean screen

demo

MfSdkGuiTextOutWinCenter(Morefun); //show Morefun at the center of the

screen

MfSdkGuiBeginEndPaint();

71

Fujian MoreFun Electronic Technology Co.,Ltd.

7.67 MfSdkGuiClearRect

Prototype

LIB_EXPORT void MfSdkGuiClearRect(s32 left, s32 top, s32 right,
s32 bottom, s32 color)

Function Refresh the specified area

left

top

right

left border

upper boundary

right border

bottom

lower boundary

refresh with specified color

color

None

Nothing

Params

in

out

return
remark

demo

7.68 MfSdkGuiMessageBoxShowEx

Prototype

LIB_EXPORT s32 MfSdkGuiMessageBoxShowEx(char *title, char
*msg , char* pszLeftOp, char* pszRightOp , s32 timeover,s32
flag,unsigned char * keylist, s32 * presskey)

Function Display dialog

title

msg

message title

message content

pszLeftOp

bottom left corner

Params

in

pszRightOp

tip in the lower right corner

timeover

overtime time

flag

support

presskey

1

2

3

Other

out

return

remark

show timeout on title right side(1 - Yes, 0 - No)

key value eg:{key0,key1,keyok}

return press key value

Confirm return

Cancel back

Timeout

Failure

72

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

7.69 MfSdkGuiSetTitle

Prototype LIB_EXPORT void MfSdkGuiSetTitle(char *title)

Function Set title

title string

title

None

Nothing

Params

in
out

return
remark

demo

7.70 MfSdkGuiTextOutHighlight

Prototype

LIB_EXPORT s32 MfSdkGuiTextOutHighlight(s32 x, s32 y, s32
y2,char * text)

Function Highlight a line of text

x

y

y2

text

None

0

Other

the starting x coordinate of the highlight

the starting y coordinate of the highlight

the ending y coordinate of the highlight

the text want to highlight

success

failure

Params

in

out

return

remark

demo

7.71 MfSdkGuiRectHighlight

Prototype LIB_EXPORT s32 MfSdkGuiRectHighlight(int x, int x2, int y, int y2)

73

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Highlight an area

x

x2

y

y2

None

0

Other

the starting x coordinate of the highlight

the ending x coordinate of the highlight

the starting y coordinate of the highlight

the ending y coordinate of the highlight

success

failure

Params

in

out

return

remark

demo

7.72 MfSdkGuiDefaultMsgFuncAdd

Prototype LIB_EXPORT s32 MfSdkGuiDefaultMsgFuncAdd(void * pfunc)

Function Add default message processing

Params

in
out

return

remark

demo

pfunc

None

0

Other

message processing function

success

failure

7.73 MfSdkGuiMainMenuItemAdd

Prototype

LIB_EXPORT s32
MfSdkGuiMainMenuItemAdd(MfSdkGuiMenuItemDef_T *
menu_item)

Function Add menu item

Params

in
out

return

menu_item

menu item

None

0

Other

success

failure

74

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

7.74 MfSdkGuiMainMenuItemDel

Prototype

LIB_EXPORT s32 MfSdkGuiMainMenuItemDel(char *name ,char
*id)

Function Delete menu item

name

id

None

0

Other

Params

in

out

return

remark

demo

the value of st_gui_menu_item_def->name

the value of st_gui_menu_item_def->id

success

failure

7.75 MfSdkGuiKeyGetEvent

Prototype

LIB_EXPORT s32 MfSdkGuiKeyGetEvent(MfSdkGuiKeyEvent_T
*key_event)

Function get event

None

key_event

event structure

0

Other

success

failure

Params

in
out

return

remark

demo

7.76 MfSdkGuiWifiSetPage

Prototype LIB_EXPORT s32 MfSdkGuiWifiSetPage()

75

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Params

in
out

return
remark

demo

None

None

0

success

7.77 MfSdkGuiSetProcs

Prototype

LIB_EXPORT void MfSdkGuiSetProcs( MfSdkGuiSignProcs_T
*procs )

Function Set sign processing function

the sign processing function

procs

None

Nothing

Params

in
out

return
remark

demo

7.78 MfSdkGuiSignExist

Prototype LIB_EXPORT int MfSdkGuiSignExist( const char *index )

Function Determine whether it has been signed

Params

in
out

return

remark

demo

index

None

0

other

Signature index

success

failure

76

Fujian MoreFun Electronic Technology Co.,Ltd.

7.79 MfSdkGuiSignProc

Prototype

LIB_EXPORT int MfSdkGuiSignProc( const char *index, const
char *date, const char *refno, int timeout )

Function Signature processing

index

date

refno

timeout

None

0

Other

Signature index

Device date

Reference No

timeout time

success

failure

API: gui_sign_proc and gui_sign_proc2 merge to
MfSdkGuiSignProc

Params

in

out

return

remark

demo

7.80 MfSdkGuiSignPrint

Prototype LIB_EXPORT const char *MfSdkGuiSignExist( const char *index )

Function Get sign print string

Params

in
out

return

remark

demo

index

None

!=0

0

Signature index

success, the print string

failure

7.81 MfSdkGuiSignEncode

Prototype

LIB_EXPORT int MfSdkGuiSignEncode( const char *index, char
**jbigencode )

77

Fujian MoreFun Electronic Technology Co.,Ltd.

Function JBIG encoding interface

Params

in
out

index

Signature index

jbigencode

JBIG encoded signature data

!=0

0

success, the print string

failure

return

remark

demo

7.82 MfSdkGuiSignEncodeFree

Prototype LIB_EXPORT int MfSdkGuiSignEncodeFree( char *jbigencode )

Function JBIG results released

jbigencode

the JBIG result

None

0

Other

success

failure

Params

in
out

return

remark

demo

7.83 MfSdkGuiSignClean

Prototype LIB_EXPORT int MfSdkGuiSignClean()

Function Clean up signature data

Params

in
out

return

remark

demo

None

None

0

Other

success

failure

78

Fujian MoreFun Electronic Technology Co.,Ltd.

7.84 MfSdkGuiSignSavetofile

Prototype

LIB_EXPORT int MfSdkGuiSignSavetofile(char *filename, const
char *index)

Function Save signature to file

filename

the filename of Signature

index

None

0

Other

Signature index

success

failure

Params

in

out

return

remark

demo

7.85 MfSdkGuiSetPowerfullColor

Prototype

LIB_EXPORT void MfSdkGuiSetPowerfullColor(unsigned int
iColor)

Function set powerfull color

iColor

None

Nothing

Params

in

out

return
remark

demo

0xFF0000(red)/ 0x00FF00(green) /
0x0000FF(blue)

7.86 MfSdkGuiStateFuncAdd

Prototype LIB_EXPORT int MfSdkGuiStateFuncAdd(void * pfunc)

Function

Params

in

pfunc

79

Fujian MoreFun Electronic Technology Co.,Ltd.

None

0

success

out

return
remark

demo

7.87 MfSdkGuiCleartState

Prototype LIB_EXPORT void MfSdkGuiCleartState(int left , int width)

Function

Params

in

out

return
remark

demo

left

width

None

Nothing

7.88 MfSdkGuiOutStateBitsColor

Prototype

LIB_EXPORT void MfSdkGuiOutStateBitsColor(int x, int y,
unsigned char *pbits, int width , int height, int mode , int fc ,int bc)

Function

Params

in

out

return
remark

x

y

pbits

width

height

mode

fc

bc

None

Nothing

80

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

7.89 MfSdkGuiGetDefineColor

Prototype LIB_EXPORT int MfSdkGuiGetDefineColor(int index)

Function

Params

in
out

return
remark

demo

index

None

7.90 MfSdkGuiSetCurlSocketIcon

Prototype

LIB_EXPORT void MfSdkGuiSetCurlSocketIcon(char*
recv_icon,char* send_icon,int x)

Function set curl socket status icon

recv_icon

recv icon buf

send_icon

send icon buf

X-coordinate offset

x

None

Nothing

icon buf only 30*30 1-bit bmp

Params

in

out

return
remark

demo

7.91 MfSdkGuiRefreshMod

Prototype LIB_EXPORT void MfSdkGuiRefreshMod(int mod)

Function Set the screen refresh mode,disable by default

81

Params

in

out

mod

None

Fujian MoreFun Electronic Technology Co.,Ltd.

0:Open the refresh task(It is recommended to set
when the code has a large number of pixels

return
remark

demo

Called once after the sys_init

8 Printer module

8.1 Module description

This module mainly includes printer APIs.

8.2 Module structure declaration

None

8.3 Constant declarations

typedef enum
{

MFSDK_PRT_SUCCESS = 0, //Success
MFSDK_PRT_FAIL = -1, //Printer unknown fault
MFSDK_PRT_DEV_FAIL = -2, //Printer device failure
MFSDK_PRT_OUTOF_PAPER = -3, //The printer is out of paper
MFSDK_PRT_LOSE_COMMAND = -4, //Print handle not obtained
MFSDK_PRT_FILE_FAIL = -5, //Fail to open the file
MFSDK_PRT_HANDLE_BACK = -6, //Split machine handle is not put

back

MFSDK_PRT_CACHE_ERR = -7, //Save cache failed
MFSDK_PRT_PARM_ERROR = -8,//Parameter error

}MfSdkPrtRet_E;

typedef enum
{

MFSDK_PRT_PATTERN_LEFT = 0,
MFSDK_PRT_PATTERN_CENTER = 1,
MFSDK_PRT_PATTERN_RIGHT = 2,

//left

//center

//right

}MfSdkPrtPattern_E;

82

Fujian MoreFun Electronic Technology Co.,Ltd.

8.4 MfSdkPrtInit

Prototype LIB_EXPORT s32 MfSdkPrtInit(void)

Function Printer initialize, check the printer status (if it is out of paper).

Params

in
out

Nothing

Nothing

return
remark

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtInit();

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

8.5 MfSdkPrtStr

Prototype

LIB_EXPORT s32 MfSdkPrtStr( s8 *str, s32 linegap, MFSDKBOOL
newline)

Function

String printing with automatic line break function, support \r\n
newline

Params

in

s8 *str

Need to print string information

s32 linegap

Line spacing: unit pixels, 0 is the default value
(for Pin printing use)

MFSDKBOOL
newline

0 Does not support line breaks;1 support \r\n
newline

out

Nothing

return
remark

For details, see MfSdkPrtRet_E

Save the string to the printer cache and call Print Start
(Print_Start) to print

S32 ret = UPrint_Str("AMOUNT", 1, 1);

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

83

Fujian MoreFun Electronic Technology Co.,Ltd.

8.6 MfSdkPrtBitMap

Prototype

LIB_EXPORT s32 MfSdkPrtBitMap( s8 *BmpFile,
MfSdkPrtPattern_E pattern)

Function print image (XXX.bmp)

Params

in

out

return
remark

demo

s8 *BmpFile

Image file name (XXX.bmp)

MfSdkPrtPattern_E
pattern

pattern alignment (see 'MfSdkPrtPattern_E'
enum)

Nothing

For details, see MfSdkPrtRet_E

S32 ret =MfSdkPrtBitMap("data//img_mof.bmp",

MFSDK_PRT_PATTERN_CENTER);

if(ret == MFSDK_PRT_SUCCESS)

{

//TODO

}

8.7 MfSdkPrtStart

Prototype LIB_EXPORT s32 MfSdkPrtStart(void)

Function Start printing

Params

in
out

Nothing

Nothing

return
remark

For details, see MfSdkPrtRet_E

Thermal printing: no more blank lines (processed by the
application layer) are required after printing is completed;

S32 ret = MfSdkPrtStart();

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

84

Fujian MoreFun Electronic Technology Co.,Ltd.

8.8 MfSdkPrtStrBold

Prototype

LIB_EXPORT s32 MfSdkPrtStrBold( s8 *pszStr,
MfSdkPrtPattern_E pattern, s32 linegap, MFSDKBOOL newline)

Function

String printing with automatic line break function, support \r\n
newline

s8 *pszStr

Need to print string information

MfSdkPrtPattern_E
pattern

alignment (see 'MfSdkPrtPattern_E' enum)

Params

in

s32 linegap

Line spacing, unit pixels, 0 is the default value
(for Pin printing use)

MFSDKBOOL
newline

0 Does not support line breaks;1 support \r\n
newline

out

Nothing

return
remark

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtStrBold(MFSDK,MFSDK_PRT_PATTERN_LEFT,10,1);

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

8.9 MfSdkPrtFeed

Prototype LIB_EXPORT s32 MfSdkPrtFeed(s32 linegap)

Function Printer paper

Params

in
out

return
remark

s32 linegap

Paper length (pixels)

Nothing

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtFeed(36);

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

85

Fujian MoreFun Electronic Technology Co.,Ltd.

8.10 MfSdkPrtMatrixCode

Prototype

LIB_EXPORT s32 MfSdkPrtMatrixCode(const s8 *psMatrixCode,
s32 nLen, s8 cSize, MfSdkPrtPattern_E pattern)

Function Print QR code,Convert incoming data to QR code and print

Params

in

const s8
*psMatrixCode

s32 nLen

s8 cSize

MfSdkPrtPattern_E
pattern

QR code data

QR code data length

QR code size, 0-small, 1-medium, 2-large

alignment (see 'MfSdkPrtPattern_E' enum)

out

Nothing

return
remark

demo

For details, see MfSdkPrtRet_E

S32 ret =
MfSdkPrtMatrixCode(MFSDK,6,1,MFSDK_PRT_PATTERN_CENTER);

if(ret == MFSDK_PRT_SUCCESS)

{

//TODO

}

8.11 MfSdkPrtSetFontEN

Prototype

LIB_EXPORT s32 MfSdkPrtSetFontEN(s32 size, s32 zoomW, s32
zoomH)

Function Set print font(English)

s32 size

et print English font size(0--8)

Params

in

out

s32 zoomW

s32 zoomH

Nothing

Set the horizontal magnification of English(1--5)

Set the vertical magnification of English(1--5)

return
remark

demo

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtSetFontEN(5,4,4);

if(ret == MFSDK_PRT_SUCCESS)

86

Fujian MoreFun Electronic Technology Co.,Ltd.

{

//TODO

}

8.12 MfSdkPrtSetFontCN

Prototype

LIB_EXPORT s32 MfSdkPrtSetFontCN(s32 size, s32 zoomW, s32
zoomH)

Function Set print font(Chinese)

Params

in

out

return
remark

s32 size

Set print other font size(0--1)

s32 zoomW

Set the horizontal magnification of English(1--5)

s32 zoomH

Set the vertical magnification of English(1--5)

Nothing

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtSetFontCN(1,4,4);

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

8.13 MfSdkPrtSetDensity

Prototype LIB_EXPORT s32 MfSdkPrtSetDensity(s32 val)

Function Set print density

Params

in
out

s32 val

Nothing

Set print density (1--5, 3 is normal)

return
remark

For details, see MfSdkPrtRet_E

S32 ret = MfSdkPrtSetDensity(3);

if(ret == MFSDK_PRT_SUCCESS)

demo

{

//TODO

}

87

Fujian MoreFun Electronic Technology Co.,Ltd.

8.14 MfSdkPrtSetAlign

Prototype LIB_EXPORT void MfSdkPrtSetAlign(MfSdkPrtPattern_E pattern)

Function

String printing with automatic line break function, support \r\n
newline

Params

in
out

return
remark

demo

alignment (see 'MfSdkPrtPattern_E' enum)

pattern

Nothing

Nothing

MfSdkPrtInit(MFSDK_PRT_PATTERN_CENTER);

8.15 MfSdkPrtSetLineAlign

Prototype

LIB_EXPORT void MfSdkPrtSetLineAlign(MfSdkPrtPattern_E
pattern)

Function Set the line print buffer align format,will not affect next line

Params

in

out

return
remark

demo

alignment (see 'MfSdkPrtPattern_E' enum)

MfSdkPrtPattern_E
pattern

Nothing

Nothing

MfSdkPrtSetLineAlign(MFSDK_PRT_PATTERN_CENTER);

8.16 MfSdkPrtStrLine

Prototype

LIB_EXPORT void MfSdkPrtStrLine( s8 *sLeft, s8 *sRight, s32
nLinegap)

Function

String printing with automatic line feed function, support \r\n
newline

Params

in
out

return

Nothing

Nothing

Nothing

88

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

MfSdkPrtStrLine(amt,123,5);

8.17 MfSdkPrtSetLineSpace

Prototype LIB_EXPORT void MfSdkPrtSetLineSpace(s32 nLinegap)

Function set the line space of follow print buffer

nLinegap

line space value

Nothing

Nothing

Params

in
out

return
remark

demo

8.18 MfSdkPrtSetFontMode

Prototype LIB_EXPORT void MfSdkPrtSetFontMode(s32 mod)

Function Set the printing mode for English letters and numbers

1 Print English letters and numbers characters
using font files; 0 or no setting, the default print
uses the code font

mod

Nothing

Nothing

Params

in

out

return
remark

demo

8.19 MfSdkPrtCheckNopaper

Prototype LIB_EXPORT s32 MfSdkPrtCheckNopaper()

Function Check if the device is out of paper

89

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

Nothing

Nothing

Ref. MfSdkPrtRet_E

return
remark

demo

8.20 MfSdkPrtSetArabicNumOrder

Prototype LIB_EXPORT s32 MfSdkPrtSetArabicNumOrder(s32 order)

Function Set the printing mode for English letters and numbers

Params

in
out

order

Nothing

1:Set up Arabic digital reverse printing

Ref. MfSdkPrtRet_E

return
remark

demo

9 Pinpad module

9.1 Module description

This module mainly includes pin entry device.

9.2 Module structure declaration

typedef struct
{

u8 mode; // mode 2,open encrypted pin(The backbutton deletes a pin);

3,open encrypted pin(The backbutton deletes all pin);

u8 min;//Minimum pin length
u8 max;//Maximum pin length
u32 timeoverMs;//timeover(ms)
u8 isBypass;//Whether to support bypass

} MfSdkPedPinModCfg_T;

typedef struct
{

90

Fujian MoreFun Electronic Technology Co.,Ltd.

s8 appVer[10];
s8 pinpadSn[32];
s8 model[10];

}MfSdkPedPinpadInfo_T;

9.3 Constant declarations

typedef enum
{

MFSDK_PED_NOT_KEY = -22,
MFSDK_PED_PARM_ERROR = -21, // Parameter error
MFSDK_PED_PINPAD_INSUFFICIENT_SPACE = -16,//The pinpad

// No injection key

space is insufficient

MFSDK_PED_PINPAD_NO_PUBLIC_KEY_SIGN = -15,//The pinpad

upgrade lacks the public key signature

MFSDK_PED_PINPAD_REPEATED_SET_MODE = -12, //Repeated

setting mode

MFSDK_PED_PINPAD_UPDATEFILE_TOO_BIG = -11, // update file

too big

MFSDK_PED_UPDATEFILE_FORMAT_ERR = -10, // update file

format error

MFSDK_PED_UPDATE_COMPLETE_RECONNECT_FAILED = -9, //

failed to reconnect to the pinpad after the update is complete

MFSDK_PED_MD5_FAILED = -8, // pinpad app md5 authentication

failed

MFSDK_PED_WRITE_FAILED = -7, // pinpad failed to write files
MFSDK_PED_OPEN_FAILED = -6, // app to be updated failed to open
MFSDK_PED_NO_APP_UPDATE = -5, // no apps to update(mo

data/pinpad.bin)

MFSDK_PED_PINPAD_TIMEOUT = -2, // External Pinpad

communication timed out

MFSDK_PED_OTHER = -1,
MFSDK_PED_SUCCESS = 0,

// Success

}MfSdkPedRet_E;
typedef enum
{

MFSDK_PED_ENCRYPT = 0, // Encryption mode
MFSDK_PED_DECRYPT = 1, // Decryption mode

} MfSdkPedMod_E;

typedef enum
{

MFSDK_PED_DES_ECB = 0, // des mode ECB
MFSDK_PED_DES_CBC = 1, // des mode CBC

91

Fujian MoreFun Electronic Technology Co.,Ltd.

} MfSdkPedDesMod_E;

typedef enum
{

MFSDK_PED_PINPAD_INPUT_PIN = 0,
MFSDK_PED_PINPAD_PRESS_OK,
MFSDK_PED_PINPAD_PRESS_ESC,

}MfSdkPedPinpadStatus_E;

# define MFSDK_MKSK_MAINKEY_TYPE 0x00
# define MFSDK_MKSK_PINENC_TYPE 0x01
# define MFSDK_MKSK_MACENC_TYPE 0x02
# define MFSDK_MKSK_MAGDEC_TYPE 0x03
# define MFSDK_MKSK_TRANSKEY_TYPE 0x04

# define MFSDK_SEC_FIXED_FIELD 0x00
# define MFSDK_SEC_MKSK_FIELD 0x01
# define MFSDK_SEC_DUKPT_FIELD 0x02

# define MFSDK_SEC_MAC_UPAY_FORMAT 0x01
# define MFSDK_SEC_MAC_X99_FORMAT 0x02
# define MFSDK_SEC_MAC_X919_FORMAT 0x03
# define MFSDK_SEC_MAC_XOR_FORMAT 0x04

# define MFSDK_SEC_PIN_FORMAT0 0x00
# define MFSDK_SEC_PIN_FORMAT1 0x01
# define MFSDK_SEC_PIN_FORMAT2 0x02
# define MFSDK_SEC_PIN_FORMAT3 0x03
# define MFSDK_SEC_PIN_FORMAT4 0x04

# define MFSDK_DUKPT_DES_KEY_PIN 0x00
# define MFSDK_DUKPT_DES_KEY_MAC1 0x01
# define MFSDK_DUKPT_DES_KEY_MAC2 0x02
# define MFSDK_DUKPT_DES_KEY_DATA1 0x03
# define MFSDK_DUKPT_DES_KEY_DATA2 0x04
# define MFSDK_DUKPT_DES_KEY_PEK 0x05

typedef enum
{

MFSDK_PED_TR31_TYPE_IPEK = 0,
MFSDK_PED_TR31_TYPE_BDK,

}MfSdkPedTr31KeyType_E;

92

Fujian MoreFun Electronic Technology Co.,Ltd.

typedef enum
{

MFSDK_PED_PINPAD_UPDATE_START = 0x01,
MFSDK_PED_PINPAD_UPDATEING,
MFSDK_PED_PINPAD_UPDATE_END,
MFSDK_PED_PINPAD_RESTORE_CONNECTION,

}MfSdkPedPinpadUpdateStatus_E;

9.4 MfSdkPedSetKeySize

Prototype LIB_EXPORT s32 MfSdkPedSetKeySize(s32 size)

Function Set the key length

Params

in
out

size

nothing

16 or 24

return
remark

demo

For details, see MfSdkPedRet_E.

S32 ret = MfSdkPedSetKeySize(16);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO

9.5 MfSdkPedGetKeySize

Prototype LIB_EXPORT s32 MfSdkPedGetKeySize(void)

Function Get the key length

Params

in
out

nothing

nothing

return
remark

demo

key length

S32 keyLength = MfSdkPedGetKeySize();

93

Fujian MoreFun Electronic Technology Co.,Ltd.

9.6 MfSdkPedDukptLoadKey

Prototype

LIB_EXPORT s32 MfSdkPedDukptLoadKey(s32 mode, s32 type,
s32 gid, u8 *init_ksn, u8 *init_key, u8 *kvc)

Function initialize the dukpt key use IPEK ciphertext

s32 mode

s32 type

s32 gid

encryption method of initial key(0 - plaintext, 1 -
tmk encryption, 2 - kek encryption)

initial key type(0 - ipek, 1 - bdk)

key grouping,,max 100 group (0 - 99)

Params

in

u8 *init_ksn

initial ksn

u8 *init_key

Initial key

out

u8 *kvc

key kvc(Key plaintext encryption 8 0x00)

return
remark

For details, see MfSdkPedRet_E.

u8 kvc[8] = { 0 };

u8 ksn[10] = "\xFF\xFF\x01\x11\x7C\x70\xCA\x00\x00\x00";

u8 ipek[16] =

"\xC1\xD0\xF8\xFB\x49\x58\x67\x0D\xBA\x40\xAB\x1F\x37\x52\xEF\x0D";

demo

S32 ret = MfSdkPedDukptLoadKey(0,0,0, ksn, ipek, kvc);

if(ret == MFSDK_PED_SUCCESS)

{

//TODO

}

9.7 MfSdkPedDukpt3desRun

Prototype

LIB_EXPORT s32 MfSdkPedDukpt3desRun(MfSdkPedMod_E
mode, s8 *inData, s32 size, s8 *outData, MfSdkPedDesMod_E
desMode, s32 keyTpye)

Function use the previously obtained key 3des operation

MfSdkPedMod_E
mode

mode(Ref. enum'MfSdkPedMod_E' )

Params

in

s8 *inData

raw data

s32 size

data length (8-byte multiple)

MfSdkPedDesMod_
E desMode

des mode(see 'MfSdkPedDesMod_E' enum)

94

Fujian MoreFun Electronic Technology Co.,Ltd.

s32 keyTpye

key type(0 - MFSDK_DUKPT_DES_KEY_PIN,
1 - MFSDK_DUKPT_DES_KEY_MAC1,
2 - MFSDK_DUKPT_DES_KEY_MAC2,
3 - MFSDK_DUKPT_DES_KEY_DATA1,
4 - MFSDK_DUKPT_DES_KEY_DATA2)

out

s8 *outData

out data

return
remark

For details, see MfSdkPedRet_E.

u8 ksn[20] = { 0 };

u8 inData[] = "morefun";

u8 ounData[20] = { 0 };

S32 ret = MfSdkPedDukptGetKsn(0, ksn);

if(ret == MFSDK_PED_SUCCESS)

{

demo

ret = MfSdkPedDukpt3desRun(MFSDK_PED_ENCRYPT, inData, 8, ounData,

MFSDK_PED_DES_ECB, MFSDK_DUKPT_DES_KEY_DATA1);

if(ret == MFSDK_PED_SUCCESS)

{

//TODO

}

}

9.8 MfSdkPedDukptGetKsn

Prototype LIB_EXPORT s32 MfSdkPedDukptGetKsn(u32 gid, u8 *ksn)

Function get key corresponds to ksn

Params

in
out

u32 gid

u8 *ksn

gid key grouping ,max 100 group (0 - 99)

key corresponds to ksn

return
remark

demo

For details, see MfSdkPedRet_E.

u8 ksn[20] = { 0 };

S32 ret = MfSdkPedDukptGetKsn(0, ksn);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO

95

Fujian MoreFun Electronic Technology Co.,Ltd.

9.9 MfSdkPedMkSkSavePlaintextKey

Prototype

LIB_EXPORT s32 MfSdkPedMkSkSavePlaintextKey(s32 type, u32
gid, u8 *key, u8 *kvc)

Function get key corresponds to ksn

Params

in

out

return
remark

type key type(
0 - MFSDK_MKSK_MAINKEY_TYPE,
1 - MFSDK_MKSK_PINENC_TYPE,
2 - MFSDK_MKSK_MACENC_TYPE,
3 - MFSDK_MKSK_MAGDEC_TYPE,
4 - MFSDK_MKSK_TRANSKEY_TYPE)

key grouping ,max 100 group (0 - 99)

key key plaintext

key kvc(key plaintext encryption 8 0x00)

s32 type

u32 gid

u8 *key

u8 *kvc

For details, see MfSdkPedRet_E.

u8 kvc[8] = { 0 };

u8 key[16] =

"\xC1\xD0\xF8\xFB\x49\x58\x67\x0D\xBA\x40\xAB\x1F\x37\x52\xEF\x0D";

S32 ret =

demo

MfSdkPedMkSkSavePlaintextKey(MFSDK_MKSK_MAINKEY_TYPE,0,key, kvc);

if(ret == MFSDK_PED_SUCCESS)

{

//TODO

}

9.10 MfSdkPedMkSkSaveEncryptedKey

Prototype

LIB_EXPORT s32 MfSdkPedMkSkSaveEncryptedKey(s32 type,
u32 gid, u8 *key, MfSdkPedDesMod_E desMode, u8 *kvc)

Function save key ciphertext

Params

in

s32 type

type key type(
0 - MFSDK_MKSK_MAINKEY_TYPE,
1 - MFSDK_MKSK_PINENC_TYPE,
2 - MFSDK_MKSK_MACENC_TYPE,

96

Fujian MoreFun Electronic Technology Co.,Ltd.

3 - MFSDK_MKSK_MAGDEC_TYPE,
4 - MFSDK_MKSK_TRANSKEY_TYPE)

u32 gid

key grouping ,max 100 group (0 - 99)

MfSdkPedDesMod_
E desMode

u8 *key

u8 *kvc

des mode(see 'MfSdkPedDesMod_E' enum)

key ciphertext

key kvc(key plaintext encryption 8 0x00)

For details, see MfSdkPedRet_E.

out

return

remark

u8 kvc[8] = { 0 };

u8 key[16] =

"\xC1\xD0\xF8\xFB\x49\x58\x67\x0D\xBA\x40\xAB\x1F\x37\x52\xEF\x0D";

S32 ret =

demo

MfSdkPedMkSkSavePlaintextKey(MFSDK_MKSK_MAINKEY_TYPE,0,key, kvc);

if(ret == MFSDK_PED_SUCCESS)

{

//TODO

}

9.11 MfSdkPedMkSkGetKcv

Prototype

LIB_EXPORT s32 MfSdkPedMkSkGetKcv(s32 keyIndex, s32
keyType, u8 *OutKcv)

Function get mksk kcv

s32 keyIndex

keyIndex key index(0-99)

Params

in

s32 keyType

(0 - MFSDK_MKSK_MAINKEY_TYPE,
1 - MFSDK_MKSK_PINENC_TYPE,
2 - MFSDK_MKSK_MACENC_TYPE,
3 - MFSDK_MKSK_MAGDEC_TYPE,
4 - MFSDK_MKSK_TRANSKEY_TYPE)

out

u8 *OutKcv

key kvc(key plaintext encryption 8 0x00)

return
remark

demo

For details, see MfSdkPedRet_E.

u8 kcv[10] = { 0 };

s32 ret = MfSdkPedMkSkGetKcv(0,MFSDK_MKSK_MAINKEY_TYPE,kcv);

97

Fujian MoreFun Electronic Technology Co.,Ltd.

9.12 MfSdkPedMkSk3desRun

Prototype

LIB_EXPORT s32 MfSdkPedMkSk3desRun(s32 type, s32 gid,
MfSdkPedMod_E mode, u8 *ind, s32 size, u8 iv[8], u8 *outd,
MfSdkPedDesMod_E desMode)

Function use key 3des operation

s32 type

(0 - MFSDK_MKSK_MAINKEY_TYPE,
1 - MFSDK_MKSK_PINENC_TYPE,
2 - MFSDK_MKSK_MACENC_TYPE,
3 - MFSDK_MKSK_MAGDEC_TYPE,
4 - MFSDK_MKSK_TRANSKEY_TYPE)

s32 gid

key grouping,max 100 group (0 - 99)

Params

in

MfSdkPedMod_E
mode

mode(see 'MfSdkPedMod_E' enum)

u8 *ind

s32 size

u8 iv[8]

raw data

data length (8-byte multiple)

initialization vector

MfSdkPedDesMod_
E desMode

des mode(see 'MfSdkPedDesMod_E' enum)

out

u8 *outd

calculation results

return
remark

For details, see MfSdkPedRet_E.

u8 ksn[20] = { 0 };

u8 inData[] = "morefun";

u8 ounData[20] = { 0 };

u8 iv[8] = { 0 };

S32 ret = 0;

demo

ret = MfSdkPedMkSk3desRun(MFSDK_MKSK_MAINKEY_TYPE,

0,MFSDK_PED_ENCRYPT,inData,8,iv,ounData,MFSDK_PED_DES_ECB);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

9.13 MfSdkPedMacProc

Prototype

LIB_EXPORT s32 MfSdkPedMacProc(s32 fid, s32 gid, s32 format,
u8 *data, s32 len, u8 *mac, s32 keyTpye, s32 keySize)

98

Fujian MoreFun Electronic Technology Co.,Ltd.

Function computing mac

Params

in

s32 fid

field id (1 - MFSDK_SEC_MKSK_FIELD, 2 -
MFSDK_SEC_DUKPT_FIELD)

s32 gid

key grouping ,max 100 group (0 - 99)

s32 format

mac format (
1 - MFSDK_SEC_MAC_UPAY_FORMAT,
2 - MFSDK_SEC_MAC_X99_FORMAT,
3 - MFSDK_SEC_MAC_X919_FORMAT,
4 - MFSDK_SEC_MAC_XOR_FORMAT)

u8 *data

s32 len

mac source data

data length

s32 keyTpye

key type(
1 - MFSDK_DUKPT_DES_KEY_MAC1,
2 - MFSDK_DUKPT_DES_KEY_MAC2)

s32 keySize

key size

out

u8 *mac

mac

return
remark

For details, see MfSdkPedRet_E.

U8 data[10] = \x12\x34\x56;

U8 mac[30]={0};

S32 ret =

MfSdkPedMacProc(MFSDK_SEC_DUKPT_FIELD,0,MFSDK_SEC_MAC_X919_FORMAT,data,8,

demo

mac,MFSDK_DUKPT_DES_KEY_MAC1,16);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

9.14 MfSdkPedEncryptPinProc

Prototype

LIB_EXPORT s32 MfSdkPedEncryptPinProc(s32 fid, s32 format,
s32 gid, u8 *pan, u8 *pinBlock, u8 *pin)

Function read pin ciphertext from the security keyboard

Params

in

s32 fid

s32 format

field id (1 - MFSDK_SEC_MKSK_FIELD, 2 -
MFSDK_SEC_DUKPT_FIELD)

pin format (
0 - MFSDK_SEC_PIN_FORMAT0,

99

Fujian MoreFun Electronic Technology Co.,Ltd.

1 - MFSDK_SEC_PIN_FORMAT1,
2 - MFSDK_SEC_PIN_FORMAT2,
3 - MFSDK_SEC_PIN_FORMAT3,
4 - MFSDK_SEC_PIN_FORMAT4)

key grouping ,max 100 group (0 - 99)

card number

pin plaintext

s32 gid

u8 *pan

u8 *pin

out

u8 *pinBlock

pin Block

return
remark

For details, see MfSdkPedRet_E.

U8 pan[10] = 1234123488888888;

U8 pinblock[30]={0};

S32 ret =

MfSdkPedEncryptPinProc(MFSDK_SEC_DUKPT_FIELD,MFSDK_SEC_PIN_FORMAT0,0,pan,pin

demo

block,1234);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

9.15 MfSdkPedSetPinModeCfgInit

Prototype LIB_EXPORT void MfSdkPedSetPinModeCfgInit(void)

Function

Pin mode config init
pin is plaintext and 4-6 , it does not support bypass
MfSdkPedPinModCfg_T flag is 0

Params

in
out

Nothing

Nothing

Nothing

return
remark

demo

9.16 MfSdkPedSetPinModeCfg

Prototype

LIB_EXPORT void
MfSdkPedSetPinModeCfg(MfSdkPedPinModCfg_T cfg)

100

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Set enable pin input mode config

For details, see MfSdkPedPinModCfg_T

Params

in

out

return
remark

MfSdkPedPinModC
fg_T cfg

Nothing

Nothing

MfSdkPedPinModCfg_T pinCfg = { 0 };

pinCfg.mode = 2;

pinCfg.min = 4;

pinCfg.max = 6;

demo

pinCfg.timeoverMs = 45000;

pinCfg.isBypass = 1;

MfSdkPedSetPinModeCfg(pinCfg);

9.17 MfSdkPedEncryptPinProcEx

Prototype

LIB_EXPORT s32 MfSdkPedEncryptPinProcEx(u8* pan, u8*
pinBlock)

Function

Calculated pinblock value,MfSdkPedSetPinModeCfg needs to be
called first.

Params

in
out

return
remark

pan

Card PAN

pinBlock

For details, see MfSdkPedRet_E.

MfSdkPedPinModCfg_T pinCfg = { 0 };

pinCfg.mode = 2;

pinCfg.min = 4;

pinCfg.max = 6;

demo

pinCfg.timeoverMs = 45000;

pinCfg.isBypass = 1;

MfSdkPedSetPinModeCfg(pinCfg);

u8* pan = 1234567890123456;

u8 pinBlock[8] = {0};

s32 nRet = MfSdkPedEncryptPinProcEx(pan, pinBlock);

101

Fujian MoreFun Electronic Technology Co.,Ltd.

9.18 MfSdkPedGetPinModeCfg

Prototype

LIB_EXPORT MfSdkPedPinModCfg_T
*MfSdkPedGetPinModeCfg(void)

Function Get pin input mode config

Params

in
out

nothing

nothing

return
remark

demo

MfSdkPedPinModCfg_T point, pin input mode config

MfSdkPedPinModCfg_T pinCfg = { 0 };

&pinCfg = MfSdkPedGetPinModeCfg();

9.19 MfSdkPedGetPinModeStatus

Prototype LIB_EXPORT s32 MfSdkPedGetPinModeStatus(s32 *length)

Function Get pin mode status

Params

in
out

Nothing

s32 *length

pin length

0

1

2

3

Still input

Press the enter(OK) button

Press the exit button

timeover

return

remark

S32 len=0;

S32 ret = MfSdkPedGetPinModeStatus(&len);

demo

If(ret == 1)

{

//user press the enter(OK) button

}

102

Fujian MoreFun Electronic Technology Co.,Ltd.

9.20 MfSdkPedSaveRsaPriKey

Prototype

LIB_EXPORT s32 MfSdkPedSaveRsaPriKey(s32 index, s32 length,
u8 *p, u8 *q)

Function save the private key to the security module

Params

in

s32 index

index key index (0 - 9)

s32 length

rsa byte size(128/256)

u8 *p

u8 *q

private key P component

private key Q component

out

Nothing

return
remark

demo

For details, see MfSdkPedRet_E.

s32 ret = MfSdkPedSaveRsaPriKey(0,128,10,20);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

9.21 MfSdkPedSaveRsaPukKey

Prototype

LIB_EXPORT s32 MfSdkPedSaveRsaPukKey(s32 index, s32
length, u8 *n)

Function save the public key to the security module

Params

in

out

return
remark

demo

s32 index

index key index (0 - 9)

s32 length

length rsa byte size(128/256)

u8 *n

Nothing

public

key N component

For details, see MfSdkPedRet_E.

s32 ret = MfSdkPedSaveRsaPukKey(0,128,10);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

103

Fujian MoreFun Electronic Technology Co.,Ltd.

9.22 MfSdkPedRsaBlock

Prototype

LIB_EXPORT s32 MfSdkPedRsaBlock(s32 index, s8 *inD, s8
*outD, s32 length)

Function RSA block calculation

Params

in

out

return
remark

demo

s32 index

index key index (0 - 9)

s8 *inD

in data

s32 length

rsa key byte size(128/256)

s8 *outD

out data

For details, see MfSdkPedRet_E.

s8 out[20]={0};

s32 ret = MfSdkPedRsaBlock(0,1234,out,128);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

9.23 MfSdkPedDeleteKey

Prototype

LIB_EXPORT s32 MfSdkPedDeleteKey(s32 keyType, s32
keyIndex)

Function elete index key

Params

in

out

return
remark

demo

s32 keyType

0:MKSK,1:DUKPT

s32 keyType

key index(0-99)

Nothing

For details, see MfSdkPedRet_E.

s8 out[20]={0};

s32 ret = MfSdkPedDeleteKey(0,0);

if(ret == MFSDK_PED_SUCCESS)

{

}

//TODO}

104

Fujian MoreFun Electronic Technology Co.,Ltd.

9.24 MfSdkPedTr31GetData

Prototype

LIB_EXPORT s32 MfSdkPedTr31GetData(u32 type, u8 *mk, s32
nKeySize, u8 *data, s32 size, s8 *wk)

Function save key plaintext

u32 type

default 0

u8 *mk

key for decrypt the TR31 string

in

s32 nKeySize

mk size

u8 *data

s32 size

s8 *wk

TR31 string

TR31 data size

Decrypted key

For details, see MfSdkPedRet_E.

Params

out

return
remark

demo

9.25 MfSdkPedRkiDukptLoad

Prototype

LIB_EXPORT s32 MfSdkPedRkiDukptLoad(const s8 *keyData, s32
len)

Function load the rki key use dukpt

const s8 *keyData key data

s32 len

s8 *wk

otherr

0

key length

Decrypted key

Failed

Success

Params

in

out

return

remark

demo

9.26 MfSdkPedRkiCheckAppKey

Prototype LIB_EXPORT s32 MfSdkPedRkiCheckAppKey( u8 *sHashValue)

105

Fujian MoreFun Electronic Technology Co.,Ltd.

Function verify the app hash

sHashValue

sha256 value of app KEY

Nothing

1, Yes; 0, No

Params

in
out

return
remark

demo

9.27 MfSdkPedSetPinpad

Prototype LIB_EXPORT s32 MfSdkPedSetPinpad(s32 mod)

Function set input pinpad

Params

in
out

s32 mod

Nothing

1:external Pinpad, 0:device's Pinpad

return
remark

demo

For details, see MfSdkPedRet_E.

MfSdkPedSetPinpad(1);

9.28 MfSdkPedGetPinpad

Prototype LIB_EXPORT s32 MfSdkPedGetPinpad(void)

Function get input pinpad

Params

in
out

return

remark

demo

Nothing

Nothing

1

0

external Pinpad

device's Pinpad

s32 ret = MfSdkPedGetPinpad();

If(ret == 1)

{

//external pinpad

106

Fujian MoreFun Electronic Technology Co.,Ltd.

}

9.29 MfSdkPedSetPedUi

Prototype LIB_EXPORT s32 MfSdkPedSetPedUi(u8 *buff, u32 len)

Function Send page buf to external pinpad

Params

in

out

return
remark

demo

u8 *buff

u32 len

Nothing

page buff

buff len

For details, see MfSdkPedRet_E

u8 buf[153600]={0};

s32 ret = MfSdkPedSetPedUi(buf,153600);

If(ret == MFSDK_PED_SUCCESS )

{

//TODO

}

9.30 MfSdkPedCheckCardOnce

Prototype LIB_EXPORT s32 MfSdkPedCheckCardOnce(void)

Function Use the external pinpad to check card

Params

in
out

Nothing

Nothing

return

remark

demo

0

1

2

no card

icc card

rfid cad

other

fail

s32 ret = MfSdkPedCheckCardOnce();

if(ret == 1)

{

//ICC card

107

Fujian MoreFun Electronic Technology Co.,Ltd.

}

9.31 MfSdkPedIsWithPinpad

Prototype LIB_EXPORT s32 MfSdkPedIsWithPinpad(s32 timeoutMs)

Function Whether the terminal has external pinpad.

Params

in
out

return

remark

s32 timeoutMs

timeout ms

Nothing

1

0

Connect the external pinpad

External pinpad is not connected

s32 ret = MfSdkPedIsWithPinpad(3000);

if(ret == 1)

demo

{

//Connect the external pinpad

}

9.32 MfSdkPedExPinpadUpdate

Prototype s32 MfSdkPedExPinpadUpdate(MfSdkPedPinpadUpdateCb cb)

Function

Update the external pinpad app.The pinpad app path must be in
data/pinpad.bin

Params

in

out

return
remark

MfSdkPedPinpadU
pdateCb cb

Set the callback for the update process(500ms
call once)

Nothing

For details, see MfSdkPedRet_E

static s32 AppPedPinpadUpdateCb(MfSdkPedPinpadUpdateStatus_E status, s32 total, s32

demo

updatedSize, u32 time)

{

}

return 0;

s32 ret = MfSdkPedExPinpadUpdate(AppPedPinpadUpdateCb);

If(ret == MFSDK_PED_SUCCESS )

108

Fujian MoreFun Electronic Technology Co.,Ltd.

{

//TODO

}

9.33 MfSdkPedGetExPinpadVersion

Prototype s32 MfSdkPedGetExPinpadVersion(s8 *buf, s32 bufSize)

Function Get the version of the external pinpad

Params

in
out

return
remark

bufSize

Version buff size

buf

Version buff

For details, see MfSdkPedRet_E

demo

s8 buf[20] = {0};

s32 ret = MfSdkPedGetExPinpadVersion(buf,20);

If(ret == MFSDK_PED_SUCCESS )

{

//TODO

}

9.34 MfSdkPedGetExPinpadInfo

Prototype

LIB_EXPORT s32
MfSdkPedGetExPinpadInfo(MfSdkPedPinpadInfo_T *info)

Function Get the info of the external pinpad

Params

in
out

nothing

info

pinpad info

return
remark

demo

For details, see MfSdkPedRet_E

MfSdkPedPinpadInfo_T pinfo = {0};

s32 ret = MfSdkPedPinpadInfo_T(&pinfo );

If(ret == MFSDK_PED_SUCCESS )

{

//TODO

}

109

Fujian MoreFun Electronic Technology Co.,Ltd.

9.35 MfSdkPedSetPedPinMod

Prototype LIB_EXPORT s32 MfSdkPedSetPedPinMod(s32 min, s32 max)

Function Set the external pinpad pin

Params

in

out

return
remark

s32 min

s32 max

Nothing

pin min len

pin max len

For details, see MfSdkPedRet_E.

s32 ret = MfSdkPedSetPedPinMod(4,6);

if(ret == MFSDK_PED_SUCCESS)

demo

{

}

//TODO}

9.36 MfSdkPedGetPin

Prototype LIB_EXPORT s32 MfSdkPedGetPin(s32 *len, s8 *pinBuf)

Function Gets the pin of the external pinpad

Params

in

out

return
remark

Nothing

s32 *len

Enter the pin length

s8 *pinBuf

pin

For details, see MfSdkPedPinpadStatus_E

s8 pinBuf[10]={0};

s32 pinLen=0;

s32 ret=0;

demo

ret = MfSdkPedGetPin(&pinLen,pinBuf);

if(ret == MFSDK_PED_PINPAD_PRESS_OK)

{

//pinpad press OK

}

110

Fujian MoreFun Electronic Technology Co.,Ltd.

9.37 MfSdkPedTR31LoadKBPK

Prototype s32 MfSdkPedTR31LoadKBPK(s32 gid, u8 *kbpk, u32 kbpkLen)

Function Load TR-31 clear-text KBPK

gid

kbpk

kbpkLen

Nothing

key index 0-99

kbpk value

kbpk length

For details, see MfSdkPedPinpadStatus_E

Params

in

out

return
remark

s32 ret=0;

u8 kbpk[] =

{

};

demo

0x89,0xE8,0x8C,0xF7,0x93,0x14,0x44,0xF3,

0x34,0xBD,0x75,0x47,0xFC,0x3F,0x38,0x0C

ret = MfSdkPedTR31LoadKBPK(0, kbpk, sizeof(kbpk));

if(ret == MFSDK_PED_SUCCESS)

{

//load success

}

9.38 MfSdkPedDukptLoadEncryptedKeyByTR31

Prototype

s32
MfSdkPedDukptLoadEncryptedKeyByTR31(MfSdkPedTr31KeyTy
pe_E type, s32 gid, u8 *keyblock, u32 keyblockLen)

Function Load cipher-text dukpt bdk/ipek by TR-31

Params

in

type

gid

(0 - ipek, 1 - bdk)

key index 0-99

keyblock

keyblock value

keyblockLen

keyblock length

out

Nothing

return

For details, see MfSdkPedPinpadStatus_E

111

remark

demo

Fujian MoreFun Electronic Technology Co.,Ltd.

s32 ret=0;

u8* keyblock =

"B0080B1TX00N0000D94B387D9FACD303A6AEE1DF9CECB7F8FA3D314DB43F7C0EDCBC62

E94412D427";

ret = MfSdkPedDukptLoadEncryptedKeyByTR31(MFSDK_PED_TR31_TYPE_IPEK, 1, keyblock,

strlen(keyblock));

if(ret == MFSDK_PED_SUCCESS)

{

//load success

}

9.39 MfSdkPedDukptLoadEncryptedKeyByTR31A

Prototype

s32
MfSdkPedDukptLoadEncryptedKeyByTR31A(MfSdkPedTr31KeyT
ype_E type, s32 gid, u8 *keyblock, u32 keyblockLen, u8
*pKsn ,s32 ksnLength,u8 *kvc ,s32 kvcLenth)

Function Load cipher-text dukpt bdk/ipek by TR-31

Params

type

gid

(0 - ipek, 1 - bdk)

key index 0-99

keyblock

keyblock value

in

keyblockLen

keyblock length

pKsn

ksnLength

kvcLenth

out

kvc

For details, see MfSdkPedPinpadStatus_E

Note pKsn != NULL && ksnLength > 0 will load pKsn

return
remark

demo

9.40 MfSdkPedMkskSaveEncryptedKeyByTR31

Prototype

s32 MfSdkPedMkskSaveEncryptedKeyByTR31(s32 type, u32 gid,
u8 *keyblock, u32 keyblockLen ,u8 *kvc ,s32 kvcLenth)

Function Load cipher-text mk/wk by TR-31

112

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in

type

MFSDK_MKSK_MAINKEY_TYPE
MFSDK_MKSK_PINENC_TYPE
MFSDK_MKSK_MACENC_TYPE
MFSDK_MKSK_MAGDEC_TYPE
MFSDK_MKSK_TRANSKEY_TYPE

gid

key index 0-99

keyblock

keyblock value

keyblockLen

keyblock length

kvcLenth

kvc length

out

kvc

kvc buff

return
remark

For details, see MfSdkPedPinpadStatus_E

s32 ret=0;

u8 kvc[32] = { 0 };

u8* keyblock =

"B0080B1TX00N0000D94B387D9FACD303A6AEE1DF9CECB7F8FA3D314DB43F7C0EDCBC62

E94412D427";

demo

ret = MfSdkPedMkskSaveEncryptedKeyByTR31(MFSDK_MKSK_PINENC_TYPE, 1, keyblock,

strlen(keyblock), kvc, sizeof(kvc));

if(ret == MFSDK_PED_SUCCESS)

{

//load success

}

9.41 MfSdkPedSetTransKey

Prototype s32 MfSdkPedSetTransKey(s32 gid, s8 *key)

Function Save the mksk trans key

gid

key

nothing

max 100 group (0 ~ 99)

trans key

For details, see MfSdkPedRet_E

Params

in

out

return
remark

demo

113

Fujian MoreFun Electronic Technology Co.,Ltd.

9.42 MfSdkPedGetTransKeyKvc

Prototype

s32 MfSdkPedGetTransKeyKvc(s32 gid, s8* kvcBuf, s32
kvcBufLen)

Function Save the mksk trans key

gid

max 100 group (0 ~ 99)

kvcBufLen

kvc buffer length

kvcBuf

kvc(Length 4 bytes)

For details, see MfSdkPedRet_E

Params

in

out

return
remark

demo

9.43 MfSdkPedSaveEncryptedMKByTransKey

Prototype

s32 MfSdkPedSaveEncryptedMKByTransKey(u32 gid, u8* key,
MfSdkPedDesMod_E mode, u8* kvc)

Function Save the encrypted main key by trans key

gid

key

mode

kvc

max 100 group (0 ~ 99)

encrypted main key by trans key

des mode(see 'MfSdkPedDesMod_E' enum)

kvc(Length 4 bytes)

For details, see MfSdkPedRet_E

Params

in

out

return
remark

demo

9.44 MfSdkPedDeleteTransKey

Prototype s32 MfSdkPedDeleteTransKey(s32 gid)

Function Delete the mksk trans key

Params

in

gid

max 100 group (0 ~ 99)

114

Fujian MoreFun Electronic Technology Co.,Ltd.

out

nothing

For details, see MfSdkPedRet_E

return
remark

demo

9.45 MfSdkPedRebootCmd

Prototype s32 MfSdkPedRebootCmd()

Function Reboot the external pinpad

Params

in
out

nothing

nothing

For details, see MfSdkPedRet_E

return
remark

demo

9.46 MfSdkPedGotoMainPage

Prototype s32 MfSdkPedGotoMainPage()

Function External pinpad Back to the main page

Params

in
out

nothing

nothing

For details, see MfSdkPedRet_E

return
remark

demo

9.47 MfSdkPedAesSavePlaintextKey

Prototype

s32 MfSdkPedAesSavePlaintextKey(s32 type, s32 gid, const u8 *
key,s32 length, u8*kvc)

115

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Save the aes key

MFSDK_MKSK_AES_KEY_TMK -
MFSDK_MKSK_AES_KEY_TMK2_MAG

0 - 49

keyblock value

keyblock length

type

gid

key

length

kvc

For details, see MfSdkPedRet_E.

Params

in

out

return
remark

demo

9.48 MfSdkPedTr31LoadAesKey

Prototype

s32 MfSdkPedTr31LoadAesKey(s32 gid, s32 keyType,const u8*
data, s32 size, u8 checkvalue[4])

Function Three-level key system

gid

0 - 49

Params

in

keyType

data

size

out

checkvalue

MFSDK_MKSK_AES_KEY_TMK -
MFSDK_MKSK_AES_KEY_TMK2_MAG

For details, see MfSdkPedRet_E.

return
remark

demo

9.49 MfSdkPedMkSkAesRun

Prototype

s32 MfSdkPedMkSkAesRun(s32 type, s32 gid, MfSdkPedMod_E
mode, u8 *ind, s32 size, u8 iv[16], u8 *outd, MfSdkPedDesMod_E
desMode)

Function use key aes operation

Params

in

type

key type(0x08 -

116

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_MKSK_AES_KEY_PINENC, 0x09 -
MFSDK_MKSK_AES_KEY_MACENC, 0x0A -
MFSDK_MKSK_AES_KEY_MAGENC ...
MFSDK_MKSK_AES_KEY_TMK2_MAG)

gid

mode

ind

size

iv

key grouping,max 50 group (0 - 49)

mode(see 'MfSdkPedMod_E' enum)

raw data

data length (16-bytes multiple)

initialization vector

desMode

des mode(see 'MfSdkPedDesMod_E' enum)

out

outd

calculation results

For details, see MfSdkPedRet_E.

return
remark

demo

10Communication module

10.1 Module description

This module mainly includes communication APIs.

10.2 Module structure declaration

typedef struct
{

ip[20];
char
char gateway[30];
char mask[30];
char dns[30];
}MfSdkCommLanCfg_T;

/*IP address*/

/*Local gateway*/
/*Local subnet mask*/
/*DNS*/

typedef st_wifi_ap_list MfSdkCommWifiApList_T;
typedef st_apninfo_mcc MfSdkCommApinfoMcc_T;
typedef st_apninfo MfSdkCommApnInfo_T;

10.3 Constant declarations

# define MFSDK_SYS_WIFI_DEFAULT_SAVE_PWD

"0000000000000000000"

# define MFSDK_SYS_WIFI_MAX_AP_COUNT 30

117

Fujian MoreFun Electronic Technology Co.,Ltd.

typedef enum
{

MFSDK_COMM_SOCKET_INDEX_MIN = 0,
MFSDK_COMM_SOCKET_INDEX_0 =

MFSDK_COMM_SOCKET_INDEX_MIN,

MFSDK_COMM_SOCKET_INDEX_1,
MFSDK_COMM_SOCKET_INDEX_2,
MFSDK_COMM_SOCKET_INDEX_3,
MFSDK_COMM_SOCKET_INDEX_4,
MFSDK_COMM_SOCKET_INDEX_MAX

}MfSdkCommSocketIndex_E;

typedef enum
{

MFSDK_COMM_NET_ONLY_WIRELESS = 0,
MFSDK_COMM_NET_ONLY_WIFI,
MFSDK_COMM_NET_ONLY_WIRELESS_1,

// only wireless 0

// only wifi

// only

wireless 1 (Device not supported)

MFSDK_COMM_NET_ONLY_ETHERNET,
MFSDK_COMM_NET_FIRST_WIRELESS,

// ETHERNET
// wireless

priority

MFSDK_COMM_NET_FIRST_WIFI,

// wifi priority

}MfSdkCommNetSelect_E;

typedef MfSdkCommNetSelect_E MfSdkCommMode_E;

typedef enum
{

MFSDK_COMM_UART_COM0 = 0,
MFSDK_COMM_UART_COM1,
MFSDK_COMM_UART_COM2,
MFSDK_COMM_UART_COM3,
MFSDK_COMM_UART_COM4,
MFSDK_COMM_UART_COM5,
MFSDK_COMM_UART_COM6,
MFSDK_COMM_UART_COM7,
MFSDK_COMM_UART_COM8,
MFSDK_COMM_UART_COM9,
MFSDK_COMM_UART_COM10,
MFSDK_COMM_UART_COM11,
MFSDK_COMM_UART_COM12,
MFSDK_COMM_UART_COM13,
MFSDK_COMM_UART_COM14,

118

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_COMM_UART_COM15,
MFSDK_COMM_UART_COM16,
MFSDK_COMM_UART_COM17,
MFSDK_COMM_UART_COM18,
MFSDK_COMM_UART_COM19,
MFSDK_COMM_UART_COM20,
MFSDK_COMM_UART_COM21,
MFSDK_COMM_UART_COM22,
MFSDK_COMM_UART_COM23,
MFSDK_COMM_UART_COM24,
MFSDK_COMM_UART_COM25,
MFSDK_COMM_UART_COM26,
MFSDK_COMM_UART_COM27,
MFSDK_COMM_UART_COM28,
MFSDK_COMM_UART_COM29,
MFSDK_COMM_UART_COM30,

}MfSdkCommUart_E;

typedef enum
{

MFSDK_COMM_RET_FAILED = -3, //failed
MFSDK_COMM_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_COMM_RET_PARM_ERROR = -1, //check param
MFSDK_COMM_RET_OK = 0,

}MfSdkCommRet_E;

typedef enum
{

MFSDK_COMM_ATCCPIN_FAIL = 0, //Failure
MFSDK_COMM_ATCCPIN_LOCKED,
//locked
MFSDK_COMM_ATCCPIN_NORMAL, //noraml
MFSDK_COMM_ATCCPIN_PUK //Puk

}MfSdkCommAtcCpin_E;

typedef enum
{

MFSDK_COMM_WIFI_STATE_CONNECT_PROCESS = -999,
MFSDK_COMM_WIFI_STATE_DISCONNECT_PROCESS = -998,
MFSDK_COMM_WIFI_STATE_CONNECT_START = -997,
MFSDK_COMM_WIFI_STATE_NOT_EXIST = -2,
MFSDK_COMM_WIFI_STATE_PWD_ERROR = -1,
MFSDK_COMM_WIFI_STATE_DISCONNECT = 0,
MFSDK_COMM_WIFI_STATE_CONNECT = 1,

119

Fujian MoreFun Electronic Technology Co.,Ltd.

}MfSdkCommWifiState_E;

typedef enum
{

MFSDK_COMM_MOBILE_NO_SIGNAL = 0,
MFSDK_COMM_MOBILE_1G, //The 1st Generation Mobile

Communication System

MFSDK_COMM_MOBILE_2G, //The 2nd Generation Mobile

Communication System

MFSDK_COMM_MOBILE_3G, //The 3rd Generation Mobile

Communication System

MFSDK_COMM_MOBILE_4G, //The 4th Generation Mobile

Communication System

MFSDK_COMM_MOBILE_5G,//RFU The 5th Generation Mobile

Communication System

MFSDK_COMM_MOBILE_6G,//RFU The 6th Generation Mobile

Communication System

}MfSdkCommMobileGen_E;

typedef enum
{

MFSDK_COMM_IPV4 = 1,
MFSDK_COMM_IPV6,
MFSDK_COMM_IPV4_IPV6,

//only ipv4

//only ipv6

// both ipv4 and ipv6

}MfSdkCommIpVer_E;

typedef enum
{

MFSDK_COMM_ATC_OFF = 0, // turn off
MFSDK_COMM_ATC_ON,
//turn on
}MfSdkCommAtcPowerState_E;

typedef enum
{

MFSDK_COMM_SIM_PROC_PPP_NETWORK_OK = 0,
MFSDK_COMM_SIM_PROC_NETWORK_CONNECTED,
MFSDK_COMM_SIM_PROC_NETWORK_REGISTER_NETOWK,
MFSDK_COMM_SIM_PROC_SIM_NORMAL,
MFSDK_COMM_SIM_PROC_SWITCHING_SIM,
MFSDK_COMM_SIM_PROC_NO_SIM_CARD,

}MfSdkCommSimProcStatus_E;

120

Fujian MoreFun Electronic Technology Co.,Ltd.

typedef enum
{

MFSDK_COMM_IPTYPE_V4,
MFSDK_COMM_IPTYPE_V6,

// Get IP address type IPv4
// Get IP address type IPv6

}MfSdkCommIpType_E;

10.4 MfSdkCommLinkState

Prototype LIB_EXPORT MFSDKBOOL MfSdkCommLinkState(void)

Function Get net link state for both GPRS and Wifi

Params

in
out

return

remark

demo

None

None

1

0

Linked

Disconnect

MFSDKBOOL linkState = MfSdkCommLinkState();

10.5 MfSdkCommGetNetMode

Prototype

LIB_EXPORT MfSdkCommMode_E
MfSdkCommGetNetMode(void)

Function Get Comm mode, Ref.MfSdkCommMode_E

Params

in
out

None

None

return
remark

demo

NetMode

Ref.MfSdkCommMode_E

s32 netMode = MfSdkCommGetNetMode();

10.6 MfSdkCommAtcCell

Prototype LIB_EXPORT s32 MfSdkCommAtcCell(s32 index)

121

Fujian MoreFun Electronic Technology Co.,Ltd.

Function get 1st net registered cell

index

None

Cell ID

Params

in
out

return
remark

demo

10.7 MfSdkCommAtcCellInfor

Prototype

LIB_EXPORT s32 MfSdkCommAtcCellInfor(s32 *cid, s32 size, s32
*num)

Function get net registered cell

cid

size

num

buffer

buffer size

MFSDK_COMM_RE
T_OK

Success

Other

Fail

Params

in

out

return

remark

demo

10.8 MfSdkCommAtcCpin

Prototype

LIB_EXPORT MfSdkCommAtcCpin_E MfSdkCommAtcCpin(s32
index)

Function get net registered cell

Params

in
out

index

None

MFSDK_COMM_ATCCPIN_FAI

L

return

MFSDK_COMM_ATCCPIN_LO

CKED

0~1

Fail

Locked

MFSDK_COMM_ATCCPIN_NO Normal

122

Fujian MoreFun Electronic Technology Co.,Ltd.

RMAL

MFSDK_COMM_ATCCPIN_PU

K

Puk

remark

demo

10.9 MfSdkCommAtcGetLocalIp

Prototype LIB_EXPORT s32 MfSdkCommAtcGetLocalIp(s8* ip)

Function Get local ip

Params

in
out

None

ip

return

remark

demo

MFSDK_COMM_RE
T_OK

Success

Other

Fail

s8 ip[32] = {0};

s32 ret = MfSdkCommAtcGetLocalIp(ip);

10.10 MfSdkCommAtcIccid

Prototype LIB_EXPORT const s8* MfSdkCommAtcIccid(s32 index)

Function Get index Integrate circuit card identity value

Params

in
out

return
remark

demo

0~1

index

None

Icc ID

123

Fujian MoreFun Electronic Technology Co.,Ltd.

10.11 MfSdkCommAtcImei

Prototype LIB_EXPORT const s8* MfSdkCommAtcImei(s32 index)

Function Get Module imei

0~1

index

None

imei value

Params

in
out

return
remark

demo

10.12 MfSdkCommAtcImsi

Prototype LIB_EXPORT const s8* MfSdkCommAtcImsi(s32 index)

Function Get Module imsi

0~1

index

None

imsi value

Params

in
out

return
remark

demo

10.13 MfSdkCommAtcLac

Prototype LIB_EXPORT s32 MfSdkCommAtcLac(s32 index)

Function Get net registered lac

Params

in
out

return
remark

index

None

lac value

GPRS/4G index 0-1

124

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

10.14 MfSdkCommAtcGetMcc

Prototype LIB_EXPORT s32 MfSdkCommAtcGetMcc(s32 index)

Function Get gprs MCC

Params

in
out

return
remark

demo

use 0

index

None

lac value

s32 mcc = MfSdkCommAtcGetMcc(0);

10.15 MfSdkCommAtcGetMnc

Prototype LIB_EXPORT s32 MfSdkCommAtcGetMnc(s32 index)

Function Get gprs MNC

Params

in
out

return
remark

demo

use 0

index

None

lac value

s32 mnc = MfSdkCommAtcGetMnc(0);

10.16 MfSdkCommAtcLacInfor

Prototype

LIB_EXPORT s32 MfSdkCommAtcLacInfor(s32 *lac, s32 size, s32
*num)

Function Get net registered lac

Params

in

out

lac

size

num

buffer

buffer size

lac num
125

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_COMM_RE
T_OK

Success

Other

Fail

return

remark

demo

10.17 MfSdkCommAtcSignal

Prototype LIB_EXPORT s32 MfSdkCommAtcSignal(s32 index)

Function Get Module signal

Params

in
out

return

remark

demo

index

None

0

1 - 4

GPRS/4G index 0-1

Unregistered

Signal, e.g. 1:1 grid signal

10.18 MfSdkCommGetAtcGeneration

Prototype

LIB_EXPORT MfSdkCommMobileGen_E
MfSdkCommGetAtcGeneration(s32 index)

Function Get the atc generation

Params

in
out

index

None

sim index 0-1 (Single sim card select 0)

Ref. MfSdkCommMobileGen_E

return
remark

demo

10.19 MfSdkCommGetAtcPower

Prototype

LIB_EXPORT MfSdkCommAtcPowerState_E
MfSdkCommGetAtcPower(void)

126

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Get the atc power

Params

in
out

None

None

return
remark

demo

Ref. MfSdkCommAtcPowerState_E

10.20 MfSdkCommAtcSendCmd

Prototype

LIB_EXPORT s32 MfSdkCommAtcSendCmd(s8 * cmd,s8 *
RecvData,s32 RecvSize,s32 timeout,s32 count)

Function Send and recv AT commend (4G module)

Params

in

cmd

AT cmd

RecvSize

size of recv buff

timeout

count

Timeout unit: ms

resend count

out

RecvData

0

other

return

remark

demo

recv buff

success

fail

10.21MfSdkCommGetNetSelect

Prototype

LIB_EXPORT MfSdkCommNetSelect_E
MfSdkCommGetNetSelect(void)

Function Get mode of wifi or gprs or the Priority

Params

in
out

return

None

None

0

1

WIRELESS

WIFI

Other

Ref.MfSdkCommNetSelect_E

127

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

10.22 MfSdkCommGetOperateId

Prototype LIB_EXPORT s32 MfSdkCommGetOperateId(void)

Function

Read the id of the working sim card(Only devices with two sim
cards are supported)

Params

in
out

return

remark

demo

None

None

0

1

Other

SIM 1

SIM 2

Fail

10.23 MfSdkCommGetWifiPower

Prototype LIB_EXPORT s32 MfSdkCommGetWifiPower(void)

Function Get the WiFi power

Params

in
out

return

remark

demo

None

None

0

1

Power OFF

Power ON

10.24 MfSdkCommGsmGetSignal

Prototype s32 MfSdkCommGsmGetSignal(void)

128

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Get gsm signal

Params

in
out

None

None

return
remark

demo

10.25 MfSdkCommHttpDownload

Prototype

LIB_EXPORT s32 MfSdkCommHttpDownload(s8 *url,
s8*fullpathfilename, s32 iscontinue, s32 nRetry)

Function HTTP download

url

url address

fullpathfilename The full name of the downloaded file

iscontinue

1-sequel 0-download again

nRetry

None

retry count

MFSDK_COMM_RE
T_OK

Success

Other

Fail

Params

in

out

return

remark

demo

10.26 MfSdkCommMbedtlsInit

Prototype

LIB_EXPORT s32 MfSdkCommMbedtlsInit(s32 useSession, s32
logLevel)

Function if you use mbedtls ,need init mbedtls

Params

in

out

useSession

logLevel

None

return

MFSDK_COMM_RE
T_OK

Success

129

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

Ref. MfSdkCommRet_E

remark

demo

10.27 MfSdkCommNetLink

Prototype

LIB_EXPORT s32 MfSdkCommNetLink(void * pfunc, char * apn,
s32 timeover)

Function Connect Network

pfunc

apn

Callback

GPRS apn

timeover

Connection timeout

None

MFSDK_COMM_RE
T_OK

Success

Other

Fail

Params

in

out

return

remark

demo

10.28 MfSdkCommNetLinkWithUserInfo

Prototype

LIB_EXPORT s32 MfSdkCommNetLinkWithUserInfo( char * apn,
char *user, char *pwd)

Function Connect Network

apn

user

pwd

None

GPRS apn

GPRS apn user id

GPRS apn user password

MFSDK_COMM_RE
T_OK

Success

Other

Fail

Params

in

out

return

remark

demo

130

Fujian MoreFun Electronic Technology Co.,Ltd.

10.29 MfSdkCommNetUnlink

Prototype LIB_EXPORT s32 MfSdkCommNetUnlink(void)

Function Disconnect from the network

Params

in
out

None

None

MFSDK_COMM_RE
T_OK

Success

Other

Fail

return

remark

demo

10.30 MfSdkCommSetApMode

Prototype

LIB_EXPORT s32 MfSdkCommSetApMode(MfSdkCommIpVer_E
mode)

Function set IPV version, should be called in main.c before network initial

Params

in
out

mode

None

1:only IPV4; 2:only IPV6; 3:IPV4&IPV6

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

return

remark

demo

10.31 MfSdkCommSetApnList

LIB_EXPORT s32
MfSdkCommSetApnList(MfSdkCommApnInfo_T apn_list[], s32
ncount)

Prototype

Function

131

Fujian MoreFun Electronic Technology Co.,Ltd.

apn_list[]

APN operator corresponding list

ncount

None

APN count

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

Params

in

out

return

remark

demo

10.32 MfSdkCommSetApnListMcc

Prototype

LIB_EXPORT s32
MfSdkCommSetApnListMcc(MfSdkCommApinfoMcc_T*apnlistMc
c, s32 count)

Function Set APN MCC list.

apn_list[]

APN operator corresponding list

ncount

None

APN count

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

Params

in

out

return

remark

demo

10.33 MfSdkCommSetAtcPower

Prototype

s32 MfSdkCommSetAtcPower(MfSdkCommAtcPowerState_E
flag)

Function Set the atc power

Params

in

out

flag

None

0 - Turn off atc,
1 - Turn on atc

return

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

132

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

10.34 MfSdkCommSetInitApn

Prototype

LIB_EXPORT s32 MfSdkCommSetInitApn(s8 *apn, s8 *user, s8
*pwd)

Function set gprs apn

apn

user

pwd

None

GPRS APN

GPRS USER

GRPS PASSWORD

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

Params

in

out

return

remark

demo

10.35 MfSdkCommSetNetMode

Prototype LIB_EXPORT s32 MfSdkCommSetNetMode(s32 mode)

Function Switch network switching mode

Params

in
out

mode

None

Ref. MfSdkCommNetSelect_E

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

return

remark

demo

133

Fujian MoreFun Electronic Technology Co.,Ltd.

10.36 MfSdkCommSetNetSelect

Prototype

LIB_EXPORT s32
MfSdkCommSetNetSelect(MfSdkCommNetSelect_E index)

Function

Params

in
out

return

remark

demo

index

None

Ref. MfSdkCommNetSelect_E

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

10.37 MfSdkCommSetWifiName

Prototype LIB_EXPORT s32 MfSdkCommSetWifiName(s32 mode)

Function

set wifi name, (WiFi version V5.1.2 and above support modify the wifi
name)

Params

in
out

mode

None

mode = 0: KM_AP, default: KM_(SN)

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

return

remark

demo

10.38 MfSdkCommSocketClose

Prototype

LIB_EXPORT s32
MfSdkCommSocketClose(MfSdkCommSocketIndex_E index)

Function Disconnect the server

134

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

index

None

Sock index (0-4)

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

return

remark

demo

10.39 MfSdkCommSocketConnect

Prototype

LIB_EXPORT s32
MfSdkCommSocketConnect(MfSdkCommSocketIndex_E index,
char * ip, s32 port, s32 timeout, void *func)

Function Connect to the server

index

ip

port

Sock index (0-4)

IP address

Port number

timeout

time-out period unit:ms

func

None

>=0

<0

callback function

Success

Fail

Params

in

out

return

remark

demo

10.40 MfSdkCommSocketConnectPriority

Prototype LIB_EXPORT s32 MfSdkCommSocketConnectPriority(s32 mode)

Function Set connect priority

Params

in

out

mode

None

mode=0(priority ipv4),
mode=1(priority ipv6)

return

MFSDK_COMM_RE
T_OK

Success

135

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

Ref. MfSdkCommRet_E

remark

demo

10.41 MfSdkCommSocketCreate

Prototype

LIB_EXPORT s32
MfSdkCommSocketCreate(MfSdkCommSocketIndex_E index)

Function Create socket

Params

in
out

return

remark

demo

index

None

>=0

<0

Sock index (0-4)

Success

Fail

10.42 MfSdkCommSocketFifoResize

Prototype

LIB_EXPORT s32 MfSdkCommSocketFifoResize(s32 index, s32
size)

Function

Params

in

out

return

remark

demo

index

size

None

>=0

<0

Sock index (0-4)

Success

Fail

10.43 MfSdkCommSocketRecv

Prototype

LIB_EXPORT s32
MfSdkCommSocketRecv(MfSdkCommSocketIndex_E index,

136

Fujian MoreFun Electronic Technology Co.,Ltd.

unsigned char * buff, s32 len, u32 timeover)

Function Receive data

index

Sock index (0-4)

timeover

Receive timeout

buff

len

>0

0

-1

Receive buffer

Receive length

Receive length

Timeout

Network disconnection

Params

in

out

return

remark

demo

10.44 MfSdkCommSocketSend

Prototype

LIB_EXPORT s32
MfSdkCommSocketSend(MfSdkCommSocketIndex_E index, u8*
buff, s32 size)

Function Send data

index

buff

len

None

>=0

<0

Sock index (0-4)

Send buff

Send length

Success

Fail

Params

in

out

return

remark

demo

10.45 MfSdkCommSslAuthMode

Prototype

LIB_EXPORT s32
MfSdkCommSslAuthMode(MfSdkCommSocketIndex_E index, s32
authMode)

137

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Set the certificate verification mode.

index

Sock index (0-4)

Params

in

authMode

out

None

Ref.
MBEDTLS_SSL_VERIFY_NONE
MBEDTLS_SSL_VERIFY_OPTIONAL
MBEDTLS_SSL_VERIFY_REQUIRED
MBEDTLS_SSL_VERIFY_UNSET

return

remark

demo

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

s32 sock = MfSdkCommSocketCreate(MFSDK_COMM_SOCKET_INDEX_1);

MfSdkCommSslAuthMode(sock,MBEDTLS_SSL_VERIFY_OPTIONAL);

MfSdkCommSslInit(sock, "xxxx\\ca.pem", "xxxx\\cli.crt", "xxxx\\pri.key", 1);

s32 ret = MfSdkCommSslConnect(sock,

"a2d911mzqj2e50-ats.iot.ap-south-1.amazonaws.com", 8883,NULL);

if(ret != MFSDK_COMM_RET_OK) {MfSdkCommSocketClose(sock); }

10.46 MfSdkCommSslClose

Prototype

LIB_EXPORT s32
MfSdkCommSslClose(MfSdkCommSocketIndex_E index)

Function Close handle

Params

in
out

index

None

Sock index (0-4)

return

remark

demo

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

s32 sock = MfSdkCommSocketCreate(MFSDK_COMM_SOCKET_INDEX_1);

MfSdkCommSslAuthMode(sock,MBEDTLS_SSL_VERIFY_OPTIONAL);

MfSdkCommSslInit(sock, "xxxx\\ca.pem", "xxxx\\cli.crt", "xxxx\\pri.key", 1);

s32 ret = MfSdkCommSslConnect(sock,

"a2d911mzqj2e50-ats.iot.ap-south-1.amazonaws.com", 8883,NULL);

if(ret != MFSDK_COMM_RET_OK) {MfSdkCommSocketClose(sock); }

138

Fujian MoreFun Electronic Technology Co.,Ltd.

10.47 MfSdkCommSslConnect

Prototype

LIB_EXPORT s32
MfSdkCommSslConnect(MfSdkCommSocketIndex_E index, char
* ip, s32 port, void *func)

Function Connect to the server

Params

in

out

return

remark

demo

index

ip

port

func

None

Sock index (0-4)

IP address

Port number

callback function
int (*connect_server_func)(void);

MFSDK_COMM_RET_

OK

MFSDK_COMM_RET_F

AILED

Success

Fail

s32 sock = MfSdkCommSocketCreate(MFSDK_COMM_SOCKET_INDEX_1);

MfSdkCommSslAuthMode(sock,MBEDTLS_SSL_VERIFY_OPTIONAL);

MfSdkCommSslInit(sock, "xxxx\\ca.pem", "xxxx\\cli.crt", "xxxx\\pri.key", 1);

s32 ret = MfSdkCommSslConnect(sock,

"a2d911mzqj2e50-ats.iot.ap-south-1.amazonaws.com", 8883,NULL);

if(ret != MFSDK_COMM_RET_OK) {MfSdkCommSocketClose(sock); }

10.48 MfSdkCommSslInit

Prototype

LIB_EXPORT s32 MfSdkCommSslInit(MfSdkCommSocketIndex_E
index, char * cacert, char * clientcert, char * clientkey, s32 level)

Function

Params

in

out

index

cacert

clientcert

clientkey

level

None

Sock index (0-4)

Cacert path

Clientcert path

Clientkey path

Log level default value is 1

return

MFSDK_COMM_RET_ Success

139

Fujian MoreFun Electronic Technology Co.,Ltd.

OK

MFSDK_COMM_RET_F

AILED

Fail

remark

demo

s32 sock = MfSdkCommSocketCreate(MFSDK_COMM_SOCKET_INDEX_1);

MfSdkCommSslAuthMode(sock,MBEDTLS_SSL_VERIFY_OPTIONAL);

MfSdkCommSslInit(sock, "xxxx\\ca.pem", "xxxx\\cli.crt", "xxxx\\pri.key", 1);

s32 ret = MfSdkCommSslConnect(sock,

"a2d911mzqj2e50-ats.iot.ap-south-1.amazonaws.com", 8883,NULL);

if(ret != MFSDK_COMM_RET_OK) {MfSdkCommSocketClose(sock); }

10.49 MfSdkCommSslSetHostname

Prototype

LIB_EXPORT s32
MfSdkCommSslSetHostname(MfSdkCommSocketIndex_E index ,
const char * cn)

Function Set ssl host name

Params

in
out

index

cn

Sock index (1-4)

Host name

MFSDK_COMM_RE
T_OK

success

MFSDK_COMM_RE
T_FAILED

failed

return

remark

demo

10.50 MfSdkCommSslMbedtls

Prototype LIB_EXPORT s32 MfSdkCommSslMbedtls(s32 mbedtls)

Function Whether to use mbedtls.

Params

in
out

mbedtls

1 - enable 0-disable

None

return

MFSDK_COMM_RE
T_OK

success

140

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

MfSdkCommSslMbedtls(1);

10.51 MfSdkCommSslRecv

Prototype

LIB_EXPORT s32
MfSdkCommSslRecv(MfSdkCommSocketIndex_E index, char *
pdata, s32 size)

Function Use new API MfSdkCommSocketRecv pls.

index

size

pdata

>=0

<0

Sock index (0-4)

recv data

Success

Fail

Params

in

out

return

remark

demo

10.52 MfSdkCommSslSend

Prototype

LIB_EXPORT s32
MfSdkCommSslSend(MfSdkCommSocketIndex_E index, char *
pdata, s32 size)

Function Use new API MfSdkCommSocketSend pls.

index

size

pdata

Sock index (0-4)

send data size

send data

Params

in

out

return
remark

demo

141

Fujian MoreFun Electronic Technology Co.,Ltd.

10.53 MfSdkCommSslSend2

Prototype

LIB_EXPORT s32 MfSdkCommSslSend2(s32 index, char * pdata,
s32 size)

Function Use new API MfSdkCommSocketSend pls.

index

size

pdata

Sock index (0-4)

send data size

send data

Params

in

out

return
remark

demo

10.54 MfSdkCommUartClear

Prototype

LIB_EXPORT s32 MfSdkCommUartClear(MfSdkCommUart_E
nCom)

Function Clear uart fifo buff

Params

in
out

nCom

None

For details, see MfSdkCommUart_E.

MFSDK_COMM_RE
T_OK

success

other

fail

return

remark

if(MfSdkCommUartClear(MFSDK_COMM_UART_COM10)==MFSDK_COMM_RE

T_OK)

demo

{

//clear succ

}

142

Fujian MoreFun Electronic Technology Co.,Ltd.

10.55 MfSdkCommUartClose

Prototype

LIB_EXPORT s32 MfSdkCommUartClose(MfSdkCommUart_E
nCom)

Function close uart port

Params

in
out

nCom

None

For details, see MfSdkCommUart_E.

MFSDK_COMM_RE
T_OK

success

other

fail

return

remark

if(MfSdkCommUartClose(MFSDK_COMM_UART_COM10)==MFSDK_COMM_R

ET_OK)

demo

{

//close succ

}

10.56 MfSdkCommUartGetRxBufLength

Prototype

LIB_EXPORT s32
MfSdkCommUartGetRxBufLength(MfSdkCommUart_E nCom)

Function Get receive buff len

Params

in
out

return
remark

demo

nCom

None

>=0

For details, see MfSdkCommUart_E.

receive buff len

if(MfSdkCommUartGetRxBufLength(MFSDK_COMM_UART_COM10) > 0)

{

//TODO RECV

}

143

Fujian MoreFun Electronic Technology Co.,Ltd.

10.57 MfSdkCommUartOpen

Prototype

LIB_EXPORT s32 MfSdkCommUartOpen(MfSdkCommUart_E
nCom, u32 nBaud,u32 nData,u32 nStop,u32 nParity)

Function open uart port

Params

in

out

return

remark

demo

nCom

nBaud

nData

nStop

nParity

None

For details, see MfSdkCommUart_E.

Baud rate

Data bits

Stop bits

Parity

MFSDK_COMM_RE
T_OK

success

s32 ret = MfSdkCommUartOpen(MFSDK_COMM_UART_COM10, 115200, 8, 0,

0);

if(ret == MFSDK_COMM_RET_OK)

{

//TODO

}

10.58 MfSdkCommUartRecv

Prototype

LIB_EXPORT s32 MfSdkCommUartRecv(MfSdkCommUart_E
nCom, u8* pBuffer, u32 nLength, s32 timeout)

Function receive uart port data

Params

in

out

return
remark

demo

nCom

nLength

timeout

pBuffer

For details, see MfSdkCommUart_E.

recv length

time-out period

recv buffer

>=0

receive data len

u8 recvBuf[512] = {0};

if(MfSdkCommUartRecv(MFSDK_COMM_UART_COM10,recvBuf,512,10000)>0)

{

144

Fujian MoreFun Electronic Technology Co.,Ltd.

//receive succ

}

10.59 MfSdkCommUartSend

Prototype

LIB_EXPORT s32 MfSdkCommUartSend(MfSdkCommUart_E
nCom, u8* pBuffer, u32 nLength)

Function send uart port data

Params

in

out

return
remark

nCom

pBuffer

nLength

None

>=0

For details, see MfSdkCommUart_E.

send buffer

send buffer length

send data len

u8 sendBuf[512] =12345678;

if(MfSdkCommUartSend(MFSDK_COMM_UART_COM10,sendBuf,8)==8)

demo

{

//send succ

}

10.60 MfSdkCommUartSetupComm

Prototype

LIB_EXPORT s32
MfSdkCommUartSetupComm(MfSdkCommUart_E nCom , u8*
buffer , s32 size)

Function set uart comm buffer size.Generally do not set

Params

in

out

return

remark

demo

nCom

buffer

size

None

For details, see MfSdkCommUart_E.

buffer uart comm buffer handler

buffer size

MFSDK_COMM_RE
T_OK

success

u8 buf[512] ={4096};

if(MfSdkCommUartSetupComm(MFSDK_COMM_UART_COM10,buf,4096)==MF

SDK_COMM_RET_OK)

145

Fujian MoreFun Electronic Technology Co.,Ltd.

{

//TODO

}

10.61MfSdkCommWifiClearListApNum

Prototype LIB_EXPORT s32 MfSdkCommWifiClearListApNum(void)

Function Clear wifi ap list

Params

in
out

None

None

MFSDK_COMM_RE
T_OK

success

return

remark

demo

10.62 MfSdkCommWifiGetApMac

Prototype LIB_EXPORT s8 *MfSdkCommWifiGetApMac(void)

Function Get Wifi AP MAC

None

None

AP Mac

Params

in
out

return
remark

demo

10.63 MfSdkCommWifiGetChannel

Prototype LIB_EXPORT s32 MfSdkCommWifiGetChannel(void)

Function Get wifi channel

146

Fujian MoreFun Electronic Technology Co.,Ltd.

None

None

wifi channel

Params

in
out

return
remark

demo

10.64 MfSdkCommWifiGetLinkState

Prototype

LIB_EXPORT MfSdkCommWifiState_E
MfSdkCommWifiGetLinkState(void)

Function Get connection status

Params

in
out

None

None

Ref. MfSdkCommWifiLinkState_E

return
remark

demo

10.65 MfSdkCommWifiGetLocalip

Prototype s8* MfSdkCommWifiGetLocalip(void)

Function Get Local IP

Params

in
out

return
remark

demo

None

None

wifi ip

10.66 MfSdkCommWifiGetLocalMac

Prototype LIB_EXPORT s8* MfSdkCommWifiGetLocalMac(void)

147

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Get Wifi Mac

None

None

wifi mac

Params

in
out

return
remark

demo

10.67 MfSdkCommWifiGetRssi

Prototype LIB_EXPORT s32 MfSdkCommWifiGetRssi(void)

Function Get Wifi Rssi

None

None

wifi rssi

Params

in
out

return
remark

demo

10.68 MfSdkCommWifiGetSignal

Prototype LIB_EXPORT s32 MfSdkCommWifiGetSignal(void)

Function Get Wifi Signal

None

None

wifi signal

Params

in
out

return
remark

demo

148

Fujian MoreFun Electronic Technology Co.,Ltd.

10.69 MfSdkCommWifiGetSsid

Prototype LIB_EXPORT s8* MfSdkCommWifiGetSsid(void)

Function Get Wifi Ssid

None

None

wifi ssid

Params

in
out

return
remark

demo

10.70 MfSdkCommWifiLinkAp

Prototype

LIB_EXPORT s32
MfSdkCommWifiLinkAp(MfSdkCommWifiApList_T *apList, s8
*pwd)

Function Connect to WiFi

Params

in

out

apList

pwd

None

MfSdkCommWifiApList_T item

wifi password

MFSDK_COMM_RE
T_OK

success

other

failed

return

remark

demo

10.71 MfSdkCommWifiListAp

Prototype

LIB_EXPORT s32
MfSdkCommWifiListAp(MfSdkCommWifiApList_T *apList)

Function Get the router list

Params

in

None

149

Fujian MoreFun Electronic Technology Co.,Ltd.

out

apList

Router list data, The ap_list space is allocated by
the caller with an array size of 10/30(Soundbox
10,traditional POS 30)

Number of routers

return
remark

demo

10.72 MfSdkCommWifiListApQuit

Prototype LIB_EXPORT s32 MfSdkCommWifiListApQuit(void)

Function quit the router list

Params

in
out

None

None

MFSDK_COMM_RE
T_OK

success

return

remark

demo

10.73MfSDkCommWifiListNetWork

Prototype

LIB_EXPORT s32
MfSDkCommWifiListNetWork(MfSdkCommWifiApList_T *apList)

Function Get the router save ap list

Params

in

out

None

apList

Router list data, The ap_list space is allocated by
the caller with an array size of 10/30(Soundbox
10,traditional POS 30)

return
remark

demo

150

Fujian MoreFun Electronic Technology Co.,Ltd.

10.74 MfSdkCommWifiRemoveNetWorkAp

Prototype LIB_EXPORT s32 MfSdkCommWifiRemoveNetWorkAp(s8* ssid)

Function Remove Wifi Ap

Params

in
out

ssid

None

Wifi Ap

MFSDK_COMM_RE
T_OK

success

return

remark

demo

10.75 MfSdkCommWifiSetPower

Prototype LIB_EXPORT s32 MfSdkCommWifiSetPower(s32 flag)

Function Set the WiFi power

Params

in
out

flag

None

0 - Turn off wifi power; 1 - Turn on wifi power

MFSDK_COMM_RE
T_OK

Success

other

failed

return

remark

10.76 MfSdkCommWifiSetScan

Prototype LIB_EXPORT s32 MfSdkCommWifiSetScan(s32 flag)

Function Start scan wifi

Params

in

out

flag

None

0:stop scan 1:auto scan one time 2:scan
immediately one time

151

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_COMM_RE
T_OK

success

other

failed

return

remark

10.77 MfSdkCommWifiUnlinkAp

Prototype LIB_EXPORT s32 MfSdkCommWifiUnlinkAp(s8* ssid)

Function Unlink wifi ap

Params

in
out

ssid

None

wifi ap

MFSDK_COMM_RE
T_OK

success

other

failed

return

remark

10.78 MfSdkCommSet4gMode

Prototype LIB_EXPORT s32 MfSdkCommSet4gMode(void)

Function set net to 4G mode

Params

in
out

None

None

MFSDK_COMM_RE
T_OK

Success

return

remark

demo

10.79 MfSdkCommWifiCheckState

Prototype LIB_EXPORT s32 MfSdkCommWifiCheckState(void)

152

Fujian MoreFun Electronic Technology Co.,Ltd.

Function check wifi state

Params

in
out

return

remark

demo

None

None

1

Success

Other

Fail

10.80 MfSdkCommWifiStartConfig

Prototype LIB_EXPORT s32 MfSdkCommWifiStartConfig(void)

Function start config wifi

Params

in
out

None

None

MFSDK_COMM_RE
T_OK

Success

return

remark

demo

10.81 MfSdkCommUartInit

Prototype LIB_EXPORT void MfSdkCommUartInit(void)

Function init device uart

Params

in
out

None

None

return
remark

demo

153

Fujian MoreFun Electronic Technology Co.,Ltd.

10.82 MfSdkCommLanCableCheck

Prototype LIB_EXPORT s32 MfSdkCommLanCableCheck(void)

Function Whether the device is connected to a network cable

Params

in
out

return

remark

demo

None

None

0

1

unconnected

connected

10.83 MfSdkCommLanSetDHCP

Prototype LIB_EXPORT s32 MfSdkCommLanSetDHCP(int mod)

Function Set whether to enable DHCP

Params

in

out

mod

None

1 enable,
0 disenable

MFSDK_COMM_RE
T_OK

Success

Other

Ref. MfSdkCommRet_E

return

remark

demo

10.84 MfSdkCommLanIsDHCP

Prototype LIB_EXPORT s32 MfSdkCommLanIsDHCP()

Function Whether to enable DHCP

154

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

return

remark

demo

None

None

0

1

disenable

enable

Other

Ref. MfSdkCommRet_E

10.85MfSdkCommLanCfg

Prototype

LIB_EXPORT void MfSdkCommLanCfg(const
MfSdkCommLanCfg_T *lanCfg)

Function Configuring Ethernet

Configuring Ethernet

lanCfg

None

Nothing

Params

in
out

return
remark

demo

10.86 MfSdkCommGetSwitchSimProcStatus

Prototype

LIB_EXPORT MfSdkCommSimProcStatus_E
MfSdkCommGetSwitchSimProcStatus()

Function get the status of the sim card switchover

Params

in
out

None

None

For details, see MfSdkCommSimProcStatus_E

return
remark

demo

155

Fujian MoreFun Electronic Technology Co.,Ltd.

10.87 MfSdkCommSetOperateIdTask

Prototype LIB_EXPORT s32 MfSdkCommSetOperateIdTask(s32 val)

Function

set the id of the working sim card(nonblocking)(Only devices with two
sim cards are supported)

value

None

>=0

Other

0: sim 1,
1: sim 2

Success

Fail

Params

in

out

return

remark

demo

10.88 MfSdkCommWifiPageInitMode

Prototype

LIB_EXPORT void MfSdkCommWifiPageInitMode(void* state,int
mode)

Function init wifi logo

lv_obj_t*

logo color 0-black ,1-white

state

mode

None

None

Params

in

out

return
remark

demo

10.89 MfSdkCommWifiPageInit

Prototype

LIB_EXPORT void MfSdkCommWifiPageInit(void* obj, int align,
int x_ofs, int y_ofs)

Function init wifi page.

Params

in

obj

lv_obj_t*

156

Fujian MoreFun Electronic Technology Co.,Ltd.

ref. lv_align_t

x offset

y offset

align

x_ofs

y_ofs

None

None

out

return
remark

demo

10.90 MfSdkCommAtcPageInit

Prototype

LIB_EXPORT void MfSdkCommAtcPageInit(void* obj, int align, int
x_ofs, int y_ofs)

Function init gprs page

lv_obj_t*

ref. lv_align_t

x offset

y offset

obj

align

x_ofs

y_ofs

None

None

Params

in

out

return
remark

demo

10.91 MfSdkCommAtcPageInitMode

Prototype

LIB_EXPORT void MfSdkCommAtcPageInitMode(void* state,int
mode)

Function init GSM logo

Params

in

out

return
remark

demo

lv_obj_t*

logo color 0-black ,1-white

state

mode

None

None

157

Fujian MoreFun Electronic Technology Co.,Ltd.

10.92 MfSdkCommLanEnable

Prototype LIB_EXPORT s32 MfSdkCommLanEnable();

Function enable Ethernet

Params

in

None

out

None

return
remark

demo

For details, see MfSdkCommRet_E

10.93 MfSdkCommLanDisenable

Prototype LIB_EXPORT s32 MfSdkCommLanEnable();

Function disenable Ethernet

Params

in

None

out

None

return
remark

demo

For details, see MfSdkCommRet_E

10.94 MfSdkCommAtcGetIp

Prototype

LIB_EXPORT s32 MfSdkCommAtcGetIp(MfSdkCommIpType_E
ipType, s8* ip ,s32 length)

Function Get local IP, default IPv4

Params

in

out

ipType

length

ip

IPv4/IPv6

ip buffer size

ip buffer

158

Fujian MoreFun Electronic Technology Co.,Ltd.

> 0

other

ip length

failed

return

remark

demo

10.95 MfSdkCommLanGetEthernetPower

Prototype LIB_EXPORT s32 MfSdkCommLanGetEthernetPower(void);

Function Get Ethernet Power

Params

in
out

return

remark

demo

None

None

1

0

Turn on

Turn off

10.96 MfSdkCommLanSetEthernetPower

Prototype LIB_EXPORT s32 MfSdkCommLanSetEthernetPower(s32 flag);

Function Set Ethernet Power

Params

in
out

flag

None

0 - Turn off , 1 - Turn on

return

remark

demo

For details, see MfSdkCommRet_E

10.97 MfSdkCommLanChipExist

Prototype LIB_EXPORT s32 MfSdkCommLanChipExist()

159

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Check if the device has a WiFi chip

Params

in
out

return

remark

demo

None

None

1

0

Have WiFi chip

No WiFi chip

10.98 MfSdkCommWifiChipExist

Prototype LIB_EXPORT s32 MfSdkCommWifiChipExist()

Function Check if the device has a Ethernet chip

Params

in
out

return

remark

demo

None

None

1

0

Have Ethernet chip

No Ethernet chip

10.99 MfSdkCommAtcSetNetMode

Prototype LIB_EXPORT void MfSdkCommAtcSetNetMode(s32 mode)

Function Set network mode

Params

in

out

return
remark

demo

mode

None

None

0 = "AUTO";1 = "only 2G";2 = "only 3G"; 3 =
"only 4G";4 = "2G_3G";5 = "2G_3G_4G";

160

Fujian MoreFun Electronic Technology Co.,Ltd.

10.100 MfSdkCommAtcSendAtCmd

Prototype

LIB_EXPORT s32 MfSdkCommAtcSendAtCmd(s8* cmd, s32
timeover, s8* retstr, s32 len, s32 count)

Function Send AT command

cmd

at cmd

timeover

timeover(ms)

len

count

retstr

0

Other

AT cmd len

retry count

Returned data

Success

Failure

Params

in

out

return

remark

demo

10.101 MfSdkCommLanGetIpAndMask

Prototype

LIB_EXPORT s32 MfSdkCommLanGetIpAndMask(s8* ip, s8*
Mask);

Function Get Ethernet IP and mask

ip

Mask

None

0

Other

ip info

mask info

Success

Failure

Params

out

in

return

remark

demo

10.102 MfSdkCommLanGetGateway

Prototype LIB_EXPORT s32 MfSdkCommLanGetGateway(s8* gateway)

161

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Gateway Gateway info

None

Gateway

Gateway info

0

Other

Success

Failure

Params

in
out

return

remark

demo

10.103 MfSdkCommLanGetDns

Prototype

LIB_EXPORT s32 MfSdkCommLanGetDns(s8 dnsArr[][64], s32
dnsArrCount);

Function Get Ethernet DNS

Params

in
out

dnsArrCount

dns array count

dnsArr

dns info

return

remark

>0

Other

Success,count of DNS

Failure

10.104 MfSdkCommLanGetMac

Prototype LIB_EXPORT s32 MfSdkCommLanGetMac(s8* mac);

Function Get Ethernet mac

Params

in
out

return

remark

demo

None

mac

0

Other

mac info

Success

Failure

162

Fujian MoreFun Electronic Technology Co.,Ltd.

10.105 MfSdkCommConfigReset

Prototype LIB_EXPORT void MfSdkCommConfigReset(void);

Function Reply to network connection status

Params

in
out

return
remark

demo

None

None

None

10.106 MfSdkCommWifiStopConfig

Prototype LIB_EXPORT void MfSdkCommWifiStopConfig(void);

Function WIFI stop config network

Params

in
out

return
remark

demo

None

None

None

10.107 MfSdkCommWifiRestart

Prototype LIB_EXPORT void MfSdkCommWifiRestart(void)

Function Restart the WiFi module only for ET389

Params

in
out

return
remark

None

None

None

163

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

10.108 MfSdkCommSetPingAddr

Prototype LIB_EXPORT s32 MfSdkCommSetPingAddr(u8* addr);

Function Set ping address

Params

in
out

return

remark

demo

addr

None

0

Other

address.example:"www.baidu.com"

Success

Failure

10.109 MFSdkCommSocketGetModelType

Prototype

LIB_EXPORT int MFSdkCommSocketGetModelType(int
socket_index);

Function Get current model type

socket_index

socket index

None

0

1

WIRELESS

WIFI

Params

in
out

return

remark

demo

11 EMV module

11.1 Module description

This module mainly includes EMV setting.

164

Fujian MoreFun Electronic Technology Co.,Ltd.

11.2 Module structure declaration

typedef struct
{

u8 cTranType;// 00 sale 09 cashback
u8 szAmt [12+1];
u8 szOtherAmt[12+1];
u8 cReadCardMode;// refer to MfSdkCardMode . Can be combined ,

0x07 is all

//

u8 cPinInput;
u8 cPinMinLen;
u8 cPinMaxLen;
u8 cKeyPid;//

SEC_DUKPT_FIELD,SEC_MKSK_FIELD,SEC_FIXED_FIELD

u8 cDukptPinIndex;
u8 cDukptDataIndex;
u8 cDesMode;
u8 cMKSKPinIndex;
u8 cPinFormat; //refer to SEC_PIN_FORMAX in libapi_security.h
u8 cBypassPin;
}sdk_read_card_in;

//DES_MODE_ECB,DES_MODE_CBC

typedef struct
{

u8 cCardType;
u8 szPan[22];
u8 szPinBlock[16+1];
u8 szPinKSN[10+1];
u8 szDataKSN[10+1];
u8 szTrack2[SDK_TRACK_MAX_LENTH];
u8 cTrack2Len;
u8 szTrack3[SDK_TRACK_MAX_LENTH];
u8 cTrack3Len;
u8 cEmvClsMode;
u8 szServiceCode[3+1];
u8 cClsCvmMethod;
u16 nErrCode;
}sdk_read_card_out;

ypedef struct {

u8 szRid[5];
u8 cCapkIndex;

//tag 9f06

//tag 9f22

165

Fujian MoreFun Electronic Technology Co.,Ltd.

u8 szCapkExpire[4];
u8 cCapkHashFlag;
u8 cCapkFlag;
u8 szCapkMod[248];
u8 cCapkModLen;
u8 szCapkExponent[3];
u8 cCapkExpLen;
u8 szCapkCheckSum3[20];
u8 cCheckSumLen;
}MfSdkEmvCapkInfo_T;

//tag df05
//tag df06
//tag df07
//tag df02

//szCAPKMod len

//tag df04
//szCAPKExponent len

//tag df03

//szCAPKCheckSum3 len

typedef st_read_card_in MfSdkEmvReadCardIn_T;
typedef st_read_card_out MfSdkEmvReadCardOut_T;
typedef card_magtek_track_info MfSdkEmvTrackInfo_T;
typedef AID_STRU MfSdkEmvAidSt_T;

11.3 Constant declarations

# define MODE_API_UNKNOW

0x00

///<

unknown api mode

# define MODE_API_PBOC
# define MODE_API_VCPS
# define MODE_API_MSD
# define MODE_API_AMEX
# define MODE_API_M_CHIP

0x01
0x02

///< pboc
///< vcps

0x04

///< msd

0x40
0x21

///< AMEX
///< MasterCard

CHIP mode

# define MODE_API_M_STRIPE

0x22

///< MasterCard

MagStripe mode

# define MODE_API_R_LEGACY

0x23

///< RUPAY

LEGACY mode

# define MODE_API_R_NON_LEGACY 0x24

///< RUPAY NON

LEGACY mode

# define MODE_API_EMV_MODE

0x25

///< EMV_MODE

(for AMEX)

# define MODE_API_MS_MODE
(for AMEX)
# define MODE_API_MOBILE_MODE 0x27

0x26

///< MS_MODE

///<

mobile_MODE (for amex)

// application TLV TAG

# define APP_TAG_DF8A01_AIDOTHERTLV
"\xDF\x8A\x01"

// aid other tlv

166

Fujian MoreFun Electronic Technology Co.,Ltd.

# define APP_TAG_DF8A02_FORCEONLINE
"\xDF\x81\x02"

//0:no forced online; 1:forced online(TVR) 2:foced

online (request ARQC in case of TC)

# define DEF_TAG_AID_MCHIP_OTHER_PARAM
"\xDF\x84\x06"
# define DEF_TAG_AID_RF_OTHER_PARAM
"\xDF\x84\x07"
# define DEF_TAG_TAP_MODE

//AID other contactless

//AID other Contact

//tap mode (1-long tap 2-second tap)

"\xDF\x84\x08"

# define DEF_TAG_CONTACTLESS_REFUN_CONFIG
"\xDF\x84\x0A"
# define APP_TAG_DF810C_KERNELID
"\xDF\x81\x0C"
# define SDK_TRACK_MAX_LENTH

// Contactless Refund Config

// Kernel ID

144

enum
{

SDK_QPBOC_VER=0,
SDK_VISA_VER,
SDK_MASTER_VER,
SDK_AMEX_VER,
SDK_DPAS_VER,
SDK_RUPAY_VER,

}SDK_KERNEL_VER;
enum
{

SDK_KERNELID_MASTER = 0x02,
SDK_KERNEID_VISA,
SDK_KERNELID_AMEX,
SDK_KERNELID_JCB,
SDK_KERNELID_DISCOVER,
SDK_KERNELID_UNIONPAY,
SDK_KERNELID_SIBS,
SDK_KERNELID_PURE,

}SDK_KERNEL_ID;

enum
{

MSG_SELECT_APP,
MSG_ONLINE_PIN,
MSG_OFFLINE_PIN,
MSG_OFFLINE_PIN_RETRY_COUNT,

167

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_EMV_MSG_DISPLAY_CARD_NO, // display card no.
MFSDK_EMV_MSG_SET_PUREAMT_BEFOREGPO,

}CALLBACK_MSG;

enum
{

///< quit

MFSDK_EMV_CARD_RET_QUIT,
MFSDK_EMV_CARD_RET_INPUT,///< input
MFSDK_EMV_CARD_MAGTEK,
MFSDK_EMV_CARD_ICC,
MFSDK_EMV_CARD_RFID,

///< RF

///< magstripe card
///< ICC

}MfSdkEmvReadCardMode_E;

enum
{

MFSDK_EMV_CARD_PROC_RET_TC = 0,

///< TC (offine

approve)

MFSDK_EMV_CARD_PROC_RET_ARQC = 1,

///< ARQC(online

require)

MFSDK_EMV_CARD_PROC_RET_AAC = -11, ///< AAC(offline

declined)

///< Terminate
MFSDK_EMV_CARD_PROC_RET_TERM = - 2,
MFSDK_EMV_CARD_PROC_RET_CANCEL = -3, // User cancel
MFSDK_EMV_CARD_PROC_RET_TIMEOUT = -4,
MFSDK_EMV_CARD_PROC_RET_FORCEIC = -5,

//Timeout
//Transaction

force IC

MFSDK_EMV_CARD_PROC_RET_OTHER = -6,

//Contactless

turn to other interface

MFSDK_EMV_CARD_PROC_RET_FALLBACK = -7, // Fallback
MFSDK_EMV_CARD_PROC_RET_SEEPHONE = -8,

// See

Phone and Retry

MFSDK_EMV_CARD_PROC_RET_APPBLOCK = -9, //app block
MFSDK_EMV_CARD_PROC_RET_CARDBLOCK = -10,
MFSDK_EMV_CARD_PROC_RET_NOAPP = -12,

//Card block
//card

without any application available

MFSDK_EMV_CARD_PROC_RET_ERR_POWERUP = -13, //card not

responding or chip not present

MFSDK_EMV_CARD_PROC_RET_INVDATA = -14,

//card

behaves correctly but has invalid or inconsistent data.

MFSDK_EMV_CARD_PROC_RET_APPNAUT = -15,

//card

returned error 6985

MFSDK_EMV_CARD_PROC_RET_CAPK_NOFOUND = -16,

//card

CAPK not found

168

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_EMV_CARD_PROC_RET_APDU_NORETURN = -17,

} MfSdkEmvCardProcRet_E;
enum {

MFSDK_READ_CARD_MODE_MAG = 0x01,
MFSDK_READ_CARD_MODE_IC = 0x02,
///< ic
MFSDK_READ_CARD_MODE_RF = 0x04 ///< rf

///< magstripe

}MfSdkCardMode;

typedef int(*MfSdkEmvSelecAppDisplay)(MfSdkEmvAidSt_T *stICCAID,int

nAidNum,int *select_choic);

typedef int (*MfSdkEmvInputOffPin)(char *psCardNo,char *psAmt,char

cMsgType,char *psPin);

typedef int (*MfSdkEmvInputOnlinePin)(char *psCardNo,char *psAmt,char

*psPin);

typedef void (*MfSdkReadPage)(void);

typedef int (*MfSdkRuPay2ndPage)(void);

typedef int (*MfSdkDpas2ndPage)(void);
typedef int (*MfSdkPreprocessSetOtherDataCb)(u8*pOutData ,s32

iOutData);

11.4 MfSdkEmvKernelInit

Prototype LIB_EXPORT void MfSdkEmvKernelInit(void)

Function Emv kernel init

Param
s

in
out

return

remark

demo

Nothing

Nothing

< 0

0

Failed

Success

MfSdkEmvKernelInit()

169

Fujian MoreFun Electronic Technology Co.,Ltd.

11.5 MfSdkEmvTerminalConfigInit

Prototype

LIB_EXPORT s32 MfSdkEmvTerminalConfigInit(u8*
ConfigBuff,s32 BuffLen)

Function Set emv terminal configuration

ConfigBuff:

Terminal parameters(all in tlv format)

BuffLen

Nothing

< 0

0

Length of configBuff

Failed

Success

Param
s

in

out

return

remark

demo

11.6 MfSdkEmvCardLoop

Prototype

LIB_EXPORT s32 MfSdkEmvCardLoop(s32 cardMode,s32
timeout)

Function Loop detection card

CardMode

0x01:mag, 0x02:ICC,0x04:RFIC,0x07:All

Param
s

in

out

return

remark
demo

timeout

Nothing

Unit is seconds

> 0

0

-3

-4

Ref. MfSdkCardMode

No card

It meams timeout.

Multiple cards

s32 ret = MfSdkEmvCardLoop(0x01 | 0x02 | 0x04,60);

170

Fujian MoreFun Electronic Technology Co.,Ltd.

if(MFSDK_READ_CARD_MODE_MAG == ret){

//TODO magstripe

}

else if(MFSDK_READ_CARD_MODE_IC == ret){

//TODO contact

}

else if(MFSDK_READ_CARD_MODE_RF == ret){

//TODO contactless

}

11.7 MfSdkEmvCardProc

Prototype

LIB_EXPORT s32 MfSdkEmvCardProc(s32
ret,sdk_read_card_in st_in,u8* inBuff,s32
inLen,sdk_read_card_out * st_out)

Function Card reading process

ret

cardType: return value of "MfSdkEmvCardLoop"

st_in

inbuff

inLen

st_out

Param
s

in

out

return
remark

demo

11.8 MfSdkEmvGetCard

Prototype

LIB_EXPORT s32 MfSdkEmvGetCard(s32 ret,u8*
inBuff,u8*outBuff);

171

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Only for BC

ret

inBuff

outBuff

None

Params

in

out

return
remark

demo

11.9 MfSdkEmvGoOnChip

Prototype

LIB_EXPORT s32 MfSdkEmvGoOnChip(s32 ret,u8*
inBuff,u8*outBuff);

Function Only for BC

ret

inBuff

outBuff

None

Params

in

out

return
remark

demo

11.10 MfSdkEmvSetAid

Prototype LIB_EXPORT s32 MfSdkEmvSetAid(u8* AidBuff,s32 BuffLen)

Function Add one aid

AidBuff

TLV hex format

Param
s

in

out

return

remark
demo

BuffLen

st_out

< 0

0

Failed

Success

172

Fujian MoreFun Electronic Technology Co.,Ltd.

11.11 MfSdkEmvDeleteOneAid

Prototype

LIB_EXPORT s32 MfSdkEmvDeleteOneAid(u8* Aid,u8
aidLength)

Function delete one aid

Aid

Aid buff

Param
s

in

out

aidLength

None

< 0

0

Failed

Success

return

remark

demo

11.12 MfSdkEmvClearAllAid

Prototype LIB_EXPORT void MfSdkEmvClearAllAid(void);

Function delete all aid

None

None

< 0

0

Failed

Success

Param
s

in
out

return

remark

demo

173

Fujian MoreFun Electronic Technology Co.,Ltd.

11.13 MfSdkEmvGetAidNum

Prototype LIB_EXPORT s32 MfSdkEmvGetAidNum(void);

Function The total number of aids

None

None

>0

Other

aid total

Fail

Param
s

in
out

return

remark

demo

11.14 MfSdkEmvSetCapk

Prototype

LIB_EXPORT s32 MfSdkEmvSetCapk(u8 * CapkBuff,s32
BuffLen);

Function add one capk

CapkBuff

CapkBuff TLV format

None

0

Other

success

Fail

Param
s

in
out

return

remark

demo

11.15 MfSdkEmvDeleteAllCapk

Prototype LIB_EXPORT s32 MfSdkEmvDeleteAllCapk(void);

Function delete all capk

Param
s

in
out

None

None

174

Fujian MoreFun Electronic Technology Co.,Ltd.

0

Other

success

Fail

return

remark

demo

11.16 MfSdkEmvGetCapkNum

Prototype LIB_EXPORT s32 MfSdkEmvGetCapkNum(void);

Function The total number of capks

None

None

>=0

Other

capk total

Fail

Param
s

in
out

return

remark

demo

11.17 MfSdkEmvGetCapkByIndex

Prototype

LIB_EXPORT s32
MfSdkEmvGetCapkByIndex(MfSdkEmvCapkInfo_T* stCapk,
s32 nRecNum);

Function get capk info by index

nRecNum

index

stCapk

=0

Other

capk info

success

Fail

Param
s

in
out

return

remark

demo

175

Fujian MoreFun Electronic Technology Co.,Ltd.

11.18 MfSdkEmvGetDataByTag

Prototype

LIB_EXPORT s32 MfSdkEmvGetDataByTag(u8* Tag,u8*
Src,s32 ScrLen,u8* OutBuff,s32* OutLen);

Function Get tag data from TLV string(hex format)

Tag

Src

ScrLen

OutBuff

OutLen

=0

Other

Tag

Src

Scr Len

Out Buff

Out Buff Len

success

Fail

Param
s

in

out

return

remark

demo

11.19 MfSdkEmvGetKernelData

Prototype

LIB_EXPORT s32 MfSdkEmvGetKernelData(u8* Tag,s32*
OutValueLen,u8* OutValue)

Function Get emv tag from kernel

Param
s

in

out

Tag

OutValueLen

OutValue

< 0

0

Failed

Success

return

remark

demo

176

Fujian MoreFun Electronic Technology Co.,Ltd.

11.20 MfSdkEmvGetDataByTag

Prototype

LIB_EXPORT s32 MfSdkEmvGetDataByTag(u8* Tag,u8*
Src,s32 ScrLen,u8* OutBuff,s32* OutLen)

Function Get tag data from TLV string(hex format)

Tag

Src

ScrLen

OutBuff

OutLen

< 0

0

Failed

Success

Param
s

in

out

return

remark

demo

11.21 MfSdkEmvPackTLVData

Prototype

LIB_EXPORT s32 MfSdkEmvPackTLVData(u8* Tag,u8*
TagValue,s32 ValueLen,u8* OutBuff,s32* OutLen)

Function Packed TLV string to an array

Tag

in

TagValue

Param
s

out

return

remark
demo

ValueLen

OutBuff

OutLen

< 0

0

Failed

Success

177

Fujian MoreFun Electronic Technology Co.,Ltd.

11.22 MfSdkEmvSetKernelData

Prototype

LIB_EXPORT s32 MfSdkEmvSetKernelData(u8* Tag,u8*
SetData,s32 DataLen,s32 bOverRide)

Function Get tag data from TLV string(hex format)

Tag

SetData

DataLen

bOverRide

YES or No

< 0

0

Failed

Success

Param
s

in

out

return

remark

demo

11.23 MfSdkEmvSetDRL

Prototype LIB_EXPORT s32 MfSdkEmvSetDRL(TERMDRL stDRL)

Function Set visa and amex DRL config

stDRL

None

< 0

0

Param
s

in
out

return

remark

demo

Failed

Success

178

Fujian MoreFun Electronic Technology Co.,Ltd.

11.24 MfSdkEmvClearDRLFile

Prototype LIB_EXPORT s32 MfSdkEmvClearDRLFile()

Function clear all DRL

None

None

< 0

0

Failed

Success

Param
s

in
out

return

remark

demo

11.25 MfSdkEmvMatchErrCode

Prototype LIB_EXPORT s32 MfSdkEmvMatchErrCode(u32 iErrcode)

Function Match error code

Param
s

in
out

iErrcode

None

< 0

0

Failed

Success

return

remark

demo

179

Fujian MoreFun Electronic Technology Co.,Ltd.

11.26 MfSdkEmvOnlineRespPack

Prototype

LIB_EXPORT s32 MfSdkEmvOnlineRespPack(s32
nOnlineRes,s8* sField39,u8* sField55,u8* EmvTag,u8*
PackValue,s32* packLen)

Function Process of emv online resp proc and pack tlv data

nOnlineRes

0--online success(Any return in the server is
success)

-1--online fail

sField39

sField55

EmvTag

PackValue

packLen

< 0

0

Failed

Success

Param
s

in

out

return

remark

demo

11.27 MfSdkEmvCardFree

Prototype LIB_EXPORT s32 MfSdkEmvCardFree(s32 Type)

Function Process of emv online resp proc and pack tlv data

Type

None

< 0

0

Param
s

in
out

return

remark

demo

2:free icc card data; 3:free rfic card data

Failed

Success

180

Fujian MoreFun Electronic Technology Co.,Ltd.

11.28 MfSdkEmvAddCardBlackList

Prototype

LIB_EXPORT s32 MfSdkEmvAddCardBlackList(BlackCard
stBlackCard,s32 cCoverFlag)

Function Add one card black list

stBlackCard

cCoverFlag

None

< 0

0

Failed

Success

Param
s

in

out

return

remark

demo

11.29 MfSdkEmvDelCardBlackList

Prototype

LIB_EXPORT s32 MfSdkEmvDelCardBlackList(BlackCard
stBlackCard)

Function detlete one card black list

stBlackCard

None

< 0

0

Failed

Success

Param
s

in
out

return

remark

demo

11.30 MfSdkEmvGetVersion

Prototype LIB_EXPORT s32 MfSdkEmvGetVersion(s8 *Version)

181

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Get emv version

Version

None

< 0

0

Version string

Failed

Success

Param
s

in
out

return

remark

demo

11.31 MfSdkEmvGetEntryVersion

Prototype LIB_EXPORT s32 MfSdkEmvGetEntryVersion(s8* Version)

Function Get emv entry version

Version

Version string

None

< 0

0

Failed

Success

Param
s

in
out

return

remark

demo

11.32 MfSdkEmvGetContactlessVersion

Prototype

LIB_EXPORT s32 MfSdkEmvGetContactlessVersion(s32
KernelType,s8* Version)

Function Get emv contactless version

Version

Version string

Param
s

in

out

return

KernelType:

refer to SDK_KERNEL_VER

None

< 0

0

Failed

Success

182

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

11.33 MfSdkEmvSetCallBackFunction

Prototype

LIB_EXPORT void MfSdkEmvSetCallBackFunction(s32
(*callback)(s32 MsgType,u8* Indata,s32 InLen,u8*
OutData,s32* Outlen))

Function Set emv callback function

callback

callback func

MsgType

refer to CALLBACK_MSG

Param
s

in

out

return

remark

demo

Indata:

InLen

OutData

Outlen

< 0

0

Failed

Success

11.34 MfSdkEmvReadCardPage

Prototype

lv_obj_t*MfSdkEmvReadCardPage(lv_obj_t
*parent,void*pfunc,MfSdkEmvReadCardIn_T *pCardIn,
MfSdkEmvReadCardOut_T *pCardOut);

Function create read card page

Params

in

out

parent

pCardIn

pfunc

lvgl parent obj

Card In parameter

callback

183

Fujian MoreFun Electronic Technology Co.,Ltd.

pCardOut

Card out parameter

lv_obj_t*

lvgl page obj

return
remark

demo

11.35 MfSdkEmvSetSelectAppCallback

Prototype

void
MfSdkEmvSetSelectAppCallback(MfSdkEmvSelecAppDisplay
pFunc);

Function Mutil App select

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.36 MfSdkEmvOfflinePinCallback

Prototype void MfSdkEmvOfflinePinCallback(MfSdkEmvInputOffPin pFunc);

Function offline pin callback

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.37 MfSdkEmvOnlinePinCallback

Prototype

void MfSdkEmvOnlinePinCallback(MfSdkEmvInputOnlinePin
pFunc);

184

Fujian MoreFun Electronic Technology Co.,Ltd.

Function online pin callback

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.38 MfSdkEmvSetReadPageCallback

Prototype void MfSdkEmvSetReadPageCallback(MfSdkReadPage pFunc);

Function display read card processing

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.39 MfSdkEmvSetRuPay2ndTapCallback

Prototype

void MfSdkEmvSetRuPay2ndTapCallback(MfSdkRuPay2ndPage
pFunc);

Function second tap UI

callback

pFunc

None

None

Params

in
out

return
remark

demo

185

Fujian MoreFun Electronic Technology Co.,Ltd.

11.40 MfSdkEmvSetDpas2ndTapCallback

Prototype

void MfSdkEmvSetDpas2ndTapCallback(MfSdkDpas2ndPage
pFunc);

Function second tap UI

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.41 MfSdkEmvGetPageWin

Prototype lv_obj_t* MfSdkEmvGetPageWin(void);

Function Get EMV lvgl page handler

Params

in
out

None

None

lv_obj_t*

EMV lvgl page handler

return
remark

demo

11.42 MfSdkEmvSetPreprocessOtherDataCallback

Prototype

void
MfSdkEmvSetPreprocessOtherDataCallback(MfSdkPreprocessSe
tOtherDataCb pFuncCallback);

Function set contactless other data callback

Params

in
out

return
remark

pFunc

None

None

callback

186

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

11.43 MfSdkEmvGetPageWinTip

Prototype lv_obj_t* MfSdkEmvGetPageWinTip(void);

Function set contactless other data callback

callback

pFunc

None

None

Params

in
out

return
remark

demo

11.44 MfSdkEmvGetProcInfo

Prototype s32 MfSdkEmvGetProcInfo(s8* outBuf, s32 bufLen);

Function Get read card information

bufLen

outBuf

None

buff len.

buff(>4096) ,ASCII format

Params

in
out

return
remark

demo

11.45 MfSdkEmvCallbackEventSetAmtBeforeGpo

Prototype

void MfSdkEmvCallbackEventSetAmtBeforeGpo(void);

Function set amount before gpo

Params

in
out

return

None

None

None

187

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

11.46 MfSdkEmvCallbackEventGetAmtBeforeGpo

Prototype

s32 MfSdkEmvCallbackEventGetAmtBeforeGpo(void);

Function get amount before gpo

Params

in
out

return

remark

demo

None

None

0x00

0x01

11.47 MfSdkEmvCallbackEventClear

Prototype

void MfSdkEmvCallbackEventClear(void);

Function clear emv callback event

Params

in
out

return
remark

demo

None

None

None

11.48 MfSdkEmvCallbackEventClear

Prototype

char* MfSdkEmvGetEmvL2Version(void);

Function Get EMV(contact) kernel L2 cert version

188

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

None

None

!=NULL

EMV(contact) kernel L2 cert version

return
remark

demo

11.49 MfSdkEmvGetEmvL2KernelName

Prototype

char* MfSdkEmvGetEmvL2Version(void);

Function Get EMV(contact) kernel L2 cert kernel name

Params

in
out

None

None

!=NULL

EMV(contact) kernel L2 cert version

return
remark

demo

11.50 MfSdkEmvGetAidsInit

Prototype

void *MfSdkEmvGetAidsInit(void);

Function aid params init

ref. MfSdkEmvGetAidsFree

Params

in
out

None

None

!=NULL

aids pointer

return
remark

demo

11.51 MfSdkEmvGetAid

Prototype

s32 MfSdkEmvGetAid(void *pTerminalApps, s32 index , u8

*outAidsTlv,s32 outAidsTlvLength);

189

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Get Aid tlv

pTerminalApps

aids pointer

index

aid index index must less than
MfSdkEmvGetAidNum()

outAidsTlvLength outAidsTlv size min value 1024

None

> =0

other

aid tlv length

aids pointer

ref. MfSdkRet_E

Params

in

out

return

remark

demo

11.52 MfSdkEmvGetAidsFree

Prototype

void MfSdkEmvGetAidsFree(void *pTerminalApps);

Function free aids param pointer

pTerminalApps

aids pointer

None

None

Params

in
out

return
remark

demo

11.53 MfSdkEmvSetTlv2Kernel

Prototype

s32 MfSdkEmvSetTlv2Kernel(u8* pBerTlvData , s32 length);

Function set Kernel emv tlv

Params

in

out

return
remark

pBerTlvData

tlv data

tlv data length

length

None

None

190

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

12 System module

12.1 Module description

This module mainly includes system APIs.

12.2 Module structure declaration

typedef struct
{

int nYear;
int nMonth;
int nDay;
int nHour;
int nMinute;
int nSecond;
}MfSdkSysTime_T;

typedef struct
{

int capacity;
int voltage_level;
int status;

}MfSdkBatterAttr_T;

ypedef struct{

u32 total_size;
u32 avail_size;

///< memory heap total size
///< available size. The actual allocatable size may be

less than this

u32 max_block_size; ///< maximum allocatable block size

}MfSdkSysHeap_T;

typedef TERMINALINFO MfSdkSysTermInfo_T;

12.3 Constant declarations

# define MFSDK_SYS_DEVICE_MF960
///<mf960
# define MFSDK_SYS_DEVICE_H9N

191

CPU_EC8521

CPU_EC25

///<h9n

Fujian MoreFun Electronic Technology Co.,Ltd.

# define MFSDK_SYS_DEVICE_H9L
# define MFSDK_SYS_DEVICE_H9PRO
///<h9pro
# define MFSDK_SYS_DEVICE_960B
///<960b

CPU_V133

///<h9l

CPU_X2600_H9Pro

CPU_X2600_MF960

typedef enum
{

MFSDK_SYS_RET_FAILED = -3, //failed
MFSDK_SYS_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_SYS_RET_PARM_ERROR = -1, //check param
MFSDK_SYS_RET_OK = 0,

}MfSdkSysRet_E;

typedef enum
{

MFSDK_SYS_LCD_TYPE_GET_FILE = -1,
MFSDK_SYS_LCD_TYPE_480_800 = 0,
MFSDK_SYS_LCD_TYPE_320_240,
MFSDK_SYS_LCD_TYPE_240_240 = 11,
MFSDK_SYS_LCD_TYPE_320_480,
MFSDK_SYS_LCD_TYPE_128_32,

///<get file

///<mf960
///<h9u/h9l/h9n

}MfSdkSysLcdType_E;

typedef enum
{

MFSDK_SYS_POWER_SHUTDOWN,
MFSDK_SYS_POWER_LOW,
MFSDK_SYS_POWER_CHARGE,
MFSDK_SYS_POWER_OUT,
MFSDK_SYS_NET_CONFIG_MODE,
MFSDK_SYS_NET_GPRS_MODE,
MFSDK_SYS_NET_WIFI_MODE,
MFSDK_SYS_WIFI_AIRKISS_CONFIG,
MFSDK_SYS_WIFI_AP_CONFIG,
MFSDK_SYS_WIFI_CONFIG_SUCCESS,
MFSDK_SYS_WIFI_CONFIG_FAIL,
MFSDK_SYS_TMS_UPDATE_START,//Tms Update Start
MFSDK_SYS_TMS_UPDATE_UNZIP,//Tms Update Unzip
MFSDK_SYS_TMS_UPDATE_SUCC,//Tms Update Succ
MFSDK_SYS_TMS_UPDATE_FAIL,//Tms Update Fail
MFSDK_SYS_TMS_SIGN_SUCC,//Tms Sign Succ

192

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_SYS_TMS_SIGN_FAIL,//Tms Sign Fail
MFSDK_SYS_TMS_DOWN_FINISH_SUCC,//Tms Down Finish Succ
MFSDK_SYS_TMS_DOWN_FINISH_FAIL,//Tms Down Finish Fail
MFSDK_SYS_TMS_DOWN_FINISH_PAUSE,//Tms Down Finish

Pause

MFSDK_SYS_TMS_DOWN_FINISH_CONTINUE,//Tms Finish

Continue

MFSDK_SYS_TMS_DOWN_FINISH_STOP,//Tms FinishStop
MFSDK_SYS_LOW_BATTERY_SHUTDOWN,//Low Battery Shutdown
MFSDK_SYS_RTC_TIME_SET,//RTC SET TIME
MFSDK_SYS_POWER_FULL,//Battery full

}MfSdkSysState_E;

typedef enum
{

MFSDK_SYS_DEV_MODEL_UNKNOWN = -1,
MFSDK_SYS_DEV_MODEL_M60A = 0,
MFSDK_SYS_DEV_MODEL_M60B,
MFSDK_SYS_DEV_MODEL_M90L,
MFSDK_SYS_DEV_MODEL_M60C,
MFSDK_SYS_DEV_MODEL_MP60,
MFSDK_SYS_DEV_MODEL_70N,
MFSDK_SYS_DEV_MODEL_70N2,
MFSDK_SYS_DEV_MODEL_M90,
MFSDK_SYS_DEV_MODEL_H9,
MFSDK_SYS_DEV_MODEL_H9A,
MFSDK_SYS_DEV_MODEL_H9L,
MFSDK_SYS_DEV_MODEL_H9N,
MFSDK_SYS_DEV_MODEL_H9U,
MFSDK_SYS_DEV_MODEL_H9PRO,
MFSDK_SYS_DEV_MODEL_ET389,
MFSDK_SYS_DEV_MODEL_ET389PRO,
MFSDK_SYS_DEV_MODEL_MF919,
MFSDK_SYS_DEV_MODEL_MF960,
MFSDK_SYS_DEV_MODEL_MF960B,
MFSDK_SYS_DEV_MODEL_70N3,
MFSDK_SYS_DEV_MODEL_SR600MINI,
MFSDK_SYS_DEV_MODEL_MP70A30,
MFSDK_SYS_DEV_MODEL_MP70N5,
MFSDK_SYS_DEV_MODEL_MP70A20,
MFSDK_SYS_DEV_MODEL_MP70MIS,
MFSDK_SYS_DEV_MODEL_MP70A5,

193

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_SYS_DEV_MODEL_H9PROA30,
MFSDK_SYS_DEV_MODEL_MP70A6,
MFSDK_SYS_DEV_MODEL_Z990,

}MfSdkSysDevType_E;

typedef enum
{

MFSDK_SYS_CONSOLE_AP = 1, // Display all port
MFSDK_SYS_CONSOLE_CDC = 2, // Only display NMEA port
MFSDK_SYS_CONSOLE_CDC_ACM = 3, // acm ap cp port

}MfSdkSysConsole_E;
typedef TERMINALINFO MfSdkSysTermInfo_T;

typedef void* MfSdkSysThreadMutex;

typedef int (*MfSdkSysPlayCallback)( int type, void *data);
typedef void (*MfSdkSysAppStartCallback)(void);

12.4 MfSdkSysGetDevModel

Prototype LIB_EXPORT s32 MfSdkSysGetDevModel(void)

Function Obtain the terminal model.

Params

in
out

None

None

Dev Model

Ref. MfSdkSysDevType_E

return
remark

demo

12.5 MfSdkSysGetDevModelName

Prototype LIB_EXPORT char* MfSdkSysGetDevModelName(void)

Function Obtain the terminal name.

Params

in
out

None

None

194

Fujian MoreFun Electronic Technology Co.,Ltd.

return
remark

device model name

ET389Pro:

char *modelName = MfSdkSysGetDevModelName();

demo

APP_TRACE("modelName:%s\r\n",modelName);

Result:

modelName:ET389Pro

12.6 MfSdkSysDevIs

Prototype LIB_EXPORT MFSDKBOOL MfSdkSysDevIs(s32 model)

Function Check whether the terminal is a model.

Params

in
out

model

None

Ref. MfSdkSysDevType_E

return

remark

demo

MFSDK_TRUE

yes

MFSDK_FALSE no

APP_TRACE("MFSDK_SYS_DEV_MODEL_ET389 :%s\r\n",MfSdkSysDevIs(MFSDK_SYS_DEV

_MODEL_ET389));

12.7 MfSdkSysGetHardwareVer

Prototype LIB_EXPORT s32 MfSdkSysGetHardwareVer(void)

Function Get hardware version.

Params

in
out

None

None

hardware version 300/400/500

return
remark

demo

195

Fujian MoreFun Electronic Technology Co.,Ltd.

12.8 MfSdkSysGetTime

Prototype LIB_EXPORT s32 MfSdkSysGetTime(MfSdkSysTime_T *pTime)

Function Get terminal date and time.

Params

in
out

*pTime

None

MfSdkSysTime_T point.

return

remark

demo

MFSDK_SYS_RE

T_OK

Success

MFSDK_SYS_RE
T_PARM_ERROR

fail

MfSdkSysTime_T stDateTime;

memset(&stDateTime,0,sizeof(MfSdkSysTime_T));

if(MfSdkSysGetTime(&stDateTime) == MFSDK_SYS_RET_OK)

{

}

//TODO

12.9 MfSdkSysAppIsLock

Prototype LIB_EXPORT s32 MfSdkSysAppIsLock()

Function

Determine whether the app is locked. For example, when TMS is
running, the application is locked.

Params

in
out

return

remark

demo

None

None

1

0

lock

unlock

if(MfSdkSysAppIsLock() == 1)

{

}

//TODO

196

Fujian MoreFun Electronic Technology Co.,Ltd.

12.10 MfSdkSysAuxlcdGetBrightness

Prototype LIB_EXPORT s32 MfSdkSysAuxlcdGetBrightness()

Function LCD get brightness

Params

in
out

return
remark

demo

None

None

light

The range is between 10 and 255

12.11 MfSdkSysAuxlcdSetBrightness

Prototype LIB_EXPORT void MfSdkSysAuxlcdSetBrightness(s32 light)

Function LCD set brightness

light

None

Nothing

Params

in
out

return
remark

demo

The range is between 10 and 255

12.12 MfSdkSysSubAuxlcdGetBrightness

Prototype s32 MfSdkSysSubAuxlcdGetBrightness();

Function Sub LCD get brightness

Params

in
out

return
remark

None

None

>=10

The range is between 10 and 255

197

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

12.13 MfSdkSysSubAuxlcdSetBrightness

Prototype void MfSdkSysAuxlcdSetBrightness(s32 light);

Function Sub LCD set brightness

light The range is between 10 and 255

light

None

Nothing

Params

in
out

return
remark

demo

12.14 MfSdkSysBatterCharge

Prototype LIB_EXPORT s32 MfSdkSysBatterCharge(void)

Function Charging state

Params

in
out

None

None

MFSDK_SYS_RET_
OK

charging

Other

not charging

return

remark

demo

12.15 MfSdkSysGetBatterStatus

Prototype

LIB_EXPORT s32 MfSdkSysGetBatterStatus(MfSdkBatterAttr_T*
batterystatus)

Function Battery state

Params

in

None

198

Fujian MoreFun Electronic Technology Co.,Ltd.

out

batterystatus

battery status

1

0

-1

charging

not charging

fail

return

remark

demo

12.16 MfSdkSysBuzzerSound

Prototype LIB_EXPORT void MfSdkSysBuzzerSound(s32 nMillisecond)

Function Buzzer

nMillisecond

time

None

Nothing

Params

in
out

return
remark

demo

12.17 MfSdkSysCheckKey

Prototype LIB_EXPORT s32 MfSdkSysCheckKey(void)

Function Scan button, non blocking

Params

in
out

None

None

KEY_VALUE

key pressed

0

-1

No key

Fail

return

remark

demo

199

Fujian MoreFun Electronic Technology Co.,Ltd.

12.18 MfSdkSysCheckTick

Prototype LIB_EXPORT s32 MfSdkSysCheckTick(s32 tick, s32 timeover)

Function Check for timeout

tick

Starting time

timeover

Timeout period

None

1

0

timeout

within the effective time

Params

in

out

return

remark

demo

12.19 MfSdkSysClrKey

Prototype LIB_EXPORT void MfSdkSysClrKey(void)

Function Not implemented

Params

in
out

return
remark

demo

None

None

Nothing

12.20 MfSdkSysConfig

Prototype LIB_EXPORT void MfSdkSysConfig(void)

Function

The manufacturer sets the individual parameter settings and invokes
the individual settings function of each manufacturer.

Params

in
out

None

None

200

Fujian MoreFun Electronic Technology Co.,Ltd.

Nothing

return
remark

demo

12.21 MfSdkSysCurlInit

Prototype

LIB_EXPORT s32 MfSdkSysCurlInit(s32 Argc, s8** Argv, s8*
AppName)

Function Initialization of system and initialization of application layer

Argc

Argv

Reusing main function parameter Argc

Reusing main function parameter Argv

AppName

Application name

None

1

2

For the first
updated

time since the program was

Program is not run for the first time

Other

Fail

Not to be processed without access. Inside the function calls the
private API of the manufacturer.The API returns to the first
operation only when the program is newly installed,and the
update is not the first operation.

Params

in

out

return

remark

demo

12.22 MfSdkSysDelay

Prototype LIB_EXPORT void MfSdkSysDelay(u32 uiMs)

Function Delay blocking

Delay time unit MS

uiMs

None

Nothing

Params

in
out

return
remark

demo

201

Fujian MoreFun Electronic Technology Co.,Ltd.

12.23 MfSdkSysEnergySetTime

Prototype LIB_EXPORT s32 MfSdkSysEnergySetTime(s32 nTime)

Function Energy-saving time

unit second

nTime

None

Nothing

Params

in
out

return
remark

demo

12.24 MfSdkSysEnergyTime

Prototype LIB_EXPORT s32 MfSdkSysEnergyTime()

Function Get Energy-saving time

Params

in
out

None

None

Energy-saving time unit:second

return
remark

demo

12.25 MfSdkSysEraseSecureArea

Prototype LIB_EXPORT s32 MfSdkSysEraseSecureArea(u32 addr)

Function Erase safe area data, 4K at a time.

Params

in
out

return

addr

None

0 / 4*1024

MFSDK_SYS_RE

T_OK

Success

202

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

Fail

remark

demo

int iRet = Sys_EraseSecureArea(0);

iRet = Sys_EraseSecureArea(4*1024);

12.26 MfSdkSysFileSetPath

Prototype LIB_EXPORT void MfSdkSysFileSetPath(s32 mode)

Function Set the storage mode

Params

in

out

return
remark

demo

mode

None

Nothing

Storage location,
Reference enum FILELOCATION

12.27 MfSdkSysGetBatterLevel

Prototype LIB_EXPORT s32 MfSdkSysGetBatterLevel(void)

Function Get power supply

Params

in
out

return

remark

demo

None

None

0-5

-1

Battery level

Fail

12.28 MfSdkSysGetDateTime

Prototype LIB_EXPORT s32 MfSdkSysGetDateTime(u8* DateTime)

203

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Get SysTime

Params

in
out

None

DateTime

"YYYYMMDDHHMMSS" 14 bytes

MFSDK_SYS_RET_
OK

Success

Other

Fail

return

remark

demo

12.29 MfSdkSysGetIsLcd

Prototype LIB_EXPORT s32 MfSdkSysGetIsLcd(void)

Function Check whether 389 has a front display

Params

in
out

return

remark

demo

None

None

1

-1

have front display

have no front display

12.30 MfSdkSysGetLcdType

Prototype LIB_EXPORT s32 MfSdkSysGetLcdType()

Function Get the screen LCD type

Params

in
out

None

None

LCD type

Ref. MfSdkSysLcdType_E

return
remark

demo

204

Fujian MoreFun Electronic Technology Co.,Ltd.

12.31 MfSdkSysGetPsn

Prototype LIB_EXPORT void MfSdkSysGetPsn(s8* psn)

Function

Params

in
out

return
remark

demo

None

psn

Nothing

12.32 MfSdkSysGetTerminalInfo

Prototype

LIB_EXPORT s32
MfSdkSysGetTerminalInfo(MfSdkSysTermInfo_T* terminal)

Function Get terminal information

Params

in
out

None

terminal

Reference TERMINALINFO

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.33 MfSdkSysGetTermSn

Prototype LIB_EXPORT s32 MfSdkSysGetTermSn(s8* Sn)

Function Get terminal SN

Params

in
out

None

sn

Reference TERMINALINFO

205

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_SYS_RET_
OK

success

Other

fail

no safe please use API MfSdkSysGetTerminalSn

return

remark

demo

12.34 MfSdkSysGetTerminalSn

Prototype

LIB_EXPORT const s8* MfSdkSysGetTerminalSn(s8*pData,s32
length)

Function Get terminal SN

Params

in
out

return
remark

demo

length

pData

None

Reference TERMINALINFO

12.35 MfSdkSysGetTick

Prototype LIB_EXPORT u32 MfSdkSysGetTick()

Function Get the current time

Params

in
out

return
remark

demo

None

None

tick

Get time tick unit ms

12.36 MfSdkSysGetTickDiff

Prototype LIB_EXPORT s32 MfSdkSysGetTickDiff(s32 tick1)

206

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Calculate time difference

Params

in
out

return
remark

demo

tick1

None

tick

start tick

Time difference

12.37 MfSdkSysGetTimeStamp

Prototype LIB_EXPORT time_t MfSdkSysGetTimeStamp()

Function get time stamp

Params

in
out

tick1

None

start tick

time_t lt

time stamp

return
remark

demo

12.38 MfSdkSysGuiGroupGetObj

Prototype LIB_EXPORT void* MfSdkSysGuiGroupGetObj()

Function

Params

in
out

return
remark

demo

None

None

lvgl object

207

Fujian MoreFun Electronic Technology Co.,Ltd.

12.39 MfSdkSysHttpDownload

Prototype

LIB_EXPORT s32 MfSdkSysHttpDownload(s32 sock_index, const
s8* url, const s8* fullpathfilename)

Function http download file

Params

in

sock_index

socket used by the device Ref.
MfSdkCommSocketIndex_E

url

Download link

fullpathfilename Save path

out

None

MFSDK_SYS_RET_
OK

success

other

fail

return

remark

demo

12.40 MfSdkSysHttpDownloadUseAgent

Prototype

LIB_EXPORT void MfSdkSysHttpDownloadUseAgent(s32
useAgent)

Function Http download message configuration

UseAgent Whether to use User-Agent for http
download(0 - 1)

useAgent

None

Nothing

Params

in

out

return
remark

demo

12.41 MfSdkSysInit

Prototype

LIB_EXPORT s32 MfSdkSysInit(s32 Argc, s8** Argv, s8*
AppName)

208

Fujian MoreFun Electronic Technology Co.,Ltd.

Initialization of system and initialization of application layer Nothing.

(For Traditional POS)

Argc

Argv

Reusing main function parameter Argc

Reusing main function parameter Argv

AppName

Application name

None

<0

1

2

fail

for the first
updated.

time since the program was

Program is not run for the first time.

Not to be processed without access.Inside the function calls the private
API of the manufacturer.The API returns to the first operation only
when the program is newly installed,and the update is not the first
operation.

Function

Params

in

out

return

remark

demo

12.42 MfSdkSysLcdCalibration

Prototype LIB_EXPORT void MfSdkSysLcdCalibration()

Function Screen Calibration

None

None

Nothing

Params

in
out

return
remark

demo

12.43 MfSdkSysLogoInit

Prototype LIB_EXPORT s32 MfSdkSysLogoInit(s8* logoPath)

Function logo init

Params

in
out

logoPath

Path of the logo.bin file

None

209

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.44 MfSdkSysLogoInitA

Prototype s32 MfSdkSysLogoInitA(s8* logoPath,MFSDKBOOL bDelete);

Function logo init

logoPath

logo file Path

Whether to delete logo file MFSDK_TRUE-yes,
MFSDK_FALSE-no

bDelete

None

MFSDK_SYS_RET_
OK

success

Other

fail

Params

in

in

out

return

remark

demo

12.45 MfSdkSysModelType

Prototype LIB_EXPORT s32 MfSdkSysModelType()

Function

Params

in
out

return

remark

demo

None

None

0

1

wireless

MODEM

210

Fujian MoreFun Electronic Technology Co.,Ltd.

12.46 MfSdkSysNetSetDatacallType

Prototype LIB_EXPORT void MfSdkSysNetSetDatacallType()

Function Set other network injection processes

Params

in
out

return
remark

demo

None

None

Nothing

Called before Sys_Start.Resolved the jiociot sim card network injection
failure

12.47 MfSdkSysPrintAdd

Prototype LIB_EXPORT void MfSdkSysPrintAdd(const s8* pbuff)

Function print buff add

print buff

pbuff

None

Nothing

Params

in
out

return
remark

demo

12.48 MfSdkSysReadFlashData

Prototype LIB_EXPORT void MfSdkSysReadFlashData(s8* pdata, s32 size)

Function Read flash data

Params

in
out

return

size

pdata

Nothing

data size

read Data content

211

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

12.49 MfSdkSysReadSecureArea

Prototype

LIB_EXPORT s32 MfSdkSysReadSecureArea(u32 addr, u8* pData,
s32 iDataLength)

Function Read secure area data.

Params

in

out

return

remark

addr

Read data start offset 0-8191

iDataLength

pData

>=0

< 0

read data length

fail

s32 iRet = 0;

demo

u8 mBuffer[1024] = {0};

iRet = Sys_ReadSecureArea(0, mBuffer, sizeof(mBuffer));

12.50 MfSdkSysReboot

Prototype LIB_EXPORT s32 MfSdkSysReboot(void)

Function Terminal reboot

Params

in
out

None

None

MFSDK_SYS_RET_
OK

success

-1

fail

return

remark

demo

212

Fujian MoreFun Electronic Technology Co.,Ltd.

12.51 MfSdkSysRfidEmulateConfig

Prototype

LIB_EXPORT s32 MfSdkSysRfidEmulateConfig(u8* cardinfo, s32
infolen, u8(*cardblock)[4], u32 block_cap)

Function ntag analog card config

Params

in

cardinfo

infolen

cardblock

Pointer to memory card information

The length of card information

A two-dimensional array pointer for storing card
block data

block_cap

The number of blocks that the card can support

out

None

MFSDK_SYS_RET_
OK

success

other

fail

return

remark

demo

12.52 MfSdkSysRfidEmulateDeinit

Prototype LIB_EXPORT s32 MfSdkSysRfidEmulateDeinit(void)

Function ntag deinitialization of analog cards

Params

in
out

None

None

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

213

Fujian MoreFun Electronic Technology Co.,Ltd.

12.53 MfSdkSysRfidEmulateInit

Prototype LIB_EXPORT s32 MfSdkSysRfidEmulateInit(void)

Function ntag analog card initialization

Params

in
out

None

None

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.54 MfSdkSysRfidEmulateProcess

Prototype LIB_EXPORT void MfSdkSysRfidEmulateProcess(void)

Function ntag analog card execution processing

None

None

Nothing

Params

in
out

return
remark

demo

12.55 MfSdkSysRun

Prototype LIB_EXPORT s32 MfSdkSysRun()

Function system running

Params

in
out

None

None

214

Fujian MoreFun Electronic Technology Co.,Ltd.

Nothing

return
remark

demo

12.56 MfSdkSysSetDateTime

Prototype LIB_EXPORT s32 MfSdkSysSetDateTime(u8* DateTime)

Function Set SysTime

Params

in
out

return

remark

demo

DateTime

"YYYYMMDDHHMMSS" 14 bytes

None

-2

-1

0

Parameter Error

Fail

Success

Internal judgment of time format in API

12.57 MfSdkSysSetLanguage

Prototype LIB_EXPORT void MfSdkSysSetLanguage(s32 nLanguageType)

Function Set device language, must set the right font priority

Params

in

nLanguageType

0 - Chinese,
1 - English,
2 - Persian

None

Nothing

out

return
remark

demo

215

Fujian MoreFun Electronic Technology Co.,Ltd.

12.58 MfSdkSysSetLogData

Prototype LIB_EXPORT void MfSdkSysSetLogData(s8* buff, s32 len)

Function Log set

buff

len

None

Nothing

Params

in

out

return
remark

demo

12.59 MfSdkSysSetScrBackLight

Prototype LIB_EXPORT s32 MfSdkSysSetScrBackLight(byte mode)

Function Set screen backlight mode

Params

in

out

mode

None

Backlight mode:
0 - turn off backlight,
1 - system automatically controls,
2 - backlight is always bright.

MFSDK_SYS_RET_
OK

success

Other

fail

Mode=1 indicates that the backlight is automatically controlled by the
system, with a default of 1.

return

remark

demo

12.60 MfSdkSysSleep

Prototype LIB_EXPORT s32 MfSdkSysSleep(u32 Time)

216

Fujian MoreFun Electronic Technology Co.,Ltd.

Function This API is a delay feature.

Params

in
out

Time

None

Entering dormancy time, unit milliseconds

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.61 MfSdkSysStart

Prototype

LIB_EXPORT void MfSdkSysStart(const s8* app_ver,
MfSdkSysAppStartCallback apprun)

Function Check for timeout

Application version

Application task

app_ver

apprun

None

Nothing

Params

in

out

return
remark

demo

12.62 MfSdkSysTaskAppSet

Prototype LIB_EXPORT void MfSdkSysTaskAppSet(void* pfunc)

Function Open Task

pfunc

None

Nothing

Params

in
out

return
remark

demo

Processing function of task

217

Fujian MoreFun Electronic Technology Co.,Ltd.

12.63 MfSdkSysTaskCreate

Prototype

LIB_EXPORT s32 MfSdkSysTaskCreate(void (*pfun)(void* param),
s32 prio, void* param, s32 task_size)

Function Create system task

Params

in

pfun

prio

param

Processing function of task

Task priority

Task param

task_size

Stack size

out

None

MFSDK_SYS_RET_
OK

success

other

fail

return

remark

demo

12.64 MfSdkSysTimerCheck

Prototype LIB_EXPORT s32 MfSdkSysTimerCheck(s32 iHandle)

Function Check whether the timing time is up to

iHandle

None

>=0

Timer

success,Remaining time, unit milliseconds (0
indicates timed time)

Other

fail

Params

in
out

return

remark

demo

12.65 MfSdkSysTimerClose

Prototype LIB_EXPORT s32 MfSdkSysTimerClose(s32 iHandle)

218

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Off Timer

Params

in
out

iHandle

None

Timer

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.66 MfSdkSysTimerCreate

Prototype

LIB_EXPORT u32 MfSdkSysTimerCreate(void* pfunc, void*
pParam, u32 nPeriod, u32 nMode, u32* pnErrorCode)

Function Create a timer

pfunc

pParam

nPeriod

nMode

callback func

params

period

mode

pnErrorCode

error code

None

>0

0

success, timer handle

fail

Params

in

out

return

remark

demo

12.67 MfSdkSysTimerEnable

Prototype LIB_EXPORT u32 MfSdkSysTimerEnable(u32 nTimerNo)

Function Enable timer

Params

in
out

nTimerNo

timer handle

None

return

MFSDK_SYS_RET_ success

219

Fujian MoreFun Electronic Technology Co.,Ltd.

OK

Other

fail

remark

demo

12.68 MfSdkSysTimerDelete

Prototype u32 MfSdkSysTimerDelete(u32 nTimerNo)

Function Delete timer

Params

in
out

nTimerNo

timer handle

None

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.69 MfSdkSysTimerOpen

Prototype LIB_EXPORT u32 MfSdkSysTimerOpen(u32 TimerMs)

Function Open timer and set timer time

Params

in
out

return

remark

demo

TimerMs

Timer time

None

>=0

Other

success,return timer handle

fail

220

Fujian MoreFun Electronic Technology Co.,Ltd.

12.70 MfSdkSysTtsSystemSetFunc

Prototype

LIB_EXPORT void
MfSdkSysTtsSystemSetFunc(MfSdkSysPlayCallback playproc)

Function system tts callback eg. batter low, wifi mode etc.

playproc

None

Nothing

Params

in
out

return
remark

demo

12.71 MfSdkSysUnzipFileFunc

Prototype

LIB_EXPORT s32 MfSdkSysUnzipFileFunc(s8* szFileName, s8*
folder, MFSDKBOOL del)

Function Unzip packet

szFileName

Path of the compressed package

folder

Unzip to the specified folder

Params

in

del

out

None

MFSDK_TRUE:Delete the zip package after the
decompression is complete;
MFSDK_FALSE:The zip package is not deleted
after the decompression is successful

return

remark

demo

MFSDK_SYS_RET_
OK

success

other

fail

MfSdkSysUnzipFileFunc("exdata\\images.zip","exdata",MFSDK_TRUE);

12.72 MfSdkSysVersion

Prototype LIB_EXPORT s32 MfSdkSysVersion()

221

Fujian MoreFun Electronic Technology Co.,Ltd.

Function get system version and trace out to log tool

Params

in
out

None

None

system version

return
remark

demo

12.73 MfSdkSysWriteFlashData

Prototype LIB_EXPORT void MfSdkSysWriteFlashData(s8* pdata, s32 size)

Function

Params

in

out

return
remark

demo

write data stream

write data stream length

pdata

size

None

Nothing

12.74 MfSdkSysWriteSecureArea

Prototype

LIB_EXPORT s32 MfSdkSysWriteSecureArea(u32 addr, u8* pData,
s32 iDataLength)

Function

Params

in

out

return

remark

addr

pData

0--8191

write data stream

iDataLength

write data stream length

None

MFSDK_SYS_RET_
OK

success

Other

fail

222

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

iRet = Sys_WriteSecureArea(0, (u8*)"12345678", 8);

12.75 MfSdkSysZipUpdate

Prototype LIB_EXPORT void MfSdkSysZipUpdate()

Function TMS update(Unpack zip file and upgrade, then reboot)

None

None

Nothing

Params

in
out

return
remark

demo

12.76 MfSdkSysDriverLibInit

Prototype LIB_EXPORT void MfSdkSysDriverLibInit()

Function Initialization driver

None

None

Nothing

Params

in
out

return
remark

demo

12.77 MfSdkSysTaskAppInit

Prototype LIB_EXPORT s32 MfSdkSysTaskAppInit(void)

Function if SoundBox support NFC should init

Params

in
out

None

None

return

MFSDK_SYS_RET_ success

223

Fujian MoreFun Electronic Technology Co.,Ltd.

OK

Other

fail

remark

demo

12.78 MfSdkSysPubDriverInit

Prototype LIB_EXPORT s32 MfSdkSysPubDriverInit(void)

Function Init Driver

Params

in
out

None

None

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

12.79 MfSdkSysFontInit

Prototype LIB_EXPORT s32 MfSdkSysFontInit(void)

Function Init font library

Params

in
out

None

None

MFSDK_SYS_RET_
OK

success

Other

fail

return

remark

demo

224

Fujian MoreFun Electronic Technology Co.,Ltd.

12.80 MfSdkSysConsoleSwitch

Prototype void MfSdkSysConsoleSwitch(MfSdkSysConsole_E switchE);

Function set device port

switchE

refer to MfSdkSysConsole_E

None

None

Params

in
out

return
remark

demo

12.81 MfSdkSysThreadMutexInit

Prototype s32 MfSdkSysThreadMutexInit(MfSdkSysThreadMutex *mutex);

Function init mutex

Params

in
out

None

mutex

return
remark

demo

MfSdkSysThreadMutex handle

ref. MfSdkSysRet_E

12.82 MfSdkSysThreadMutexLock

Prototype

s32 MfSdkSysThreadMutexLock(MfSdkSysThreadMutex
*mutex ,void* param);

Function mutex lock

Params

in

out

return

mutex

param

None

MfSdkSysThreadMutex handle

NULL

ref. MfSdkSysRet_E

225

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

12.83 MfSdkSysThreadMutexUnlock

Prototype

s32 MfSdkSysThreadMutexUnlock(MfSdkSysThreadMutex
*mutex);

Function mutex unlock

Params

in
out

mutex

None

return
remark

demo

MfSdkSysThreadMutex handle

ref. MfSdkSysRet_E

12.84 MfSdkSysThreadMutexDestroy

Prototype

s32 MfSdkSysThreadMutexDestroy(MfSdkSysThreadMutex
*mutex);

Function Destroy mutex

Params

in
out

mutex

None

return
remark

demo

MfSdkSysThreadMutex handle

ref. MfSdkSysRet_E

12.85 MfSdkSysGetSegmentLcdDisplayMaxLength

Prototype s32 MfSdkSysGetSegmentLcdDisplayMaxLength(void);

Function Get segment lcd max length of display 6/7/9

Params

in

mutex

MfSdkSysThreadMutex handle

226

Fujian MoreFun Electronic Technology Co.,Ltd.

None

>0

other

Get segment lcd max length of display 6/7/9

failed

out

return

remark

demo

12.86 MfSdkSysIsExternalFlash

Prototype s32 MfSdkSysGetSegmentLcdDisplayMaxLength(void);

Function Check whether there is an external flash.

Params

in
out

None

None

MFSDK_FALSE not external Flash

MFSDK_TRUE

external flash

return

remark

demo

12.87 MfSdkSysSetForceSleepTime

Prototype s32 MfSdkSysSetForceSleepTime(s32 timeS);

Function

Set the time for the device to enter the forced sleep mode after the
screen is broken

Params

in
out

timeS

None

return
remark

demo

time. unit seconds

ref. MfSdkSysRet_E

12.88 MfSdkSysSetSleepToPoweroff

Prototype s32 MfSdkSysSetSleepToPoweroff(s32 timeS);

227

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Set the shutdown time after the device enters sleep mode

Params

in
out

timeS

None

return
remark

demo

time. unit seconds

ref. MfSdkSysRet_E

12.89 MfSdkSysGetHeapInformation

Prototype

void MfSdkSysGetHeapInformation(MfSdkSysHeap_T
*pHeapInfor);

Function get heap info

Params

in
out

None

pHeapInfor

heap info

None

return
remark

demo

12.90 MfSdkSysSetRestartEnabledOnce

Prototype s32 MfSdkSysSetRestartEnabledOnce();

Function not restart the app after it crashes, use crash=reenter

Params

in
out

None

None

return
remark

demo

ref. MfSdkSysRet_E

228

Fujian MoreFun Electronic Technology Co.,Ltd.

13 File System module

13.1 Module description

This module mainly includes File system APIs.

13.2 Module structure declaration

typedef struct
{

s32 d_ino;

///< inode number, file system

implementation can use it for any purpose

u8 d_type;
char d_name[256];

}MfSdkDirent_T;

///< 8-file,other- dir type of file

///< file name

13.3 Constant declarations

typedef enum
{

MFSDK_FS_RET_CREATE_FAIL = -20,//create error
MFSDK_FS_RET_OPEN_FAIL = -19, //open error
MFSDK_FS_RET_READ_FAIL = -18, //read error,
MFSDK_FS_RET_WRITE_FAIL = -17, //write error,
MFSDK_FS_RET_SEEK_FAIL = -18, //seek error,
MFSDK_FS_RET_DELETE_FAIL = -16, //delete error,
MFSDK_FS_RET_REMOVE_FAIL = -15, //remove error,
MFSDK_FS_RET_NO_RECORD = -10, ///< Record not found
MFSDK_FS_RET_CLOSE_FAIL
MFSDK_FS_RET_NOEXIST = -4,
MFSDK_FS_RET_FAILED = -3,
MFSDK_FS_RET_BOUNDS = -2,
MFSDK_FS_RET_PARM_ERROR = -1,
MFSDK_FS_RET_OK = 0,

//failed
//Array out-of-bounds
//check param

//no found file

= -8,///< Close file error

}MfSdkFsRet_E;

# define MFSDK_FS_SEEK_SET (FILE_SEEK_SET) ///< To the file

header

# define MFSDK_FS_SEEK_CUR (FILE_SEEK_CUR) ///< To the

current location

# define MFSDK_FS_SEEK_END (FILE_SEEK_END) ///< To the end

of the file

# define MFSDK_FS_RDONLY

(FILE_RDONLY) ///< Read-only,

there is no return error

229

Fujian MoreFun Electronic Technology Co.,Ltd.

# define MFSDK_FS_WRONLY

(FILE_WRONLY) ///< Write only,

there is no return error

# define MFSDK_FS_RDWR (FILE_RDWR) ///< Read and write,

there is no return error

# define MFSDK_FS_APPEND

(FILE_APPEND) ///< Append,

create if it does not exist, pointer to the end of the file
when it exists

# define MFSDK_FS_CREAT (FILE_CREAT)

///< Create,

delete rebuild when it already exists

typedef enum
{

MFSDK_FS_FLAG_WRITE, // read and write
MFSDK_FS_FLAG_CREAT, // if file does not exist create

it ,if file exist will be truncated to length 0.

MFSDK_FS_FLAG_READ,// only read

}MfSdkFsFlag_E;
typedef enum
{

MFSDK_FS_MODE_READ, // only read
MFSDK_FS_MODE_WRITE, // read and write

}MfSdkFsMode_E;

13.4 MfSdkFsSetPath

Prototype LIB_EXPORT s32 MfSdkFsSetPath(const s8 *pPath)

Function set file path

Params

in
out

pPath

None

file path

MFSDK_FS_RET_O
K

success

return

remark

demo

demo

230

Fujian MoreFun Electronic Technology Co.,Ltd.

13.5 MfSdkFsCheckPath

Prototype LIB_EXPORT s32 MfSdkFsCheckPath(const s8 *FileName)

Function check if file exist

Params

in
out

FileName

file name

None

MFSDK_FS_RET_OK The file exist

MFSDK_FS_RET_NO
EXIST

The file does not exist

return

remark

demo

13.6 MfSdkFsClean

Prototype LIB_EXPORT s32 MfSdkFsClean()

Function delete all files

Params

in
out

None

None

MFSDK_FS_RET_O
K

success

return

remark

demo

13.7 MfSdkFsClose

Prototype LIB_EXPORT s32 MfSdkFsClose(FILE_HANDLE handle)

Function check if file exist

Params

in

handle

file handler

231

Fujian MoreFun Electronic Technology Co.,Ltd.

out

None

MFSDK_FS_RET_O
K

success

Other

fail,Ref.MfSdkFsRet_E

return

remark

demo

13.8 MfSdkFsDelete

Prototype LIB_EXPORT s32 MfSdkFsDelete(FILE_HANDLE handle, u32 size)

Function File truncation

Params

in

out

handle

size

None

file handler

truncate size

MFSDK_FS_RET_OK Success

Other

Fail

return

remark

demo

13.9 MfSdkFsGetFreeSpace

Prototype LIB_EXPORT long MfSdkFsGetFreeSpace(const s8 *drive)

Function File system remaining space

Params

in
out

return

remark

demo

drive

None

>0

-1

default ""

success, the remaining space unit:KB

fail

MfSdkFsGetFreeSpace("");

232

Fujian MoreFun Electronic Technology Co.,Ltd.

13.10 MfSdkFsGetTotalSpace

Prototype LIB_EXPORT long MfSdkFsGetTotalSpace(const s8 *drive)

Function File system total space

Params

in
out

return

remark

demo

drive

None

>0

-1

default ""

success, the remaining space unit:KB

fail

MfSdkFsGetTotalSpace("");

13.11 MfSdkFsGetModuleVer

Prototype LIB_EXPORT s32 MfSdkFsGetModuleVer(char *pszVer)

Function Get File module version

Params

in
out

None

pszVer

MFSDK_FS_RET_O
K

success

Other

fail

return

remark

demo

13.12 MfSdkFsLseek

Prototype

LIB_EXPORT long MfSdkFsLseek(FILE_HANDLE handle, long
offset, s32 origin)

Function Locating file pointer

Params

in

handle

file handler

233

Fujian MoreFun Electronic Technology Co.,Ltd.

offset

origin

None

>=0

Other

start position

success, offset position

fail

out

return

remark

demo

13.13 MfSdkFsMkdir

Prototype LIB_EXPORT s32 MfSdkFsMkdir(s8* dirName)

Function Creating directories does not support recursive creation.

Params

in
out

dirName

None

return

remark

demo

MFSDK_FS_RET_O
K

success

Other

fail

if(MfSdkFsMkdir(edxata\\testdir) == MFSDK_FS_RET_OK)

{

}

//create a folder of testdir

13.14 MfSdkFsOpen

Prototype

LIB_EXPORT s32 MfSdkFsOpen(const s8* name, s32 flag, s32
mode)

Function file open

Params

in

out

return

name

flag

mode

None

>=0

File Name End with NULL

Open the file flag Ref.MfSdkFsFlag_E

Open the file mode and refer to the
MfSdkFsMode_E definition.

success, file handler

234

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail

remark

# include <stdio.h>

# include <string.h>

# include "libapi_xpos/inc/mfsdk_log.h"

# include "libapi_xpos/inc/mfsdk_fs.h"

# define FS_TRACE(...)

MfSdkLogLevel("app",

MFSDK_LOG_LEVEL_TRACE, __VA_ARGS__);

# define FS_TRACE_BUFF(a, b) MfSdkLogHexBuff("app",

MFSDK_LOG_LEVEL_TRACE, a, b);

void TestFsCreateWriteRead(void)

{

s32 ret = MFSDK_RET_FAILED;

ret = MfSdkFsCheckPath((const s8 *)TEST_FS_FILE);

FS_TRACE("MfSdkFsCheckPath:%d\r\n", ret);

if(ret == MFSDK_FS_RET_NOEXIST)

{

// create new file

ret = MfSdkFsOpen((const s8 *)TEST_FS_FILE,

MFSDK_FS_FLAG_CREAT, MFSDK_FS_MODE_WRITE);

FS_TRACE("MfSdkFsOpen:%d\r\n", ret);

if(ret >= 0)

MfSdkFsWrite(ret, "Hello World!", strlen("Hello World!"));

MfSdkFsClose(ret);

demo

{

}

}

else

{

ret = MfSdkFsOpen((const s8 *)TEST_FS_FILE,

MFSDK_FS_FLAG_WRITE, MFSDK_FS_MODE_WRITE);

if(ret >= 0)

{

char buffer[1024] = {0};

s32 length = 0;

length = MfSdkFsLseek(ret, 0, MFSDK_FS_SEEK_SET);

FS_TRACE("MfSdkFsLseek:%d\r\n", length);

length = MfSdkFsRead(ret, buffer, sizeof(buffer));

FS_TRACE("MfSdkFsRead:%d\r\n", length);

if(length) { FS_TRACE("MfSdkFsRead buffer:%s\r\n", buffer); }

length = MfSdkFsLseek(ret, 5, MFSDK_FS_SEEK_SET);

235

Fujian MoreFun Electronic Technology Co.,Ltd.

FS_TRACE("MfSdkFsLseek:%d\r\n", length);

memset(buffer, 0, sizeof(buffer));

length = MfSdkFsRead(ret, buffer, sizeof(buffer));

FS_TRACE("MfSdkFsRead:%d\r\n", length);

if(length) { FS_TRACE("MfSdkFsRead buffer:%s\r\n", buffer); }

length = MfSdkFsLseek(ret, 0, FILE_SEEK_CUR);

FS_TRACE("FILE_SEEK_CUR MfSdkFsLseek:%d\r\n", length);

memset(buffer, 0, sizeof(buffer));

length = MfSdkFsRead(ret, buffer, sizeof(buffer));

FS_TRACE("MfSdkFsRead:%d\r\n", length);

if(length) { FS_TRACE("MfSdkFsRead buffer:%s\r\n", buffer); }

length = MfSdkFsLseek(ret, 0, FILE_SEEK_END);

FS_TRACE("FILE_SEEK_END MfSdkFsLseek:%d\r\n", length);

memset(buffer, 0, sizeof(buffer));

length = MfSdkFsRead(ret, buffer, sizeof(buffer));

FS_TRACE("MfSdkFsRead:%d\r\n", length);

if(length) { FS_TRACE("MfSdkFsRead FILE_SEEK_CUR

buffer:%s\r\n", buffer); }

MfSdkFsClose(ret);

}

}

}

13.15 MfSdkFsPathClean

Prototype LIB_EXPORT s32 MfSdkFsPathClean(s8* path)

Function

Params

in
out

path

None

MFSDK_FS_RET_O
K

success

Other

fail

return

remark

demo

236

Fujian MoreFun Electronic Technology Co.,Ltd.

13.16 MfSdkFsRead

Prototype

LIB_EXPORT s32 MfSdkFsRead(FILE_HANDLE handle, char
*buffer, s32 size)

Function file read

handle

size

buffer

>0

Other

Params

in

out

return

remark

demo

file handler

read size

read buffer

success, the number of bytes actually read

fail

13.17 MfSdkFsReadLine

Prototype

LIB_EXPORT s32 MfSdkFsReadLine(FILE_HANDLE pFile, s8
*pLineBuff,u32 LineBuffSize)

Function Read a line of text and support.

Params

in

out

pFile

size

file handler

Line Buff Size

pLineBuff

Text data read

MFSDK_FS_RET_O
K

success

Other

fail

For text files, read one row of data from the current location and
jump to the next line.

return

remark

demo

13.18 MfSdkFsReadProfileInt

Prototype

LIB_EXPORT s32 MfSdkFsReadProfileInt(const s8* section, const
s8* key, s32 default_value, const s8* file)

237

Fujian MoreFun Electronic Technology Co.,Ltd.

Function Read int value in initialization file.

section

key

name of the section containing the key name

name of the key pairs to value

default_value

default value of result

file

None

path of the initialization file

profile int value,if read fail, return default value

Params

in

out

return
remark

demo

13.19 MfSdkFsReadProfileString

Prototype

LIB_EXPORT s32 MfSdkFsReadProfileString(const s8* section,
const s8* key, s8* value, s32 size, const s8* default_value, const
s8* file)

Function Read string in initialization file.

section

name of the section containing the key name

in

key

size

name of the key pairs to value

size of result's buffer

Params

default_value

default value of result

file

value

1

0

path of the initialization file

pointer to the buffer that receives the retrieved
string

read success

read fail

out

return

remark

demo

13.20 MfSdkFsUnlink

Prototype LIB_EXPORT s32 MfSdkFsUnlink(const s8 * filename)

Function Delete file

238

Fujian MoreFun Electronic Technology Co.,Ltd.

filename

delete file name

None

MFSDK_FS_RET_O
K

success

Other

fail,Ref. MfSdkFsRet_E

Params

in
out

return

remark

demo

13.21 MfSdkFsWrite

Prototype

LIB_EXPORT s32 MfSdkFsWrite(FILE_HANDLE handle, char
*buffer, s32 size)

Function File writing

handle

buffer

size

None

>0

File handle to be written

Data to be written

data sizeto be written

Success.The number of bytes
written.

actually

Other

fail,Ref. MfSdkFsRet_E

Params

in

out

return

remark

demo

13.22 MfSdkFsWriteSync

Prototype

s32 MfSdkFsWriteSync(FILE_HANDLE handle, char *buffer, s32
size, MFSDKBOOL bSync);

Function This includes writing through or flushing a disk cache if present

Params

in

out

return

handle

buffer

size

None

>0

File handle to be written

Data to be written

data sizeto be written

Success.The number of bytes
written.

actually

239

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail,Ref. MfSdkFsRet_E

remark

demo

13.23 MfSdkFsWriteBlockByName

Prototype

LIB_EXPORT s32 MfSdkFsWriteBlockByName(s8 * file_name, s32
write_start, s8 * write_buff, s32 write_size)

Function write one block data

file_name

File handle to be written

write_start

Data to be written

write_buff

write_size

data sizeto be written

write data count

None

>0

Success.The number of bytes
written.

actually

Other

fail,Ref. MfSdkFsRet_E

Params

in

out

return

remark

demo

13.24 MfSdkFsWriteProfileInt

Prototype

LIB_EXPORT s32 MfSdkFsWriteProfileInt(const s8* section, const
s8* key, s32 value, const s8* file)

Function write a profile int to a ini file

Params

in

out

return

section

key

value

file

None

1

0

name of the section,can't be NULL and empty
string

name of the key pairs to value, can't be NULL
and empty string

profile int value

file path of ini file

Success

fail

240

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

13.25 MfSdkFsWriteProfileString

Prototype

LIB_EXPORT s32 MfSdkFsWriteProfileString(const s8* section,
const s8* key, const s8* value, const s8* file)

Function write a profile string to a ini file

section

key

value

file

None

1

0

name of the section,can't be NULL and empty
string

name of the key pairs to value, can't be NULL
and empty string

profile string value

file path of ini file

Success

fail

Params

in

out

return

remark

demo

13.26 MfSdkFsRenamePath

Prototype

LIB_EXPORT s32 MfSdkFsRenamePath(const char *oldName,
const char *newName)

Function renames a file, moving it between directories if required

Params

in

out

oldName

newName

None

MFSDK_FS_RET_O
K

MFSDK_FS_RET_P
ARM_ERROR

Success

Input params NULL

Other

Failed

return

remark

241

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

MfSdkFsRenamePath("testdir3\\test.txt", "testdir4\\test.txt");

13.27 MfSdkFsClearFile

Prototype s32 MfSdkFsClearFile(cchar *FileName);

Function truncate to 0

FileName

File Name

None

MFSDK_FS_RET_O
K

MFSDK_FS_RET_P
ARM_ERROR

Success

Input params NULL

Other

Failed

Params

in
out

return

remark

demo

13.28 MfSdkFsDelDirFiles

Prototype s32 MfSdkFsDelDirFiles(const char* path);

Function Delete the files in the directory

Params

in
out

path

None

path

Ref. MfSdkFsRet_E

return
remark

demo

13.29 MfSdkFsRenameA

Prototype

s32 MfSdkFsRenameA(const char *oldpath, const char
*newpath);

242

Fujian MoreFun Electronic Technology Co.,Ltd.

Function File or directory rename.

Params

in
out

oldpath

newpath

old path

new path

Ref. MfSdkFsRet_E

return
remark

demo

13.30 MfSdkFsGetFileLength

Prototype LIB_EXPORT s32 MfSdkFsGetFileLength(const char *fileName)

Function Get file length.

fileName

File name

None

< 0

>=0

Failed

File length

Params

in
out

return

remark

demo

13.31 MfSdkFsRmdir

Prototype LIB_EXPORT s32 MfSdkFsRmDir(const char *path)

Function Remove dir

Params

in
out

path

None

Dir path

return

remark

demo

MFSDK_FS_RET_O
K

success

Other

fail

if(MfSdkFsRmDir(exdata\\testdir) == MFSDK_FS_RET_OK)
{

243

Fujian MoreFun Electronic Technology Co.,Ltd.

// testdir will be removed

}

13.32 MfSdkFsOpenDir

Prototype LIB_EXPORT void *MfSdkFsOpenDir(const char *path)

Function Open dir

Params

in
out

path

None

Dir path

return

remark

Dir pointer

success

NULL

fail

void *pdp = MfSdkFsOpenDir(dirname);

if(pdp != NULL)

{

MfSdkDirent_T *ent = NULL;

while((ent = MfSdkFsReadDir(pdp)) != NULL)

{

FS_TRACE("ql_readdir ent->d_type=%d ,ent->d_name: %s ,ent->d_ino:%d\r\n",

demo

ent->d_type, ent->d_name, ent->d_ino);

}

MfSdkFsCloseDir(pdp);

}

else

{

}

FS_TRACE("folder %s does not exist\r\n",dirname);

13.33 MfSdkFsReadDir

Prototype LIB_EXPORT MfSdkDirent_T* MfSdkFsReadDir(void *dp)

Function Read dir

Params

in

dp

Dir pointer

244

Fujian MoreFun Electronic Technology Co.,Ltd.

out

return

remark

None

pointer

NULL

success

fail

void *pdp = MfSdkFsOpenDir(dirname);

if(pdp != NULL)

{

MfSdkDirent_T *ent = NULL;

while((ent = MfSdkFsReadDir(pdp)) != NULL)

{

FS_TRACE("ql_readdir ent->d_type=%d ,ent->d_name: %s ,ent->d_ino:%d\r\n",

demo

ent->d_type, ent->d_name, ent->d_ino);

}

MfSdkFsCloseDir(pdp);

}

else

{

}

FS_TRACE("folder %s does not exist\r\n",dirname);

13.34 MfSdkFsCloseDir

Prototype LIB_EXPORT s32 MfSdkFsCloseDir(void *dp)

Function Close dir

Params

in
out

path

None

Dir path

return

remark

Dir pointer

success

NULL

fail

void *pdp = MfSdkFsOpenDir(dirname);

if(pdp != NULL)

{

demo

MfSdkDirent_T *ent = NULL;

while((ent = MfSdkFsReadDir(pdp)) != NULL)

{

FS_TRACE("ql_readdir ent->d_type=%d ,ent->d_name: %s ,ent->d_ino:%d\r\n",

ent->d_type, ent->d_name, ent->d_ino);

245

Fujian MoreFun Electronic Technology Co.,Ltd.

}

MfSdkFsCloseDir(pdp);

}

else

{

}

FS_TRACE("folder %s does not exist\r\n",dirname);

14FIFO module

14.1 Module description

FIFO stands for "First In, First Out," and it refers to a method of
organizing and manipulating data structures, particularly in computing
and queue management. In a FIFO system, the first item that is added
is the first one to be removed. It operates on the principle that the first
element added to a collection is the first one to be removed.

14.2 Module structure declaration

typedef struct
{

//dequeue pointer

u32 Outp;
u32 Inp;
u8 *pBuff;
u32 nSize;
s32 pEvent;
}MfSdkFifoData_T;

//enqueue pointer
//buffer
//FIFO size
//mutex

14.3 Constant declarations

typedef enum
{

MFSDK_FIFO_FAILED = -3, //failed
MFSDK_FIFO_BOUNDS = -2, //Array out-of-bounds
MFSDK_FIFO_PARM_ERROR = -1, //check param
MFSDK_FIFO_OK = 0,

}MfSdkFifoRet_E;

246

Fujian MoreFun Electronic Technology Co.,Ltd.

14.4 MfSdkFifoCreate

Prototype

LIB_EXPORT MFSDKBOOL MfSdkFifoCreate(MfSdkFifoData_T

* pstFifo , s32 nSize )

Function

Create fifo

Params

in

out

return

remark

pstFifo

nSize

Nothing

MfSdkFifoData_T

FIFO size

MFSDK_TRUE Success

MFSDK_FALSE Failed

MfSdkFifoData_T playFifo;

memset(&playFifo,0,sizeof(MfSdkFifoData_T));

MFSDKBOOL b = MfSdkFifiCreate(&playFifo,4096);

demo

if(b)

{

}

else

{

}

//TODO success

//TODO failed

14.5 MfSdkFifoGet

Prototype

LIB_EXPORT s32 MfSdkFifoGet(MfSdkFifoData_T* pstFifo,u8 *
pData , s32 nLen)

Function Get FIFO data.

Params

in

out

return

remark

demo

pstFifo

MfSdkFifoData_T

nLen

pData

> 0

other

pData buffer max size

Get FIFO data

Get FIFO data length

Failed

247

Fujian MoreFun Electronic Technology Co.,Ltd.

14.6 MfSdkFifoInit

Prototype

LIB_EXPORT MFSDKBOOL MfSdkFifoInit(MfSdkFifoData_T*
pstFifo)

Function Init FIFO

Params

in
out

pstFifo

Nothing

MfSdkFifoData_T

return

remark

demo

MFSDK_TRUE

Success

MFSDK_FALSE Failed

MfSdkFifoData_T playFifo;

memset(&playFifo,0,sizeof(MfSdkFifoData_T));

MFSDKBOOL b = MfSdkFifiCreate(&playFifo,4096);

if(b)

{

}

else

{

}

//TODO success

MfSdkFifoInit(&playFifo);

//TODO failed

14.7 MfSdkFifoIsEmpty

Prototype

LIB_EXPORT MFSDKBOOL MfSdkFifoIsEmpty(MfSdkFifoData_T*
pstFifo)

Function Check whether the queue is empty.

Params

in
out

pstFifo

Nothing

MfSdkFifoData_T

return

MFSDK_TRUE

Empty

MFSDK_FALSE Not empty

248

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

MfSdkFifoData_T playFifo;

if(MfSdkFifoIsEmpty(&pstFifo))

{

}

//TODO Empty

14.8 MfSdkFifoIsFull

Prototype

LIB_EXPORT MFSDKBOOL MfSdkFifoIsFull(MfSdkFifoData_T*
pstFifo)

Function Check whether the queue is full.

Params

in
out

pstFifo

Nothing

MfSdkFifoData_T

return

remark

demo

MFSDK_TRUE

Full

MFSDK_FALSE Not full

MfSdkFifoData_T playFifo;

if(MfSdkFifoIsFull(&pstFifo))

{

}

//TODO Full

14.9 MfSdkFifoPut

Prototype

LIB_EXPORT s32 MfSdkFifoPut(MfSdkFifoData_T* pstFifo, u8 *
pData , s32 nLen)

Function Insert data to FIFO.

Params

in

out

return

pstFifo

pData

nLen

Nothing

> 0

< 0

MfSdkFifoData_T

Insert data buffer

Insert data buffer length

Actual data length

Failed

249

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

MfSdkFifoData_T playFifo;

char data[128] = {0};

Strcpy(data,"volmax.mp3");

s32 ilen = MfSdkFifoPut(&playFifo,data ,strlen(data));

If(ilen != strlen(data))

{

}

//TODO failed

14.10MfSdkFifoResize

Prototype

LIB_EXPORT MFSDKBOOL MfSdkFifoResize(MfSdkFifoData_T

* pstFifo , s32 nSize )

Function

Change the FIFO size.

Params

in

out

return

remark

pstFifo

nSize

Nothing

MfSdkFifoData_T

FIFO size

MFSDK_TRUE Success

MFSDK_FALSE Failed

MfSdkFifoData_T playFifo;

memset(&playFifo,0,sizeof(MfSdkFifoData_T));

MFSDKBOOL b = MfSdkFifoResize(&playFifo,4096);

demo

if(b)

{

}

else

{

}

//TODO success

//TODO failed

14.11MfSdkGetFifoNum

Prototype

LIB_EXPORT s32 MfSdkGetFifoNum(MfSdkFifoData_T *

pstFifo)

250

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Get the number of elements in the FIFO.

Params

in
out

pstFifo

Nothing

> 0

MfSdkFifoData_T

The number of elements in the FIFO

return

remark

demo

MFSDK_FIFO_PARM_E
RROR

Param invalid

MfSdkFifoData_T playFifo;

s32 fifo_len = MfSdkGetFifoNum(&playFifo);

14.12MfSdkGetGetFifoSize

Prototype

LIB_EXPORT s32 MfSdkGetGetFifoSize(MfSdkFifoData_T *

pstFifo)

Function

Get fifo size.

Params

in
out

return

remark

demo

pstFifo

Nothing

> 0

MfSdkFifoData_T

FIFO size

MFSDK_FIFO_PARM_E
RROR

Param invalid

MfSdkFifoData_T playFifo;

s32 fifoSize = MfSdkGetGetFifoSize(&playFifo);

15 Audio module

15.1 Module description

This module mainly includes Audio APIs.

15.2 Module structure declaration

typedef enum
{

MFSDK_AUD_PLAY_UNIT_MIN = 0,
MFSDK_AUD_PLAY_UNIT_TEN = MFSDK_AUD_PLAY_UNIT_MIN,
MFSDK_AUD_PLAY_UNIT_HUNDRED,

251

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_AUD_PLAY_UNIT_THOUSAND,
MFSDK_AUD_PLAY_UNIT_TEN_THOUSAND,
MFSDK_AUD_PLAY_UNIT_YUAN,
MFSDK_AUD_PLAY_UNIT_MAX

}MfSdkAudPlayUnit_T;

15.3 Constant declarations

typedef enum
{

MFSDK_AUD_PAY_MIN = 0,
MFSDK_AUD_PAY_PROCESSING = MFSDK_AUD_PAY_MIN,
MFSDK_AUD_PAY_FAIL,
MFSDK_AUD_PAY_SUCCESS,
MFSDK_AUD_PAY_SCAN_SUCCESS,
MFSDK_AUD_PAY_VOID_SUCCESS,
MFSDK_AUD_PAY_MAX,

}MfSdkAudPayResult_E;

typedef enum
{

MFSDK_AUD_PLAY_NUM_MIN = 0,
MFSDK_AUD_PLAY_NUM_ZERO = MFSDK_AUD_PLAY_NUM_MIN,
MFSDK_AUD_PLAY_NUM_ONE,
MFSDK_AUD_PLAY_NUM_TWO,
MFSDK_AUD_PLAY_NUM_THREE,
MFSDK_AUD_PLAY_NUM_FOUR,
MFSDK_AUD_PLAY_NUM_FIVE,
MFSDK_AUD_PLAY_NUM_SIX,
MFSDK_AUD_PLAY_NUM_SEVEN,
MFSDK_AUD_PLAY_NUM_EIGHT,
MFSDK_AUD_PLAY_NUM_NINE,
MFSDK_AUD_PLAY_NUM_DOT,
MFSDK_AUD_PLAY_NUM_MAX

}MfSdkAudPlayNum_E;

typedef enum
{

MFSDK_AUD_PAY_TYPE_MIN = 0,
MFSDK_AUD_PAY_TYPE_WECHAT =

MFSDK_AUD_PAY_TYPE_MIN,

MFSDK_AUD_PAY_TYPE_ALIPAY,
MFSDK_AUD_PAY_TYPE_UNIONPAY,
MFSDK_AUD_PAY_TYPE_CARD,

252

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_AUD_PAY_TYPE_SCAN = 7,
MFSDK_AUD_PAY_TYPE_MAX

}MfSdkAudPlayPayType_E;

typedef enum
{

MFSDK_AUD_RET_FAILED = -3,
MFSDK_AUD_RET_BOUNDS = -2,
MFSDK_AUD_RET_PARM_ERROR = -1,
MFSDK_AUD_RET_OK = 0,

//failed

//Array out-of-bounds
//check param

}MfSdkAudRet_E;

15.4 MfSdkAudPlayVoice

Prototype

LIB_EXPORT void MfSdkAudPlayVoice(s8 *msg)

Function

Play Audio file.

Params

in
out

return
remark

demo

msg

Nothing

Nothing

15.5 MfSdkAudPlayAmt

Prototype

LIB_EXPORT s32 MfSdkAudPlayAmt(s32 amount)

Function

Play Amt audio.

Params

in
out

amount

Nothing

Ref. MfSdkAudRet_E

return
remark

demo

253

Fujian MoreFun Electronic Technology Co.,Ltd.

15.6 MfSdkAudPlayBatteryLevel

Prototype

LIB_EXPORT s32 MfSdkAudPlayBatteryLevel(void)

Function

Play battery level.

Params

in
out

Nothing

Nothing

Ref. MfSdkAudRet_E

return
remark

demo

15.7 MfSdkAudPlayFile

Prototype

LIB_EXPORT s32 MfSdkAudPlayFile(const s8 * folder, const s8

* sndfile)

Function

Play audio file.

Params

in
out

Nothing

Nothing

return
remark

demo

Ref. MfSdkAudRet_E

pub_tts_play and pub_tts_playOpt

15.8 MfSdkAudPlay

Prototype

LIB_EXPORT s32 MfSdkAudPlay(const s8 * sndfile)

Function

Play audio file.

Params

in
out

return
remark

sndfile

Nothing

Ref. MfSdkAudRet_E

254

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

15.9 MfSdkAudPlayNum

LIB_EXPORT s32 MfSdkAudPlayNum(MfSdkAudPlayNum_E

index)

index

Nothing

Ref. MfSdkAudRet_E

Prototype

Function

Params

in
out

return
remark

demo

15.10 MfSdkAudPlayNumber

Prototype

LIB_EXPORT s32 MfSdkAudPlayNumber(s32 num)

Function

Params

in
out

return
remark

demo

num

Nothing

Ref. MfSdkAudRet_E

15.11 MfSdkAudPlayPayResult

Prototype

Function

Params

in
out

LIB_EXPORT s32

MfSdkAudPlayPayResult(MfSdkAudPayResult_E index)

index

Nothing

255

Fujian MoreFun Electronic Technology Co.,Ltd.

Ref. MfSdkAudRet_E

return
remark

demo

15.12 MfSdkAudPlayPayType

LIB_EXPORT s32

MfSdkAudPlayPayType(MfSdkAudPlayPayType_E payType)

index

Nothing

Ref. MfSdkAudRet_E

Prototype

Function

Params

in
out

return
remark

demo

15.13 MfSdkAudPlayUnit

LIB_EXPORT s32 MfSdkAudPlayUnit(MfSdkAudPlayUnit_T

index)

index

Nothing

Ref. MfSdkAudRet_E

Ref. MfSdkAudPlayUnit_T

Prototype

Function

Params

in
out

return
remark

demo

15.14 MfSdkAudTtsState

Prototype

LIB_EXPORT MFSDKBOOL MfSdkAudTtsState(void)

Function

256

Fujian MoreFun Electronic Technology Co.,Ltd.

Params

in
out

Nothing

Nothing

return

remark

demo

MFSDK_TRUE

success

MFSDK_FALSE

fail

if(MfSdkAudTtsState())

{

}

//busy

else{

//TODO

}

15.15 MfSdkAudBatchBegin

Prototype

LIB_EXPORT void MfSdkAudBatchBegin(void)

Function

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

Deprecated

15.16 MfSdkAudBathcEnd

Prototype

LIB_EXPORT void MfSdkAudBathcEnd(void)

Function

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

Deprecated

257

Fujian MoreFun Electronic Technology Co.,Ltd.

15.17 MfSdkAudClear

Prototype

LIB_EXPORT void MfSdkAudClear(void)

Function

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

15.18 MfSdkAudTtsPlay

Prototype

LIB_EXPORT s32 MfSdkAudTtsPlay(s8 *msg)

Function

TTS

Params

in
out

msg

Nothing

Text Message

return
remark

demo

Ref. MfSdkAudRet_E

MfSdkAudTtsPlay(exdata\\welc.mp3);

15.19 MfSdkAudSetVolume

Prototype

LIB_EXPORT void MfSdkAudSetVolume(s32 val)

Function

set audio volume

Params

in
out

return
remark

val

Nothing

Nothing

258

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

15.20 MfSdkAudSetVolumeRunning

Prototype

LIB_EXPORT void MfSdkAudSetVolumeRunning(s32 val)

Function

Set the volume when playing voice

Params

in
out

val

Nothing

Nothing

return
remark

demo

15.21 MfSdkAudGetVolume

Prototype

LIB_EXPORT s32 MfSdkAudGetVolume()

Function

Get the volume size

Params

in
out

return
remark

demo

Nothing

Nothing

Volume

15.22 MfSdkAudSetSpeed

Prototype

LIB_EXPORT void MfSdkAudSetSpeed(s32 val)

Function

Set audio play speed

Params

in
out

val

Nothing

259

Fujian MoreFun Electronic Technology Co.,Ltd.

Nothing

unimplemented

return
remark

demo

16 KeyBoard module

16.1 Module description

This module mainly includes APIs related to KeyBoard.

16.2 Module structure declaration

None.

16.3 Constant declarations

typedef enum
{

MFSDK_KB_RET_TIMEOUT = -4, //time over
MFSDK_KB_RET_FAILED = -3, //failed
MFSDK_KB_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_KB_RET_PARM_ERROR = -1, //check param
MFSDK_KB_RET_OK = 0,

}MfSdkKbRet_E;

typedef enum
{

MFSDK_VK_INVALID = -1,

MFSDK_VK_0 = 0x30,
MFSDK_VK_1 = 0x31,
MFSDK_VK_2 = 0x32,
MFSDK_VK_3 = 0x33,
MFSDK_VK_4 = 0x34,
MFSDK_VK_5 = 0x35,
MFSDK_VK_6 = 0x36,
MFSDK_VK_7 = 0x37,
MFSDK_VK_8 = 0x38,
MFSDK_VK_9 = 0x39,

MFSDK_VK_CTL = 100,
MFSDK_VK_UP ,
MFSDK_VK_DOWN,
MFSDK_VK_LEFT,

260

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_VK_RIGHT,

MFSDK_VK_F1,
MFSDK_VK_F2,
MFSDK_VK_BACKSPACE,
MFSDK_VK_ESC,
MFSDK_VK_ENTER,
MFSDK_VK_XING, // start
MFSDK_VK_JING, //Hash

}MfSdkKbKeyCode_E;

16.4 MfSdkKbKeySetParam

LIB_EXPORT void MfSdkKbKeySetParam(int key, int

short_press_time, int long_press_time, int short_press_delay)

key

short_press_time

long_press_time

short_press_delay

Nothing

Nothing

Prototype

Function

Params

in

out

return
remark

demo

16.5 MfSdkKbGetKeySound

Prototype

LIB_EXPORT s32 MfSdkKbGetKeySound()

Function

Params

in
out

return

remark

Nothing

Nothing

0

1

close

open

261

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

16.6 MfSdkKbSetKeySound

Prototype

LIB_EXPORT void MfSdkKbSetKeySound(s32 nOpen)

Function

Params

in
out

return
remark

demo

nOpen

Nothing

Nothing

1 open; 0 close

16.7 MfSdkKbWaitKey

Prototype

LIB_EXPORT s32 MfSdkKbWaitKey(s32 TimeOut)

Function

Waiting button, waits for the button within the set time, while the
Nothing button waits for the timeout.

Waiting timeout time (seconds), 0 means
blocking

key value

fail

TimeOut

Nothing

>=0

Other

Params

in

out

return

remark

demo

17 Lcd module

17.1 Module description

This module mainly includes APIs related to LCD.

17.2 Module structure declaration

None.

262

Fujian MoreFun Electronic Technology Co.,Ltd.

17.3 Constant declarations

typedef enum
{

MFSDK_LCD_OFF = 0, //turn off backlight
MFSDK_LCD_AUTO = 1,// system automatically controls
MFSDK_LCD_ON = 2, //backlight is always bright

}MfSdkLcdStatus_E;

typedef enum
{

MFSDK_LCD_RET_FAILED = -3, //failed
MFSDK_LCD_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_LCD_RET_PARM_ERROR = -1, //check param
MFSDK_LCD_RET_OK = 0, //success

}MfSdkLcdRet_E;

typedef enum
{

MFSDK_LCD_BRT_LEVEL_MIN = 0,
MFSDK_LCD_BRT_LEVEL_1,
MFSDK_LCD_BRT_LEVEL_2,
MFSDK_LCD_BRT_LEVEL_3,
MFSDK_LCD_BRT_LEVEL_4,
MFSDK_LCD_BRT_LEVEL_MAX,

}MfSdkLcdBrighnesstLevel_E;

typedef enum
{

MFSDK_LCD_ARROW_UP = 0, //up arrow
MFSDK_LCD_ARROW_DOWN = 1, //down arrow

}MfSdkLcdArrow_E;

17.4 MfSdkLcdBackLight

Prototype

LIB_EXPORT s32 MfSdkLcdBackLight(s32 status)

Function

Params

in

status

Ref. MfSdkLcdStatus_E

263

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_LCD_OFF-OFF,MFSDK_LCD_O
N-ON

out

Nothing

Ref. MfSdkLcdRet_E

return
remark

demo

17.5 MfSdkLcdSegmentBackLight

Prototype

LIB_EXPORT s32 MfSdkLcdSegmentBackLight(s32 status)

Function

Segment code LCD

status

Nothing

Ref. MfSdkLcdRet_E

Params

in

out

return
remark

demo

Ref. MfSdkLcdStatus_E

MFSDK_LCD_OFF-OFF,MFSDK_LCD_O
N-ON

17.6 MfSdkLcdGetSubProbe

Prototype

LIB_EXPORT s32 MfSdkLcdGetSubProbe()

Function

Params

in
out

return
remark

demo

Nothing

Nothing

Ref. MfSdkLcdRet_E

unimplemented

264

Fujian MoreFun Electronic Technology Co.,Ltd.

17.7 MfSdkLcdSetIndex

Prototype

LIB_EXPORT void MfSdkLcdSetIndex(s32 index)

Function

Params

in
out

return
remark

demo

index

Nothing

Nothing

unimplemented

17.8 MfSdkLcdGetPowerDownTime

Prototype

LIB_EXPORT s32 MfSdkLcdGetPowerDownTime()

Function

Get the shutdown time

Nothing

Nothing

Shutdown time

Params

in
out

return
remark

demo

17.9 MfSdkLcdSetPowerDownTime

Prototype

LIB_EXPORT void MfSdkLcdSetPowerDownTime(s32 ntime)

Function

Set the shutdown time

Params

in
out

return
remark

ntime

Nothing

Nothing

265

Shutdown time unit: second

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

17.10 MfSdkLcdGetBackLightTime

Prototype

LIB_EXPORT s32 MfSdkLcdGetBackLightTime()

Function

Get BackLight time

Nothing

Nothing

Backlight time

Params

in
out

return
remark

demo

17.11 MfSdkLcdSetBackLightTime

Prototype

LIB_EXPORT void MfSdkLcdSetBackLightTime(s32 ntime)

Function

Set backlight time

Params

in
out

ntime

Nothing

Backlight time

Nothing

return
remark

demo

17.12 MfSdkLcdGetFrontBackLightTime

Prototype

s32 MfSdkLcdGetFrontBackLightTime();

Function

Get Front Screen Backlight time (for MP70A6)

Params

in
out

None

None

266

Fujian MoreFun Electronic Technology Co.,Ltd.

Backlight time

return
remark

demo

17.13 MfSdkLcdSetFrontBackLightTime

Prototype

void MfSdkLcdSetFrontBackLightTime(s32 ntime);

Function

Set Front Screen Backlight time (for MP70A6)

Backlight time,max value 99999999

unit:second

ntime

None

None

Params

in

out

return
remark

demo

17.14 MfSdkLcdGetRearBackLightTime

Prototype

s32 MfSdkLcdGetRearBackLightTime();

Function

Get Rear Screen Backlight time (for MP70A6)

None

None

Backlight time

Params

in
out

return
remark

demo

17.15 MfSdkLcdSetRearBackLightTime

Prototype

void MfSdkLcdSetRearBackLightTime(s32 ntime);

267

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Set Rear Screen Backlight time (for MP70A6)

Backlight time,max value 99999999

unit:second

ntime

None

None

Params

in

out

return
remark

demo

17.16 MfSdkLcdBrightnessLevelSettings

s32

Prototype

MfSdkLcdBrightnessLevelSettings(MfSdkLcdBrighnesstLevel_E
level);

Function

Screen Brightness Level Settings

Params

in
out

level

None

MfSdkLcdBrighnesstLevel_E level 0~5

Refer to MfSdkLcdRet_E

return
remark

demo

17.17 MfSdkLcdAutoFlush

Prototype

s32 MfSdkLcdAutoFlush(MFSDKBOOL bValue);

Function

Whether to auto Refresh the LCD

true-enble flush lcd,false-disable flush

lcd

bValue

None

Refer to MfSdkLcdRet_E

Params

in

out

return
remark

demo

268

Fujian MoreFun Electronic Technology Co.,Ltd.

17.18 MfSdkLcdSetNormalDirection

Prototype

s32 MfSdkLcdSetNormalDirection();

Function

Return to normal display

Params

in
out

None

None

Refer to MfSdkLcdRet_E

return
remark

demo

17.19 MfSdkLcdArrowDisplay

Prototype

void MfSdkLcdArrowDisplay(MfSdkLcdArrow_E index,

MFSDKBOOL enable);

Function

Status Bar Display Up/Down Arrow.only support SR600mini

index

enable

None

None

0:up,1:down

1:on,0:off

Params

in

out

return
remark

demo

17.20 MfSdkLcdBacklightIsBright

Prototype

MFSDKBOOL MfSdkLcdBacklightIsBright();

Function

Check the screen backlight status

Params

in
out

return

None

None

1

on

269

Fujian MoreFun Electronic Technology Co.,Ltd.

0

off

remark

demo

18 Log module

18.1 Module description

This module mainly includes APIs about log output.

18.2 Module structure declaration

None.

18.3 Constant declarations

//close log output
# define MFSDK_LOG_CLOSE_OUT (0)
//The logs will be output from the USB port
# define MFSDK_LOG_USB_OUT (1)
//The logs will be output from the wifi port
# define MFSDK_LOG_WIFI_OUT (2)

typedef enum
{

MFSDK_LOG_LEVEL_TRACE = 0, //trace
MFSDK_LOG_LEVEL_DEBUG, //debug
MFSDK_LOG_LEVEL_INFO, //info
MFSDK_LOG_LEVEL_WARN, //warning
MFSDK_LOG_LEVEL_ERROR,//error
MFSDK_LOG_LEVEL_FATAL,
MFSDK_LOG_LEVEL_FILE,

}MfSdkLogLevel_E;

18.4 MfSdkLogSoundSet

Prototype

LIB_EXPORT s32 MfSdkLogSoundSet(s32 val)

Function

Set the log output mode

270

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_LOG_USB_OUT/MFSDK_LOG

_WIFI_OUT

success

Params

in

out

return
remark

demo

val

Nothing

0

18.5 MfSdkLog

Prototype

LIB_EXPORT void MfSdkLog(const char *pTag,const char

*fmt,...)

Function

module is "MFSDKLOG"

pTag

fmt

...

Nothing

Nothing

default level:MFSDK_LOG_LEVEL_TRACE

Params

in

out

return
remark

demo

18.6 MfSdkLogTip

LIB_EXPORT void MfSdkLogTip(const char* module,

Prototype

MfSdkLogLevel_E level, const void* Buffer, s32 nSize, char* tip,
s32 breakline)

Function

Params

in

out

module

level

Buffer

nSize

tip

breakline

Nothing

return

Nothing

271

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

18.7 MfSdkLogHexBuff

LIB_EXPORT void MfSdkLogHexBuff(const char* module,

MfSdkLogLevel_E level,s8*Buffer, s32 nSize)

module

level

Buffer

nSize

Nothing

Nothing

Prototype

Function

Params

in

out

return
remark

demo

18.8 MfSdkLogLevel

Prototype

Function

Params

in

out

return
remark

demo

LIB_EXPORT void MfSdkLogLevel(const char* module,

MfSdkLogLevel_E level, const char* fmt, ...)

module

level

fmt

...

Nothing

Nothing

272

Fujian MoreFun Electronic Technology Co.,Ltd.

18.9 MfSdkLogOutputSwitch

Prototype

void MfSdkLogOutputSwitch(MFSDKBOOL enable);

MFSDK_TRUE: enable output of logs ,

MFSDK_FALSE: disenable output of

logs

Function

default enable

Params

in

out

return
remark

demo

val

Nothing

Nothing

19 Power module

19.1 Module description

This module mainly includes APIs about power, battery and

backlight time set.

19.2 Module structure declaration

None.

19.3 Constant declarations

typedef enum
{

MFSDK_POWER_RET_UNSUPPORT = -4, // dont support
MFSDK_POWER_RET_FAILED = -3, //failed
MFSDK_POWER_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_POWER_RET_PARM_ERROR = -1, //check param
MFSDK_POWER_RET_OK = 0, //success

}MfSdkPowerRet_E;

typedef enum{

MFSDK_POWER_POWER_MANAGER_REBOOT,
MFSDK_POWER_POWER_MANAGER_SHUTDOWN,
MFSDK_POWER_MANAGER_ENTER_PAGE = 4,

273

Fujian MoreFun Electronic Technology Co.,Ltd.

}MfSdkPowerManagerType_E;

typedef enum {

MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_UNKNOWN = 0,
MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_CRITICAL,
MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_LOW,
MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_NORMAL,
MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_HIGH,
MFSDK_POWER_SUPPLY_CAPACITY_LEVEL_FULL,

}MfSdkPowerCapacityLevel_E;

typedef enum
{

MFSDK_POWER_LOW_BATTERY_REMID = 0,
MFSDK_POWER_LOW_BATTERY_SHUTDOWN,

}
MfSdkPowerPageParm_E;

typedef enum
{

MFSDK_POWER_ACONLINE_SLEEP_DN = 0, // Unable to sleep

when connected to external power

MFSDK_POWER_ACONLINE_SLEEP_EN = 1, // Enable to sleep

when connected to external power

}MfSdkPowerSleep_E;
typedef s32 (*MfSdkPowerResumeProcCb)(s32 ret);
typedef s32 (*MfSdkPowerManagerCb)(MfSdkPowerManagerType_E

type);

typedef void(*MfSdkPowerPageCbFunc)(int);

19.4 MfSdkPowerResumeProc

Prototype

LIB_EXPORT s32

MfSdkPowerResumeProc(MfSdkPowerResumeProcCb pFuncCb)

Function

set resume callback

Params

in
out

return
remark

pFuncCb

Nothing

Ref. MfSdkPowerRet_E

274

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

19.5 MfSdkPowerManagerSetFunc

Prototype

void MfSdkPowerManagerSetFunc(MfSdkPowerManagerCb

cb);

Function

set power manager callback

Params

in
out

cb

Nothing

power manager callback

None

return
remark

demo

19.6 MfSdkPowerLockApp

Prototype

LIB_EXPORT s32 MfSdkPowerLockApp(char *sfun)

Function

Params

in
out

return
remark

demo

sfun

Nothing

Ref. MfSdkPowerRet_E

19.7 MfSdkPowerUnlockApp

Prototype

LIB_EXPORT void MfSdkPowerUnlockApp(void)

Function

Params

in
out

Nothing

Nothing

275

Fujian MoreFun Electronic Technology Co.,Ltd.

Nothing

return
remark

demo

19.8 MfSdkPowerTaskInit

Prototype

LIB_EXPORT s32 MfSdkPowerTaskInit(s32 taskid)

Function

Params

in
out

return
remark

demo

taskid

Nothing

Ref. MfSdkPowerRet_E

19.9 MfSdkPowerTaskSuspend

Prototype

LIB_EXPORT s32 MfSdkPowerTaskSuspend(s32 taskid , s32

ms)

Function

Sleep is possible within xx ms

taskid

ms

Nothing

Task ID

ms (unit:ms)

Ref. MfSdkPowerRet_E

Params

in

out

return
remark

demo

19.10 MfSdkPowerReset

Prototype

LIB_EXPORT s32 MfSdkPowerReset(void)

276

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Restart device.

Params

in
out

return
remark

demo

Ref. MfSdkPowerRet_E

19.11 MfSdkPowerPageCb

Prototype

LIB_EXPORT s32

MfSdkPowerPageCb(MfSdkPowerPageCbFunc fun)

Function

The device start-up callback.

Params

in
out

fun

Nothing

Ref. MfSdkPowerRet_E

return
remark

demo

19.12 MfSdkPowerPageInit

Prototype

Function

Params

in

out

return
remark

demo

LIB_EXPORT s32 MfSdkPowerPageInit(void* state, lv_align_t

align, lv_coord_t x_ofs, lv_coord_t y_ofs)

state

align

x_ofs

y_ofs

Nothing

Ref. MfSdkPowerRet_E

277

Fujian MoreFun Electronic Technology Co.,Ltd.

19.13 MfSdkPowerSetTime

Prototype

LIB_EXPORT void MfSdkPowerSetTime(s32 time_num)

Function

Set the sleep mode time

Params

in
out

time_num

Nothing

Sleep mode time(unit: second)

Nothing

return
remark

demo

19.14 MfSdkPowerOff

Prototype

LIB_EXPORT void MfSdkPowerOff(void)

Function

Power off

Params

in
out

Nothing

Nothing

Nothing

return
remark

demo

19.15 MfSdkPowerKeySetLight

Prototype

LIB_EXPORT void MfSdkPowerKeySetLight()

Function

Params

in
out

return
remark

Nothing

Nothing

Nothing

278

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

19.16 MfSdkPowerGetBatteryPercentage

Prototype

LIB_EXPORT s32 MfSdkPowerGetBatteryPercentage()

Function

Get the battery percentage.

Nothing

Nothing

0-100

Battery Percentage

MFSDK_POWER_RET_F
AILED

fail

Params

in
out

return

remark

demo

19.17 MfSdkPowerSetBacklightTime

Prototype

LIB_EXPORT s32 MfSdkPowerSetBacklightTime(s32 seconds)

Function

set turn off backlight time

Params

in
out

seconds

Nothing

MFSDK_POWER_RET_
OK

success

Other

fail,Ref.MfSdkPowerRet_E

return

remark

demo

19.18 MfSdkPowerSupertimeReset

Prototype

LIB_EXPORT s32 MfSdkPowerSupertimeReset(void)

279

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

reset backlight time

Params

in
out

Nothing

Nothing

MFSDK_POWER_RET_
OK

success

Other

fail,Ref.MfSdkPowerRet_E

return

remark

demo

19.19 MfSdkPowerSwitchResetTick

Prototype

s32 MfSdkPowerSwitchResetTick(void);

Function

Reset the sleep timer

Params

in
out

Nothing

Nothing

Ref.MfSdkPowerRet_E

remark

demo

19.20 MfSdkPowerSleepSwitch

Prototype

void MfSdkPowerSleepSwitch(MfSdkPowerSleep_E switchE);

Function

set sleep

Params

in

out

remark

switchE

Nothing

Nothing

280

MFSDK_POWER_ACONLINE_SLEEP_

EN:enable,
MFSDK_POWER_ACONLINE_SLEEP_D
N:disable

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

20 QR module

20.1 Module description

This module mainly includes APIs about QR & Scanner

operations.

20.2 Module structure declaration

None.

20.3 Constant declarations

typedef enum
{

MFSDK_QR_RET_DECODE_FAILED = -4, //decode failed
MFSDK_QR_RET_FAILED = -3, //failed
MFSDK_QR_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_QR_RET_PARM_ERROR = -1, //check param
MFSDK_QR_RET_OK = 0,

}MfSdkQrRet_E;

20.4 MfSdkQrDecode

Prototype

LIB_EXPORT s32 MfSdkQrDecode(s8* code, s32 size)

Function

Get scan data

Params

in
out

size

code

scan size

scan data

MFSDK_QR_RET_FAILED

not found camera

MFSDK_QR_RET_DECODE_F

AILED

> 0

decode failed

decode data length

return

remark

demo

281

Fujian MoreFun Electronic Technology Co.,Ltd.

20.5 MfSdkQrScannerClose

Prototype

LIB_EXPORT s32 MfSdkQrScannerClose(void)

Function

Close scanner

Params

in
out

Nothing

Nothing

MFSDK_QR_RET_OK

success

Other

fail

return

remark

demo

20.6 MfSdkQrScannerGetImg

Prototype

LIB_EXPORT s8* MfSdkQrScannerGetImg(void)

Function

Get scan image

Params

in
out

return
remark

demo

Nothing

Nothing

scan image

(MF960: 480*640)

20.7 MfSdkQrScannerOpen

Prototype

LIB_EXPORT s32 MfSdkQrScannerOpen(void)

Function

Open scanner

Params

in
out

Nothing

Nothing

return

MFSDK_QR_RET_OK

success

282

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail

remark

demo

20.8 MfSdkQrSetScanBoxPosition

Prototype

void MfSdkQrSetScanBoxPosition(s32 x, s32 y);

Function

Set scaner preview position

x offset

y offset

x

y

Nothing

Nothing

Params

in

out

return
remark

demo

20.9 MfSdkQrScannerStart

Prototype

LIB_EXPORT s32 MfSdkQrScannerStart(void)

Function

Start scanner

Params

in
out

Nothing

Nothing

MFSDK_QR_RET_OK

success

Other

fail

return

remark

demo

20.10 MfSdkQrScannerStop

Prototype

LIB_EXPORT s32 MfSdkQrScannerStop(void)

283

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Stop scanner

Params

in
out

Nothing

Nothing

MFSDK_QR_RET_OK

success

Other

fail

return

remark

demo

20.11 MfSdkQrScannerSetPreview

Prototype

LIB_EXPORT void MfSdkQrScannerSetPreview(int value)

Function

Set scaner preview

1:open 0:close

value

Nothing

Nothing

Params

in
out

return
remark

demo

21 TMS module

21.1 Module description

This module mainly includes APIs about TMS operations.

21.2 Module structure declaration

None.

21.3 Constant declarations

typedef enum
{

MFSDK_TMS_RET_FAILED = -3, //failed
MFSDK_TMS_RET_BOUNDS = -2, //Array out-of-bounds
MFSDK_TMS_RET_PARM_ERROR = -1, //check param

284

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_TMS_RET_OK = 0, //success

}MfSdkTmsRet_E;

typedef enum
{

MFSDK_TMS_UPGRADE_DATA = 0, //0 upgrade data only
MFSDK_TMS_UPGRADE_APP, //1 upgrade application

}MfSdkTmsUpdateType_E;

typedef enum
{

MFSDK_TMS_APP_NOT_BUSY = 0,
MFSDK_TMS_APP_STATE_BUSY,

}MfSdkTmsAppState_E;

typedef enum
{

MFSDK_TMS_OTA_LOCAL_FLASH = 0,

//download OTA package

MFSDK_TMS_OTA_LOCAL_RAM,

//download OTA package

in Flash

in RAM

}MfSdkTmsOtaLocal_E;

typedef enum
{

MFSDK_TMS_ACTION_DOWNLOADING = 0,
MFSDK_TMS_ACTION_UPDATEING,

//Prepare to upgrade the

//tms downloading

downloaded program

MFSDK_TMS_ACTION_CALLBACK,

//App add tms download

progress callback

}MfSdkTmsAction_E;

enum {

// wait task
// wait network link
// network anomaly
// conneting
// connect failed

MFSDK_TMS_WAIT_TASK = 0,
MFSDK_TMS_WAIT_NETWORK_LINK,
MFSDK_TMS_NETWORK_ANOMALY,
MFSDK_TMS_CONNETING,
MFSDK_TMS_CONNET_FAILED,
MFSDK_TMS_REQUEST,
MFSDK_TMS_RECEIVING,
// receiving
MFSDK_TMS_RECEIVED,
// received
// logon faliure
MFSDK_TMS_LOGON_FAILURE,
MFSDK_TMS_ILLEGAL_EQUIPMENT, // illegal equipment

// request

285

Fujian MoreFun Electronic Technology Co.,Ltd.

// download limit

// error format
// md5 error try

// failure send
//failure recv
// dowmload
// downloading

MFSDK_TMS_FAILURE_SEND,
MFSDK_TMS_FAILURE_RECV,
MFSDK_TMS_DOWNLOAD,
MFSDK_TMS_DOWNLOADING,
MFSDK_TMS_DOWNLOAD_LIMIT,
MFSDK_TMS_ERROR_FORMAT,
MFSDK_TMS_MD5_ERROR_TRY,
MFSDK_TMS_DOWNLOAD_COMPLETED, // download completed
MFSDK_TMS_DOWNLOAD_CANCEL,
MFSDK_TMS_VALIDATION_FAILURE,
MFSDK_TMS_VERIFICATION_SIGNATURE,
MFSDK_TMS_NONEED_TO_UPDATE,
MFSDK_TMS_NEW_VERSION,
MFSDK_TMS_UPDATING,
MFSDK_TMS_WIFI_UPGRADE,
MFSDK_TMS_UPDATE_SUCCESS,
MFSDK_TMS_UPDATE_FAILED,
MFSDK_TMS_REBOOTING,

// no need to update
// new version
// updating
// wifi upgrade
// update success
// update failed
// rebooting

// download cancel
validation failure

//

//verification signature

}MfSdkTmsResult_E;
/**

* @brief
* @param[in] int current value
* @param[in] int total value
*/

typedef void (*MfSdkTmsProgressCb)(int, int);
/**

* @brief
* @param[in] int result type
*/

typedef void (*MfSdkTmsResultCb)(int);
/**

* @brief
* @param[in] int result type
* @return 1 : continue
*/

typedef s32 (*MfSdkTmsActionCb)(MfSdkTmsAction_E type);

21.4 MfSdkTmsSetProgressCallback

LIB_EXPORT void

Prototype

MfSdkTmsSetProgressCallback(MfSdkTmsProgressCb
pFunCallback)

286

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Set TMS progress callback function

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

21.5 MfSdkTmsSetResultCallback

Prototype

void MfSdkTmsSetResultCallback(MfSdkTmsResultCb

pFunCallback);

Function

tms result callback

pFunCallback

Callback

Nothing

Nothing

Params

in
out

return
remark

demo

21.6 MfSdkTmsHeartBeat

Prototype

LIB_EXPORT s32 MfSdkTmsHeartBeat()

Function

TMS heartBeat

Params

in
out

Nothing

Nothing

MFSDK_TMS_RET_OK

success

Other

fail

return

remark

demo

287

Fujian MoreFun Electronic Technology Co.,Ltd.

21.7 MfSdkTmsUpdate

Prototype

LIB_EXPORT void MfSdkTmsUpdate(void)

Function

TMS Update

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

21.8 MfSdkTmsUpdateFile

LIB_EXPORT s32 MfSdkTmsUpdateFile(const s8* file,

MfSdkTmsUpdateType_E flag)

file

flag

Nothing

Prototype

Function

Params

in

out

return
remark

demo

21.9 MfSdkTmsAppBusy

Prototype

LIB_EXPORT void MfSdkTmsAppBusy(MfSdkTmsAppState_E

nBusyState)

Function

Set TMS state

Params

in
out

return

nBusyState

Nothing

Nothing

288

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

21.10 MfSdkTmsCheckTimeDisable

Prototype

LIB_EXPORT void MfSdkTmsCheckTimeDisable()

Disable check time from tms server.Only for traditional POS.

nBusyState

Nothing

Nothing

Function

Params

in
out

return
remark

demo

21.11 MfSdkTmsGetMsg

Prototype

LIB_EXPORT s8 *MfSdkTmsGetMsg()

Function

Gets the current tms message

Params

in
out

return
remark

demo

Nothing

Nothing

tms msg string

21.12 MfSdkTmsGetResult

Prototype

LIB_EXPORT s8 *MfSdkTmsGetResult()

Function

Get tms result information

Params

in

Nothing

289

Fujian MoreFun Electronic Technology Co.,Ltd.

out

Nothing

tms result string

return
remark

demo

21.13 MfSdkTmsSetSig

Prototype

LIB_EXPORT void MfSdkTmsSetSig(s32 flag);

Function

Params

in
out

return
remark

demo

Whether the tms upgrade verifies the signature.(For traditional

POS,Soundbox not applicable)

0-enable ,1-disable

s32 flag

Nothing

none

MfSdkTmsSetSig(0)/MfSdkTmsSetSig(1);

21.14 MfSdkTmsUpdateOta

Prototype

s32 MfSdkTmsUpdateOta(char *filename,char *flag);

Function

update OTA

filename

flag

Nothing

download file path and name eg.

"exdata\\down.tmp"

fix string "ota.bin"

MFSDK_TMS_RET_OK success

other

fail

Params

in

out

return

remark

demo

290

Fujian MoreFun Electronic Technology Co.,Ltd.

21.15 MfSdkTmsSetConnectRetryCnt

Prototype

void MfSdkTmsSetConnectRetryCnt(u32 count);

Function

Set TMS connect retry count

Params

in
out

return
remark

demo

none

none

none

21.16 MfSdkTmsSetErrorRetryCnt

Prototype

void MfSdkTmsSetErrorRetryCnt(u32 count);

Function

Set TMS error retry count

Params

in
out

return
remark

demo

none

none

none

21.17 MfSdkTmsEnable

Prototype

void MfSdkTmsEnable(MFSDKBOOL b);

Function

Whether to enable the TMS service. Default support for TMS.

Params

in

out

return

b

none

none

291

MFSDK_TRUE-enable ,

MFSDK_FALSE-disable

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

//if disable TMS

MfSdkTmsEnable(MFSDK_FALSE);

21.18 MfSdkTmsSetActionCallback

Prototype

s32 MfSdkTmsSetActionCallback(MfSdkTmsActionCb

pFunCallback);

Function

Set TMS action progress callback function

pFunCallback

Callback

none

For details, see
MfSdkTmsResult_E

Params

in
out

return

remark

demo

21.19 MfSdkTmsEnableSyncTime

Prototype

void MfSdkTmsEnableSyncTime(MFSDKBOOL b);

Whether to synchronize TMS time (enabled by default).Only for

Soundbox.

MFSDK_TRUE - enable

MFSDK_FALSE - disable

b

none

Function

Params

in

out

return
remark

demo

292

Fujian MoreFun Electronic Technology Co.,Ltd.

22 LVGL module

22.1 Module description

This module mainly includes APIs about LVGL functions.

22.2 Module structure declaration

None.

22.3 Constant declarations

typedef enum
{

MFSDK_LVGL_OPER_SUCC = 0,
MFSDK_LVGL_OPER_FAIL = -1,
MFSDK_LVGL_OPER_CANCEL = -2,
MFSDK_LVGL_OPER_TIMEOUT = -3,
MFSDK_LVGL_OPER_BACKSPACE = -4,

} MfSdkLvglOper_E;

typedef enum
{

MFSDK_LVGL_LARGE_FONT = 2,
MFSDK_LVGL_NORMAL_FONT = 1,
MFSDK_LVGL_SMALL_FONT = 0,

} MfSdkLvglFont_E;

typedef enum
{

MFSDK_LVGL_ALIGN_RIGHT = 2,
MFSDK_LVGL_ALIGN_CENTER = 1,
MFSDK_LVGL_ALIGN_LEFT = 0,

} MfSdkLvglAlign_E;

typedef enum
{

MFSDK_LVGL_INPUT_MODE_NUM = 0,
MFSDK_LVGL_INPUT_MODE_TEXT = 1,
MFSDK_LVGL_INPUT_MODE_IP = 2,

293

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_LVGL_INPUT_MODE_PWD = 3,
MFSDK_LVGL_INPUT_MODE_AMOUNT = 4,

} MfSdkLvglInput_E;

typedef enum
{

MFSDK_LVGL_INPUTTEXT_IMAGE = 0,

}MfSdkLvglImageType_E;

typedef enum {

MFSDK_LVGL_SB_320_240_BLACK = 0, //320*240
MFSDK_LVGL_SB_320_240_WHITE = 1, //320*240
MFSDK_LVGL_SB_480_800_BLACK = 4, //480*800
MFSDK_LVGL_SB_480_800_WHITE = 5, //480*800

}MfSdkLvglStatusBar_E;

typedef enum
{

MFSDK_LVGL_NETMENU_EXIT_TIMEOUT = -1,
MFSDK_LVGL_NETMENU_EXIT_CANCEL = 0,
MFSDK_LVGL_NETMENU_NETINFO_EXIT,
MFSDK_LVGL_NETMENU_NETSET1_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETSET1_EXIT,
MFSDK_LVGL_NETMENU_NET4G_ALREADY_EXIT,
MFSDK_LVGL_NETMENU_NET4G_FAILED_NO_SIM,
MFSDK_LVGL_NETMENU_NET4G_FAILED_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NET4G_SUCCEED_EXIT,
MFSDK_LVGL_NETMENU_NETWIFI_FAILED_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETWIFI_SUCCEED_EXIT,
MFSDK_LVGL_NETMENU_NETADDWIFI_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETADDWIFI_EXIT,
MFSDK_LVGL_NETMENU_NETWIFISAVE_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETWIFISAVE_EXIT,
MFSDK_LVGL_NETMENU_NETWIFI_SWITCH_FAILED_EXIT_TIME

MFSDK_LVGL_NETMENU_NETWIFI_SWITCH_FAILED_EXIT,
MFSDK_LVGL_NETMENU_NETWIFISCANING_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETWIFISCANING_EXIT,
MFSDK_LVGL_NETMENU_NETWIFILIST_EXIT_TIMEOVER,
MFSDK_LVGL_NETMENU_NETWIFILIST_EXIT,
MFSDK_LVGL_NETMENU_NETWIFIINPUTPASSWORD_EXIT_TIME

294

OVER,

OVER,

Fujian MoreFun Electronic Technology Co.,Ltd.

MFSDK_LVGL_NETMENU_NETWIFIINPUTPASSWORD_EXIT,
MFSDK_LVGL_NETMENU_NETWIFICONNECT_SUCCEED_EXIT,
MFSDK_LVGL_NETMENU_NETWIFICONNECT_FAILED_EXIT,

}MfSdkLvglNetMenuExitValue_E;

22.4 MfSdkLvglInit

Prototype

LIB_EXPORT s32 MfSdkLvglInit(void)

Function

lvgl module initialization

Params

in
out

return

remark

demo

Nothing

Nothing

0

Other

success

fail

22.5 MfSdkLvglGetPageBody

Prototype

LIB_EXPORT lv_obj_t* MfSdkLvglGetPageBody()

Function

Get the modal lvgl page parent object

Params

in
out

return

remark

demo

Nothing

Nothing

0

Other

22.6 MfSdkLvglExit

fail

success,lvgl page parent object

Prototype

LIB_EXPORT s32 MfSdkLvglExit(void)

295

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

lvgl module exit

Params

in
out

return

remark

demo

Nothing

Nothing

0

Other

success

fail

22.7 MfSdkLvglCls

Prototype

LIB_EXPORT void MfSdkLvglCls(void)

Function

clear screen

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

22.8 MfSdkLvglClsEnableStatusBar

Prototype

LIB_EXPORT void MfSdkLvglClsEnableStatusBar(s32 status)

Function

enable status bar

Params

in
out

return
remark

demo

0 - off, 1 - on

status

Nothing

Nothing

296

Fujian MoreFun Electronic Technology Co.,Ltd.

22.9 MfSdkLvglEnableDefaultStatusBarIcons

Prototype

LIB_EXPORT void MfSdkLvglEnableDefaultStatusBarIcons(s32

status)

Function

enable default status bar icons

Params

in
out

return
remark

demo

0 - off, 1 - on

status

Nothing

Nothing

22.10 MfSdkLvglClearLine

Prototype

LIB_EXPORT void MfSdkLvglClearLine(s32 lineNo)

Function

clear specified line

Params

in
out

return
remark

demo

lineNo

Nothing

Nothing

line number(starting from 0)

22.11 MfSdkLvglGetStatusBarHeight

Prototype

LIB_EXPORT s32 MfSdkLvglGetStatusBarHeight()

Function

get status bar height

Params

in
out

return
remark

Nothing

Nothing

height

297

Fujian MoreFun Electronic Technology Co.,Ltd.

demo

22.12 MfSdkLvglCreateButtons

Prototype

LIB_EXPORT s32

MfSdkLvglCreateButtons(MfSdkLvglButtons_T items[], s32 size)

create buttons parameter.If items->id < 0 is
not clickable

items size

Function

create buttons

items

size

Nothing

height

Params

in

out

return
remark

demo

22.13 MfSdkLvglClearAll

Prototype

LIB_EXPORT void MfSdkLvglClearAll(void)

Function

clear screen without line 0

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

22.14 MfSdkLvglWaitKey

Prototype

LIB_EXPORT s32 MfSdkLvglWaitKey(s32 timeout)

Function

waiting for key pressed

298

Fujian MoreFun Electronic Technology Co.,Ltd.

timeout

Nothing

>=0

Other

timeout(second)

success, key value or button id

fail

Params

in
out

return

remark

demo

22.15 MfSdkLvglWaitKeyMs

Prototype

LIB_EXPORT s32 MfSdkLvglWaitKeyMs(s32 timeoutMs)

Function

waiting for key pressed

Params

in
out

return

remark

demo

timeout

Nothing

>=0

Other

timeout(ms)

success, key value or button id

fail

22.16 MfSdkLvglClrKeyFlag

Prototype

LIB_EXPORT void MfSdkLvglClrKeyFlag()

Function

Clean the key flag bit before getting the key loop

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

299

Fujian MoreFun Electronic Technology Co.,Ltd.

22.17 MfSdkLvglCheckKey

Prototype

LIB_EXPORT MFSDKBOOL MfSdkLvglCheckKey(void)

Function

check if key pressed

Params

in
out

return

remark

demo

Nothing

Nothing

1

0

key pressed

no key pressed

22.18 MfSdkLvglGetKey

Prototype

LIB_EXPORT s32 MfSdkLvglGetKey(void)

Function

get key value

Params

in
out

return

remark

demo

Nothing

Nothing

>=0

Other

Ref. MfSdkKbKeyCode_E

fail

22.19 MfSdkLvglDispTextCoord

Prototype

LIB_EXPORT s32 MfSdkLvglDispTextCoord(s32 x, s32 y, s32

font, s8* text)

Function

disp text by coordinate

Params

in

x

y

horizontal coordinate

vertical coordinate

300

Fujian MoreFun Electronic Technology Co.,Ltd.

0 - small,1 - normal,2 - big

text

success

fail

font

text

Nothing

0

Other

out

return

remark

demo

22.20 MfSdkLvglDispTextLine

Prototype

LIB_EXPORT s32 MfSdkLvglDispTextLine(s32 lineNo, s32 font,

const s8* text, s32 align, u8 reverse)

Function

disp text by line number

lineNo

font

text

align

reverse

Nothing

0

Other

line number(starting from 0)

font(0 - small,1 - normal,2 - big)

text

align type(0 - left, 1 - center, 2 - right)

reverse mode(1 - yes, 0 - no)

success

fail

Params

in

out

return

remark

demo

22.21 MfSdkLvglDispMenuText

Prototype

LIB_EXPORT s32 MfSdkLvglDispMenuText(s32 font, s8* title,
MfSdkLvglMenuText_T menus[], s32 size, s32 select, s32 timeout)

Function

disp text menus

Params

in

font

title

menus

size

select

font(0 - small,1 - normal,2 - big)

title

menu list

list size

default menu id

301

Fujian MoreFun Electronic Technology Co.,Ltd.

timeout

Nothing

>=0

Other

timeout(second)

success, menu id

fail

out

return

remark

demo

22.22 MfSdkLvglDispMenuIcon

Prototype

LIB_EXPORT s32 MfSdkLvglDispMenuIcon(s32 font, s8* title,

MfSdkLvglMenuIcon_T menus[], s32 size, s32 timeout)

Function

disp image menus

font

title

menus

size

timeout

Nothing

>=0

Other

0 - small,1 - normal,2 - big

title

menu list

list size

timeout(second)

success, menu id

fail

Params

in

out

return

remark

demo

22.23 MfSdkLvglDispButton

Prototype

LIB_EXPORT s32 MfSdkLvglDispButton(s32 lineNo, s32 font,

MfSdkButtonIcon_T buttons[], s32 size, s32 timeout)

Function

disp buttons

Params

in

out

line number(starting from 0)

font(0 - small,1 - normal,2 - big)

button list

list size

timeout(second)

lineNo

font

buttons

size

timeout

Nothing

302

Fujian MoreFun Electronic Technology Co.,Ltd.

>=0

Other

success, button id

fail

return

remark

demo

22.24 MfSdkLvglMessageBox

Prototype

LIB_EXPORT s32 MfSdkLvglMessageBox(s32 width, s32 height,

s8* msg, s8* btnLeft, s8* btnRight, s32 timeout)

Function

disp text menus

width

height

msg

btnLeft

btnRight

timeout

Nothing

>=0

Other

width

height

message

left button text

right button text

timeout(second)

success, button id (0 - left, 1 - right)

fail

Params

in

out

return

remark

demo

22.25 MfSdkLvglDispList

Prototype

LIB_EXPORT s32 MfSdkLvglDispList(s32 font, s8* title, s8*

items[], s32 size, s32 timeout)

Function

disp text list

Params

in

out

return

font

title

items

size

timeout

Nothing

0

font(0 - small,1 - normal,2 - big)

title

text list

list size

timeout(second)

success

303

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail

remark

demo

22.26 MfSdkLvglDispRollpage

Prototype

LIB_EXPORT s32 MfSdkLvglDispRollpage(s32 font, s8* title, s8*

buf, s32 timeout)

Function

disp text rollpage

font

title

buf

timeout

Nothing

0

Other

font(0 - small,1 - normal,2 - big)

title

text buffer

timeout(second)

success

fail

Params

in

out

return

remark

demo

22.27 MfSdkLvglInputText

Prototype

LIB_EXPORT s32 MfSdkLvglInputText(s32 font, s8* title, s8*

msg, s8* text, s32 mode, s32 min, s32 max, s32 timeout)

Function

input text, show input text on a line

Params

in

out

return

font

title

msg

mode

min

max

timeout

text

0

font(0 - small,1 - normal,2 - big)

title

message

0 - number, 1 - text,
2 - IP, 3 - password, 4 - amount

mininum length

maxinum length

timeout(second)

input text

success

304

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail

remark

demo

22.28 MfSdkLvglInputTextEx

Prototype

LIB_EXPORT s32 MfSdkLvglInputTextEx(s32 font, s8* title, s8*

msg, s8* text, s32 mode, s32 min, s32 max, s32 timeout)

Function

input text, show input text in a input box

font

title

msg

mode

min

max

timeout

text

0

Other

font(0 - small,1 - normal,2 - big)

title

message

0 - number, 1 - text,
2 - IP, 3 - password, 4 - amount

mininum length

maxinum length

timeout(second)

input text

success

fail

Params

in

out

return

remark

demo

22.29 MfSdkLvglDispBar

Prototype

LIB_EXPORT s32 MfSdkLvglDispBar(s32 width, s32 height, s32

min, s32 max, void** bar)

Function

disp progress bar

Params

in

out

return

width

height

min

max

bar

0

305

width

height

mininum value

maxinum value

progress bar handle

success

Fujian MoreFun Electronic Technology Co.,Ltd.

Other

fail

remark

demo

22.30 MfSdkLvglUpdateBar

Prototype

LIB_EXPORT s32 MfSdkLvglUpdateBar(void* bar, s32 value)

Function

update progress bar

bar

value

Nothing

0

Other

progress bar handle

current value

success

fail

Params

in

out

return

remark

demo

22.31 MfSdkLvglDispLed

Prototype

LIB_EXPORT s32 MfSdkLvglDispLed(s32 x, s32 y, s32 width,

s32 height)

Function

disp progress bar

Params

in

out

return

remark

demo

x

y

width

height

Nothing

0

Other

horizontal coordinate

vertical coordinate

width

height

success

fail

306

Fujian MoreFun Electronic Technology Co.,Ltd.

22.32 MfSdkLvglUpdateLed

Prototype

LIB_EXPORT s32 MfSdkLvglUpdateLed(s32 index, s32 state)

Function

update led state

index

state

Nothing

0

Other

led index (0 - red, 1 - blue,
2 - green, 3 - yellow)

( 0 - off, 1 - on)

success

fail

Params

in

out

return

remark

demo

22.33 MfSdkLvglShowQrcode

Prototype

LIB_EXPORT s32 MfSdkLvglShowQrcode(s32 font, s8* title, s8*

qrcode, s32 width, s32 align)

Function

show qrcode

font

title

qrcode

width

align

Nothing

0

Other

font(0 - small,1 - normal,2 - big)

title

qrcode text

width

align type(0 - left, 1 - center, 2 - right)

success

fail

Params

in

out

return

remark

demo

307

Fujian MoreFun Electronic Technology Co.,Ltd.

22.34 MfSdkLvglShowQrcodeEx

Prototype

LIB_EXPORT s32 MfSdkLvglShowQrcodeEx(s8* qrcode, s32

qrcodeLen, s32 width, s32 align, s32 y)

Function

show qrcode

qrcode

qrcode data

qrcodeLen

qrcode data length

width

align

y

Nothing

0

Other

width

align type(0 - left, 1 - center, 2 - right)

Y offset

success

fail

Params

in

out

return

remark

demo

22.35 MfSdkLvglShowImage

Prototype

LIB_EXPORT s32 MfSdkLvglShowImage(s32 x, s32 y, s8*

fileName, s8* text, s32 id)

Function

show image button

Params

in

out

return

remark

demo

x

y

horizontal coordinate

vertical coordinate

fileName

image file name

text

id

Nothing

0

Other

button text

button id( >=0 image with click event, <0

no click events)

success

fail

308

Fujian MoreFun Electronic Technology Co.,Ltd.

22.36 MfSdkLvglShowImageEx

Prototype

LIB_EXPORT s32 MfSdkLvglShowImage(s32 x, s32 y, s32 align,

s8* fileName, s8* text, s32 id)

Function

show image button

x

y

align

fileName

text

id

Nothing

0

Other

horizontal coordinate

vertical coordinate

align type(0 - left, 1 - center, 2 - right)

image file name

button text

button id( >=0 image with click event, <0

no click events)

success

fail

Params

in

out

return

remark

demo

22.37 MfSdkLvglShowImagebuff

Prototype

LIB_EXPORT s32 MfSdkLvglShowImagebuff(s32 x, s32 y, s32

w, s32 h, s8* buf, s8* text, s32 id)

Function

show image buff

Params

in

out

return

x

y

w

h

buf

text

id

Nothing

0

Other

horizontal coordinate

vertical coordinate

width

height

image buffer

button text

button id( >=0 image with click event, <0

no click events)

success

fail

309

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

22.38 MfSdkLvglShowScreenCanves

Prototype

LIB_EXPORT s32 MfSdkLvglShowScreenCanves(s8* buf)

Function

show except for the status bar the screen buff

Params

in
out

return

remark

demo

buf

Nothing

0

Other

Screen buff(rgba 32-bit)

success

fail

MF960 with status bar,screen size is 480 * (800-30),buff size is 480
* (800-30) * 4;MF960 without status bar,screen size is 480 *
800,buff size is 480 * 800 * 4

22.39 MfSdkLvglDrawLine

Prototype

h)

LIB_EXPORT s32 MfSdkLvglDrawLine(s32 x, s32 y, s32 w, s32

Function

draw a line

x

y

w

h

Nothing

0

Other

horizontal coordinate

vertical coordinate

width

height

success

fail

Params

in

out

return

remark

demo

310

Fujian MoreFun Electronic Technology Co.,Ltd.

22.40 MfSdkLvglDrawBox

Prototype

h)

LIB_EXPORT s32 MfSdkLvglDrawBox(s32 x, s32 y, s32 w, s32

Function

draw a box

x

y

w

h

Nothing

0

Other

horizontal coordinate

vertical coordinate

width

height

success

fail

Params

in

out

return

remark

demo

22.41 MfSdkLvglEsign

Prototype

LIB_EXPORT s32 MfSdkLvglEsign(s32 font, s8* title, s8* factor,

u8 ** imgData, s32* dataSize, s32 timeout)

Function

electronic signature

font

title

factor

timeout

imgData

dataSize

0

Other

font(0 - small,1 - normal,2 - big)

title

factor

timeout(second)

image data

image data size

success

fail

Params

in

out

return

remark

demo

311

Fujian MoreFun Electronic Technology Co.,Ltd.

22.42 MfSdkLvglScan

Prototype

LIB_EXPORT s32 MfSdkLvglScan(s32 font, s8* title, s8* data,

s32 datasize, s32 timeout)

Function

Scan the QR code, barcode

font

title

dataSize

timeout

data

0

Other

font(0 - small,1 - normal,2 - big)

title

code data size

timeout(second)

code data

success

fail

Params

in

out

return

remark

demo

22.43 MfSdkLvglDispDialog

Prototype

LIB_EXPORT s32 MfSdkLvglDispDialog(s32 font, s8* title, s8*

msg, s32 timeout, u8 isCountDown, void** handle)

Function

display dialog

font

title

msg

font(0 - small,1 - normal,2 - big)

title

message

timeout

timeout(second)

isCountDown

countdown mode (1 - Yes, 0 - No)

handle

0

Other

dialog handle

success

fail

Params

in

out

return

remark

demo

312

Fujian MoreFun Electronic Technology Co.,Ltd.

22.44 MfSdkLvglUpdateDialog

Prototype

LIB_EXPORT s32 MfSdkLvglUpdateDialog(void* handle, s8*

title, s8* msg, s32 timeout, u8 isCountDown)

Function

update dialog

handle

title

msg

timeout

dialog handle

title

message

timeout(second)

isCountDown

countdown mode (1 - Yes, 0 - No)

Nothing

0

Other

success

fail

Params

in

out

return

remark

demo

22.45 MfSdkLvglCloseDialog

Prototype

LIB_EXPORT s32 MfSdkLvglCloseDialog(void* handle)

Function

close dialog

Params

in
out

return

remark

demo

handle

Nothing

0

Other

dialog handle

success

fail

22.46 MfSdkLvglDispRollpageEx

Prototype

LIB_EXPORT s32 MfSdkLvglDispRollpageEx(s32 font, s8* title,

s8* buf, s32 timeout)

313

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

display text rollpage

font

title

buf

timeout

Nothing

0

Other

font(0 - small,1 - normal,2 - big)

title

text buffer

timeout(second)

success

fail

Params

in

out

return

remark

demo

22.47 MfSdkLvglDispMultipleChoice

Prototype

LIB_EXPORT s32 MfSdkLvglDispMultipleChoice(s32 font,const
s8* title, MfSdkLvglMenuText_T* choiseArry, s32 choiseSize, s32
select, s32 timeout)

Function

display multiple choice

font

title

choiseArry

choiseSize

select

timeout

Nothing

>=0

Other

font(0 - small,1 - normal,2 - big)

title

list

list size

default list id

timeout(second)

success, list id

fail

Params

in

out

return

remark

demo

22.48 MfSdkLvglDispSetSlider

LIB_EXPORT s32 MfSdkLvglDispSetSlider(s8* title, s32 width,

Prototype

s32 height, s32 minLevel, s32 maxLevel, s32 startValue, s32
timeout)

314

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

set slider

title

width

height

minLevel

maxLevel

startValue

timeout

Nothing

0

Other

title

slider width

slider height

minimum slider value

maximum slider value

startValue slider initial value

timeout(second)

success

fail

Params

in

out

return

remark

demo

22.49 MfSdkLvglDispSetResult

Prototype

LIB_EXPORT s32 MfSdkLvglDispSetResult(s32 result, s8* msg,

s32 timeout)

Function

display set result

result

msg

timeout

Nothing

0

Other

result

message

timeout(second)

success

fail

Params

in

out

return

remark

demo

22.50 MfSdkLvglInputPin

Prototype

LIB_EXPORT s32 MfSdkLvglInputPin(s8* title, s8* msg, s8*

amount, s8* cardID, s8* pin, s32 timeout)

315

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

update dialog

title

msg

amount

cardID

timeout

pin

0

Other

title

message

amount

cardID

timeout(second)

input pin

success

fail

Params

in

out

return

remark

demo

22.51 MfSdkLvglDispAnimation

Prototype

LIB_EXPORT s32 MfSdkLvglDispAnimation(s32 imgSize, s8**

imgName, s8* msg, s32 interval, void** handle)

Function

display animation

imgSize

imgName

msg

interval

handle

0

Other

images size

images name

message

image display interval

animation handle

success

fail

Params

in

out

return

remark

demo

22.52 MfSdkLvglCloseAnimation

Prototype

LIB_EXPORT s32 MfSdkLvglCloseAnimation(void* handle)

Function

close animation

316

Fujian MoreFun Electronic Technology Co.,Ltd.

handle

Nothing

0

Other

animation handle

success

fail

Params

in
out

return

remark

demo

22.53 MfSdkLvglCreateStatusBarTask

LIB_EXPORT void

MfSdkLvglCreateStatusBarTask(MfSdkStatusBarCb task_cb)

set callback function for status bar task(The loop call callback once a

second)

callback function for status bar

task(loop)

task_cb

Nothing

Nothing

Prototype

Function

Params

in

out

return
remark

demo

22.54 MfSdkLvglSetStatusBarIcon

Prototype

LIB_EXPORT s32 MfSdkLvglSetStatusBarIcon(s32 x, s8*

iconname, s32 group)

Function

display status bar icon

x

horizontal coordinate

iconname

icon name

group

Nothing

0

Other

icon group(max 5 groups, 0,1,2,3,4)

success

fail

This API can only be in MfSdkLvglCreateStatusBarTask callback
function calls

Params

in

out

return

remark

demo

317

Fujian MoreFun Electronic Technology Co.,Ltd.

22.55MfSdkLvglQuickSetStatusBarIcon

Prototype

LIB_EXPORT s32 MfSdkLvglQuickSetStatusBarIcon(s32 x, s8*

iconname, s32 group)

Function

Quick display status bar icon

x

horizontal coordinate

iconname

icon name

group

Nothing

0

Other

icon group(max 5 groups, 0,1,2,3,4)

success

fail

This API is not in MfSdkLvglCreateStatusBarTask callback
function calls

Params

in

out

return

remark

demo

22.56MfSdkLvglSetStatusBar

Prototype

LIB_EXPORT void MfSdkLvglSetStatusBar(s32 height,

lv_color_t bgColor)

Function

set status bar config

status bar height

status bar background color

height

bgColor

Nothing

Nothing

Params

in

out

return
remark

demo

22.57 MfSdkLvglGetUiBuff

Prototype

LIB_EXPORT void MfSdkLvglGetUiBuff(void (*getUI)(u8 *buf,

s32 len))

318

Fujian MoreFun Electronic Technology Co.,Ltd.

Function

Get the LVGL refresh screen buff

The callback function for refreshing the

screen

Params

in

out

return
remark

demo

getUI

Nothing

Nothing

22.58 MfSdkLvglLoadPng

Prototype

LIB_EXPORT s8 MfSdkLvglLoadPng(const s8 *filename)

Function

Load png image

Params

in
out

filename

Nothing

png image path

Ref.MfSdkLvglOper_E

return
remark

demo

22.59 MfSdkLvglFreePng

Prototype

LIB_EXPORT s8 MfSdkLvglFreePng(const s8 *filename)

Function

Load png image

Params

in
out

filename

Nothing

png image path

Ref.MfSdkLvglOper_E

return
remark

demo

319

Fujian MoreFun Electronic Technology Co.,Ltd.

22.60 MfSdkLvglGuiInit

Prototype

LIB_EXPORT void MfSdkLvglGuiInit(void)

Function

init LVGL group

Params

in
out

return
remark

demo

Nothing

Nothing

Nothing

22.61 MfSdkLvglGroupSet

Prototype

LIB_EXPORT void MfSdkLvglGroupSet(lv_obj_t* obj)

Function

obj add to group and set focus obj

Params

in
out

return
remark

demo

obj

Nothing

Nothing

23 Memory module

23.1 Module description

This module mainly includes APIs on memory operations.

23.2 Module structure declaration

None.

23.3 Constant declarations

None.

320

Fujian MoreFun Electronic Technology Co.,Ltd.

23.4 MfSdkMemFree

Prototype

LIB_EXPORT void MfSdkMemFree(void *ptr)

Function

ref. standard free

Params

in
out

return
remark

demo

ptr

Nothing

Nothing

23.5 MfSdkMemMalloc

Prototype

LIB_EXPORT void *MfSdkMemMalloc(s32 size)

Function

Ref. standard malloc

Params

in
out

size

Nothing

return
remark

demo

23.6 MfSdkMemRealloc

Prototype

LIB_EXPORT void *MfSdkMemRealloc(void *ptr, s32 size)

Function

Ref. standard realloc

Params

in

out

return

ptr

size

Nothing

321

Fujian MoreFun Electronic Technology Co.,Ltd.

remark

demo

23.7 MfSdkMemCalloc

Prototype

LIB_EXPORT void *MfSdkMemCalloc(s32 nitems, s32 size)

Function

Params

in

out

return
remark

demo

nitems

size

Nothing

24 Base module

24.1 Module description

Base device.

24.2 Module structure declaration

None.

24.3 Constant declarations

None.

24.4 MfSdkBaseCheck

Prototype

s32 MfSdkBaseCheck()

Function

Whether the device uses a base

Params

in
out

Nothing

Nothing

322

return

remark

demo

Fujian MoreFun Electronic Technology Co.,Ltd.

0

1

Not base

have base

s32 ret = 0;

ret = MfSdkBaseCheck();

if(ret==1)

{

//have base

}

323
